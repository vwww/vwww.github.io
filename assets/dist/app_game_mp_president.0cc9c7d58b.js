(()=>{"use strict";var e,t,s,i,r={153(e,t,s){s(1);var i,r,n,a,o,d,l,c,h,g,p,u,v,m,f,_,k=s(2),N=s(127),I=s(128),b=s(129),E=s(130),M=s(131),R=s(132),T=s(133),x=s(134),y=s(137),C=s(144),A=s(138),P=s(140),S=s(145);let O=[["optTurnTime","i",2e4,"Turn Time / ms","duration of each turn, in milliseconds",5e3,6e4],["optDecks","I",1,"Decks","number of decks",1,0x8000000000000],["optJokers","i",2,"Jokers","number of jokers per deck",0,2],["optKeepJokers","b",!1,"Keep Jokers","Scum and HS keep jokers during card transfer"],["optMustGiveLowest","b",!1,"Must give lowest","President and VP must give lowest cards during card transfer"],["optRev","e",0,"Revolutions","combo of 4 or more cards (and selected condition) reverses rankings",["off","on, strict (no jokers)","on, relaxed (any 4 are non-joker)","on, jokers (any)"]],["optRevEndTrick","b",!1,"Revolution ends trick","a revolution ends the current trick and starts a new one"],["opt1Fewer2","b",!0,"One fewer 2",""],["optPass","e",1,"Pass","",["pass turn","pass trick","single turn"]],["optEqualize","e",1,"Equalize","",["disallow","allow","equalize or skip","equalize or pass","force skip (next player skips)"]],["optEqualizeEndTrickByScum","b",!1,"Equalize end trick by Scum","trick ends if Scum equalizes"],["optEqualizeEndTrickByOthers","b",!1,"Equalize end trick by non-Scum","trick ends if others equalize"],["optEqualizeOnlyScum","b",!1,"Equalize only by Scum","only Scum can equalize"],["opt4inARow","b",!1,"4-in-a-row","4 or more cards of the same rank (including equalizing) ends trick"],["opt8","b",!1,"8-rule","rank 8 ends trick"],["optPenalizeFinal2","b",!1,"Penalize final 2","playing 2 as last card incurs rank penalty"],["optPenalizeFinalJoker","b",!1,"Penalize final joker","playing joker as last card incurs rank penalty"],["optFirstTrick","e",0,"First Trick","who starts?",["Scum","President","Random"]]];function w(e){return e.optTurnTime+"/"+e.optDecks+"/"+e.optJokers+(e.optKeepJokers?"J":"j")+(e.optMustGiveLowest?"G":"g")+e.optRev+(e.optRevEndTrick?"R":"r")+(e.opt1Fewer2?"T":"t")+e.optPass+e.optEqualize+(e.optEqualizeEndTrickByScum?"E":"e")+(e.optEqualizeEndTrickByOthers?"E":"e")+(e.optEqualizeOnlyScum?"E":"e")+(e.opt4inARow?"F":"f")+(e.opt8?"B":"b")+(e.optPenalizeFinal2?"P":"p")+(e.optPenalizeFinalJoker?"P":"p")+e.optFirstTrick}(i=h||(h={}))[i.WELCOME=0]="WELCOME",i[i.JOIN=1]="JOIN",i[i.LEAVE=2]="LEAVE",i[i.RESET=3]="RESET",i[i.RENAME=4]="RENAME",i[i.PING=5]="PING",i[i.PING_TIME=6]="PING_TIME",i[i.CHAT=7]="CHAT",i[i.ACTIVE=8]="ACTIVE",i[i.ROUND_WAIT=9]="ROUND_WAIT",i[i.ROUND_INTERM=10]="ROUND_INTERM",i[i.ROUND_START=11]="ROUND_START",i[i.READY=12]="READY",i[i.END_ROUND=13]="END_ROUND",i[i.MOVE_CONFIRM=14]="MOVE_CONFIRM",i[i.END_TURN=15]="END_TURN",i[i.END_TURN_TRANSFER=16]="END_TURN_TRANSFER",i[i.END_TURN_TRANSFER_DISCARD=17]="END_TURN_TRANSFER_DISCARD",i[i.PLAYER_ELIMINATE=18]="PLAYER_ELIMINATE",i[i.PLAYER_ELIMINATE_EARLY=19]="PLAYER_ELIMINATE_EARLY",i[i.PLAYER_PRIVATE_INFO_HAND=20]="PLAYER_PRIVATE_INFO_HAND",i[i.PLAYER_PRIVATE_INFO_GIVE=21]="PLAYER_PRIVATE_INFO_GIVE",(r=g||(g={}))[r.RESET=0]="RESET",r[r.RENAME=1]="RENAME",r[r.PONG=2]="PONG",r[r.CHAT=3]="CHAT",r[r.ACTIVE=4]="ACTIVE",r[r.READY=5]="READY",r[r.MOVE_PASS=6]="MOVE_PASS",r[r.MOVE_CONTINUE=7]="MOVE_CONTINUE",r[r.MOVE_START=8]="MOVE_START",r[r.MOVE_TRANSFER=9]="MOVE_TRANSFER",r[r.MOVE_END=10]="MOVE_END";class U extends S.Iu{#e=k.state(0);get score(){return k.get(this.#e)}set score(e){k.set(this.#e,e,!0)}#t=k.state(0);get streak(){return k.get(this.#t)}set streak(e){k.set(this.#t,e,!0)}#s=k.state(0);get rankLast(){return k.get(this.#s)}set rankLast(e){k.set(this.#s,e,!0)}#i=k.state(5);get roleLast(){return k.get(this.#i)}set roleLast(e){k.set(this.#i,e,!0)}#r=k.state(k.proxy([0,0,0,0,0]));get roleCount(){return k.get(this.#r)}set roleCount(e){k.set(this.#r,e,!0)}updateScore(e,t){this.rankLast=e,this.score+=t-e+1,2===(this.roleLast=J(e,t))?(this.streak<0&&(this.streak=0),this.streak++):(this.streak>0&&(this.streak=0),this.streak--),this.roleCount[this.roleLast+2]++}resetScore(){this.score=0,this.streak=0,this.rankLast=0,this.rankLast=5,this.roleCount=[0,0,0,0,0]}canResetScore(){return this.rankLast}readWelcome(e){super.readWelcome(e),this.score=e.getInt(),this.streak=e.getInt(),this.rankLast=e.getInt(),this.roleLast=e.getInt();for(let t=0;t<5;t++)this.roleCount[t]=e.getInt()}}class D extends S.$G{#n=k.state(0);get role(){return k.get(this.#n)}set role(e){k.set(this.#n,e,!0)}#a=k.state(k.proxy($()));get discarded(){return k.get(this.#a)}set discarded(e){k.set(this.#a,e,!0)}#o=k.state(0n);get handSize(){return k.get(this.#o)}set handSize(e){k.set(this.#o,e,!0)}#d=k.state(!1);get passed(){return k.get(this.#d)}set passed(e){k.set(this.#d,e,!0)}}class L extends S.p${trickNum=0;trickTurn=0;duration=0n;discarded=$();hand=$();prevRole=0;newRole=0}(n=p||(p={}))[n.OFF=0]="OFF",n[n.ON_STRICT=1]="ON_STRICT",n[n.ON_RELAXED=2]="ON_RELAXED",n[n.ON=3]="ON",n[n.NUM=4]="NUM",(a=u||(u={}))[a.PASS_TURN=0]="PASS_TURN",a[a.PASS_TRICK=1]="PASS_TRICK",a[a.SINGLE_TURN=2]="SINGLE_TURN",a[a.NUM=3]="NUM",(o=v||(v={}))[o.DISALLOW=0]="DISALLOW",o[o.ALLOW=1]="ALLOW",o[o.CONTINUE_OR_SKIP=2]="CONTINUE_OR_SKIP",o[o.CONTINUE_OR_PASS=3]="CONTINUE_OR_PASS",o[o.FORCE_SKIP=4]="FORCE_SKIP",o[o.NUM=5]="NUM",(d=m||(m={}))[d.SCUM=0]="SCUM",d[d.PRESIDENT=1]="PRESIDENT",d[d.RANDOM=2]="RANDOM",d[d.NUM=3]="NUM";let F=1n<<51n;class G extends S.jQ{PlayerInfoType=D;PlayerDiscType=L;#l=k.state(k.proxy((0,T.q)(O)));get mode(){return k.get(this.#l)}set mode(e){k.set(this.#l,e,!0)}#c=k.state(k.proxy(f.GIVE_CARDS));get gamePhase(){return k.get(this.#c)}set gamePhase(e){k.set(this.#c,e,!0)}#h=k.state(0);get giveFlags(){return k.get(this.#h)}set giveFlags(e){k.set(this.#h,e,!0)}#g=k.state(0);get givePlayerIndex(){return k.get(this.#g)}set givePlayerIndex(e){k.set(this.#g,e,!0)}#p=k.state(0);get pres(){return k.get(this.#p)}set pres(e){k.set(this.#p,e,!0)}#u=k.state(0);get scum(){return k.get(this.#u)}set scum(e){k.set(this.#u,e,!0)}#v=k.state(0);get vicePres(){return k.get(this.#v)}set vicePres(e){k.set(this.#v,e,!0)}#m=k.state(0);get highScum(){return k.get(this.#m)}set highScum(e){k.set(this.#m,e,!0)}#f=k.state(!1);get giveDown(){return k.get(this.#f)}set giveDown(e){k.set(this.#f,e,!0)}#_=k.state(0);get take0(){return k.get(this.#_)}set take0(e){k.set(this.#_,e,!0)}#k=k.state(0);get take1(){return k.get(this.#k)}set take1(e){k.set(this.#k,e,!0)}#N=k.state(0);get give0(){return k.get(this.#N)}set give0(e){k.set(this.#N,e,!0)}#I=k.state(0);get give1(){return k.get(this.#I)}set give1(e){k.set(this.#I,e,!0)}#b=k.state(!1);get revolution(){return k.get(this.#b)}set revolution(e){k.set(this.#b,e,!0)}#E=k.state(0);get trickNum(){return k.get(this.#E)}set trickNum(e){k.set(this.#E,e,!0)}#M=k.state(0);get trickTurn(){return k.get(this.#M)}set trickTurn(e){k.set(this.#M,e,!0)}#R=k.state(0n);get trickCount(){return k.get(this.#R)}set trickCount(e){k.set(this.#R,e,!0)}#T=k.state(0n);get trickTotal(){return k.get(this.#T)}set trickTotal(e){k.set(this.#T,e,!0)}#x=k.state(0);get trickRank(){return k.get(this.#x)}set trickRank(e){k.set(this.#x,e,!0)}#y=k.state(!1);get trick1Fewer(){return k.get(this.#y)}set trick1Fewer(e){k.set(this.#y,e,!0)}penalty=!1;#C=k.state(0);get passIndex(){return k.get(this.#C)}set passIndex(e){k.set(this.#C,e,!0)}#A=k.state(k.proxy($()));get cardCountTotal(){return k.get(this.#A)}set cardCountTotal(e){k.set(this.#A,e,!0)}#P=k.state(k.proxy($()));get cardCountMine(){return k.get(this.#P)}set cardCountMine(e){k.set(this.#P,e,!0)}#S=k.state(k.proxy($()));get cardCountDiscard(){return k.get(this.#S)}set cardCountDiscard(e){k.set(this.#S,e,!0)}#O=k.derived(()=>this.cardCountTotal.map((e,t)=>e-this.cardCountMine[t]-this.cardCountDiscard[t]));get cardCountOthers(){return k.get(this.#O)}set cardCountOthers(e){k.set(this.#O,e)}#w=k.state(k.proxy([]));get moveHistory(){return k.get(this.#w)}set moveHistory(e){k.set(this.#w,e,!0)}#U=k.state(0);get pendingMoveRank(){return k.get(this.#U)}set pendingMoveRank(e){k.set(this.#U,e,!0)}#D=k.state(0);get pendingMoveBase(){return k.get(this.#D)}set pendingMoveBase(e){k.set(this.#D,e,!0)}#L=k.state(0);get pendingMoveJokers(){return k.get(this.#L)}set pendingMoveJokers(e){k.set(this.#L,e,!0)}#F=k.state(0);get pendingMoveRankAck(){return k.get(this.#F)}set pendingMoveRankAck(e){k.set(this.#F,e,!0)}#G=k.state(0);get pendingMoveBaseAck(){return k.get(this.#G)}set pendingMoveBaseAck(e){k.set(this.#G,e,!0)}#J=k.state(0);get pendingMoveJokersAck(){return k.get(this.#J)}set pendingMoveJokersAck(e){k.set(this.#J,e,!0)}get ROUND_TIME(){return this.mode.optTurnTime}INTERMISSION_TIME=3e4;newClient(){return new U}enterGame(e,t){this.setupGame(e),this.sendf("is",this.PROTOCOL_VERSION,t)}sendReset(){this.sendf("i",g.RESET)}sendRename(e){this.sendf("is",g.RENAME,e)}sendPong(e){this.sendf("i2",g.PONG,e)}sendChat(e,t,s=-1){this.sendf("i3s",g.CHAT,t,s,(0,P.JK)(e))}sendActive(){this.sendf("i",g.ACTIVE)}sendReady(){this.sendf("i",g.READY)}setPendingRank(e,t,s){if(this.pendingMoveRank=e,this.trickTurn){let e=this.trickCount-(s&&this.mode.opt1Fewer2&&this.trickCount>1?1n:0n);t>e?(this.pendingMoveBase=Number(e),this.pendingMoveJokers=0):(this.pendingMoveBase=Number(t),this.pendingMoveJokers=Number(e-t))}else this.pendingMoveJokers=+!(this.pendingMoveBase=Number(t))}sendMove(){this.pendingMoveRank<0?(this.pendingMoveBase=this.pendingMoveJokers=0,this.sendf("i",g.MOVE_PASS)):this.trickTurn||!this.pendingMoveBase?(this.pendingMoveBase=0,this.sendf("i2U",g.MOVE_CONTINUE,this.pendingMoveRank,BigInt(this.pendingMoveJokers))):this.sendf("i2U2",g.MOVE_START,this.pendingMoveRank,BigInt(this.pendingMoveJokers),BigInt(this.pendingMoveBase))}sendMoveTransfer(e,t){this.sendf("i3",g.MOVE_TRANSFER,e,t)}sendMoveEnd(){this.sendf("i",g.MOVE_END)}MESSAGE_HANDLERS={[h.WELCOME]:this.processWelcome,[h.JOIN]:this.processJoin,[h.LEAVE]:this.processLeave,[h.RESET]:this.processReset,[h.RENAME]:this.processRename,[h.PING]:this.processPing,[h.PING_TIME]:this.processPingTime,[h.CHAT]:this.processChat,[h.ACTIVE]:this.processActive,[h.ROUND_WAIT]:this.processRoundWait,[h.ROUND_INTERM]:this.processRoundInterm,[h.ROUND_START]:this.processRoundStart,[h.READY]:this.processReady,[h.END_ROUND]:this.processEndRound,[h.MOVE_CONFIRM]:this.processMoveConfirm,[h.END_TURN]:this.processEndTurn,[h.END_TURN_TRANSFER]:this.processEndTurnTransfer,[h.END_TURN_TRANSFER_DISCARD]:this.processEndTurnTransferDiscard,[h.PLAYER_ELIMINATE]:this.processEliminate,[h.PLAYER_ELIMINATE_EARLY]:this.processEliminateEarly,[h.PLAYER_PRIVATE_INFO_HAND]:this.processPrivateInfoHand,[h.PLAYER_PRIVATE_INFO_GIVE]:this.processPrivateInfoGive};processWelcomeMode(e){this.mode.optTurnTime=e.getInt(),this.mode.optDecks=(0,C.q)(e.getUint64(),1n,F);let t=e.get(),s=e.get(),i=e.get();this.mode.optJokers=Math.min(3&t,2),this.mode.optRev=t>>2&3,this.mode.optPass=Math.min(t>>4&3,u.NUM-1),this.mode.optFirstTrick=Math.min(t>>6&3,m.NUM-1),this.mode.optEqualize=Math.min(7&s,v.NUM-1),this.mode.optKeepJokers=!!(8&s),this.mode.optMustGiveLowest=!!(16&s),this.mode.optRevEndTrick=!!(32&s),this.mode.opt1Fewer2=!!(64&s),this.mode.optEqualizeEndTrickByScum=!!(128&s),this.mode.optEqualizeEndTrickByOthers=!!(1&i),this.mode.optEqualizeOnlyScum=!!(2&i),this.mode.opt4inARow=!!(4&i),this.mode.opt8=!!(8&i),this.mode.optPenalizeFinal2=!!(16&i),this.mode.optPenalizeFinalJoker=!!(32&i)}processPlayerInfo(e,t){t.role=0,t.discarded=z(e);let s=e.getUint64();t.handSize=s>>1n,t.passed=!!(1n&s)}processDiscInfo(e,t){t.trickNum=e.getInt(),t.trickTurn=e.getInt(),t.duration=e.getUint64(),t.discarded=z(e),t.hand=z(e),t.prevRole=e.getInt(),t.newRole=e.getInt()}processRoundStartInfo(e){let t=BigInt(52+this.mode.optJokers)*this.mode.optDecks,s=BigInt(this.roundPlayers.length),i=t/s,r=t%s;if(this.playerInfo.forEach((e,t)=>{e.role=0,e.discarded=$(),e.handSize=i,t<r&&e.handSize++,e.passed=!1}),this.moveHistory=[],this.giveFlags=0,this.giveDown=!1,this.givePlayerIndex=-1,this.give0=this.give1=-1,(this.scum=e.getCN())>=0){this.pres=0;let e=this.playerInfo[this.pres],t=this.playerInfo[this.scum];e.role=2,t.role=-2,this.giveFlags=2,e.owner===this.localClient.cn?this.givePlayerIndex=this.scum:t.owner===this.localClient.cn&&(this.givePlayerIndex=this.pres),this.addGivePublic(t,e,2)}else this.pres=-1;if((this.highScum=e.getCN())>=0){this.vicePres=e.getCN();let t=this.playerInfo[this.vicePres],s=this.playerInfo[this.highScum];t.role=1,s.role=-1,this.giveFlags|=1,t.owner===this.localClient.cn?this.givePlayerIndex=this.highScum:s.owner===this.localClient.cn&&(this.givePlayerIndex=this.vicePres),this.addGivePublic(s,t,1)}else this.vicePres=-1;this.revolution=!1,this.trickNum=this.trickTurn=0,this.trickCount=this.trickTotal=0n,this.cardCountDiscard=$(),this.cardCountTotal=V(this.mode.optDecks,this.mode.optJokers),this.turnIndex=e.getInt(),this.passIndex=-1,this.giveFlags?this.gamePhase=f.GIVE_CARDS:this.gamePhase=f.PLAYING_MUST_3,this.resetMove()}processRoundInfo(e){let t;if(this.moveHistory=[],this.cardCountMine=$(),this.cardCountDiscard=$(),this.cardCountTotal=V(this.mode.optDecks,this.mode.optJokers),this.roundState!==y.mk.ACTIVE)return;let s=e.get();if(this.gamePhase=3&s,this.gamePhase===f.GIVE_CARDS?(this.giveFlags=s>>2&3,this.revolution=!1):this.revolution=!!(4&s),(t=this.playerInfo[this.pres=16&s?e.getCN():-1])&&(t.role=2),(t=this.playerInfo[this.scum=32&s?e.getCN():-1])&&(t.role=-2),(t=this.playerInfo[this.vicePres=64&s?e.getCN():-1])&&(t.role=1),(t=this.playerInfo[this.highScum=128&s?e.getCN():-1])&&(t.role=-1),this.trickNum=e.getInt(),this.trickTurn=e.getInt()){this.trickRank=e.getInt();let t=e.getUint64();this.trickCount=t>>1n,this.trickTotal=e.getUint64(),this.trick1Fewer=!!(1n&t)}else this.trickCount=this.trickTotal=0n;this.playerInfo.forEach(e=>{for(let t=0;t<=_.NUM;t++)this.cardCountDiscard[t]+=e.discarded[t]}),this.playerDiscInfo.forEach(e=>{for(let t=0;t<=_.NUM;t++)this.cardCountDiscard[t]+=e.discarded[t]+e.hand[t]}),this.passIndex=e.getInt()}processMoveConfirm(e){this.pendingMoveRankAck=e.getInt(),this.pendingMoveJokersAck=Number(e.getUint64()),this.pendingMoveBaseAck=Number(e.getUint64())}processEndTurn(e){let t=this.playerInfo[this.turnIndex],s=this.clients[t.owner],i=(0,A.M0)(s,t.owner),r=s===this.localClient,n=e.getInt();if(n<0)this.moveHistory.push({type:"pass",playerName:i,playerIsMe:r}),this.gamePhase===f.PLAYING_MUST_EQUALIZE&&this.mode.optEqualize===v.CONTINUE_OR_SKIP?this.turnIndex=this.nextUnpassed(this.turnIndex):this.nextTurnAfterPass(t)&&this.nextTrick(),this.gamePhase=f.PLAYING;else{let s=e.getUint64(),a=this.trickTurn?BigInt(this.trickCount):e.getUint64()+s;if(this.mode.opt1Fewer2){let e=this.revolution?_.N3:_.N2;(this.trick1Fewer=!!this.trickTurn&&a>1&&n===e)?a--:n===_.Joker&&(n=e)}let o=a-s,d=this.mode.opt8&&n===_.N8,l=!1;a>=4&&this.mode.optRev&&(this.mode.optRev===p.ON_STRICT?!s:this.mode.optRev===p.ON_RELAXED?o>=4:this.mode.optRev===p.ON)&&(this.revolution=!this.revolution,this.mode.optRevEndTrick&&(d=!0)),this.trickTurn&&this.trickRank===n?this.trickTotal+=a:this.trickTotal=a,this.mode.opt4inARow&&this.trickTotal>=4&&(d=!0),this.gamePhase=f.PLAYING,this.trickTurn&&this.trickRank===n&&((-2===t.role?this.mode.optEqualizeEndTrickByScum:this.mode.optEqualizeEndTrickByOthers)&&(d=!0),!d&&this.mode.optEqualize>=v.CONTINUE_OR_SKIP&&(this.mode.optEqualize===v.FORCE_SKIP?l=!0:this.gamePhase=f.PLAYING_MUST_EQUALIZE));let c=d,h=this.revolution?_.N3:_.N2,g=this.nextUnpassed(this.turnIndex);(g===this.turnIndex||n===h&&(!this.mode.optEqualize||this.mode.optEqualizeOnlyScum&&this.scum!==g))&&(d=!0),t.discarded[n]+=o,t.discarded[_.Joker]+=s,t.discarded[_.NUM]+=a,(t.handSize-=a)||(this.penalty=!!(n===_.N2&&this.mode.optPenalizeFinal2&&o||s&&this.mode.optPenalizeFinalJoker)),this.cardCountDiscard[n]+=o,this.cardCountDiscard[_.Joker]+=s,this.cardCountDiscard[_.NUM]+=a,r&&(this.cardCountMine[n]-=o,this.cardCountMine[_.Joker]-=s,this.cardCountMine[_.NUM]-=a),this.passIndex=-1,!d&&(this.mode.optPass===u.SINGLE_TURN&&this.trickTurn?d=this.nextTurnAfterPass(t):(this.mode.optPass===u.PASS_TURN&&this.unsetPassed(),this.turnIndex=g,l&&(this.turnIndex=this.nextUnpassed(this.turnIndex)))),d?this.nextTrick(c):(this.trickRank=n,this.trickTurn++||(this.trickCount=a)),this.moveHistory.push({type:"move",playerName:i,playerIsMe:r,rank:n,base:Number(o),jokers:Number(s)})}this.resetMove(),this.setTimer(this.mode.optTurnTime)}nextTrick(e=!1){this.moveHistory.push({type:"tEnd",trick:this.trickNum,turn:this.trickTurn,move:e}),this.unsetPassed(),this.trickNum++,this.trickTurn=0}nextTurnAfterPass(e){let t=this.nextUnpassed(this.turnIndex);return t===this.turnIndex||this.passIndex<0&&this.nextUnpassed(t)===this.turnIndex?(this.turnIndex=this.passIndex<0?t:this.passIndex,this.passIndex=-1,!0):(this.turnIndex=t,e.passed=!0,!1)}nextUnpassed(e){let t=e;do++t===this.playerInfo.length&&(t=0);while(t!==e&&this.playerInfo[t].passed);return t}unsetPassed(){this.playerInfo.forEach(e=>e.passed=!1)}resetMove(){this.pendingMoveRank=this.pendingMoveRankAck=-1,this.pendingMoveBase=this.pendingMoveBaseAck=this.pendingMoveJokers=this.pendingMoveJokersAck=0}processEndRound(e){let t=e.getUint64(),s={duration:t,trickNum:this.trickNum,trickTurn:this.trickTurn,players:this.playerDiscInfo.map(e=>({...e,name:e.ownerName}))},[i]=this.playerInfo,r=this.clients[i.owner],n=this.discIndex+1,a=1+this.playerDiscInfo.length;r.updateScore(n,a),s.players.splice(this.discIndex,0,{name:r.formatName(),isMe:r===this.localClient,trickNum:this.trickNum,trickTurn:this.trickTurn,duration:t,prevRole:i.role,newRole:J(n,a)}),this.updatePlayers(),this.addHistory(s)}eliminatePlayer(e,t,s,i,r,n){if(t.trickNum=this.trickNum,t.trickTurn=this.trickTurn,t.duration=e.getUint64(),t.discarded=i.discarded,t.hand=z(e),r!==this.localClient)for(let e=0;e<=_.NUM;e++)this.cardCountDiscard[e]+=t.hand[e];t.prevRole=i.role,n&&(this.gamePhase===f.GIVE_CARDS?(this.pres===s?this.giveFlags&=-3:this.vicePres===s&&(this.giveFlags&=-2),this.checkGivePhaseEnd()):(s===this.turnIndex&&(this.gamePhase===f.PLAYING_MUST_EQUALIZE&&this.mode.optEqualize===v.CONTINUE_OR_SKIP?this.turnIndex=this.nextUnpassed(this.turnIndex):this.nextTurnAfterPass(i)&&this.nextTrick(),this.gamePhase=f.PLAYING),this.setTimer(this.mode.optTurnTime))),this.moveHistory.push({type:"leave",playerName:r.formatName(),playerIsMe:r===this.localClient,cards:t.hand});let a=this.playerInfo.length+this.playerDiscInfo.length,o=this.discIndex+(n||this.penalty?this.playerInfo.length:1);r.updateScore(o,a),t.newRole=J(o,a);let d=this.playerInfo.length-1;return this.turnIndex>s?this.turnIndex--:this.turnIndex===d&&(this.turnIndex=0),n?this.passIndex>s?this.passIndex--:this.passIndex===d&&(this.passIndex=0):this.passIndex=this.turnIndex,this.fixGiveIndex("givePlayerIndex",s),this.fixGiveIndex("pres",s),this.fixGiveIndex("scum",s),this.fixGiveIndex("vicePres",s),this.fixGiveIndex("highScum",s),!n}fixGiveIndex(e,t){this[e]>t?this[e]--:this[e]===t&&(this[e]=-1)}processPrivateInfoHand(e){this.cardCountMine=z(e)}processEndTurnTransfer(e){let t=e.getCN(),s=this.playerInfo[t],i=2===s.role?this.scum:this.highScum,r=this.playerInfo[i];this.giveFlags&=~s.role,this.addGivePublic(s,r,s.role),this.checkGivePhaseEnd()}addGivePublic(e,t,s){let i=this.clients[e.owner],r=this.clients[t.owner];e.handSize-=BigInt(s),t.handSize+=BigInt(s),this.moveHistory.push({type:"give_public",playerName:i.formatName(),playerIsMe:i===this.localClient,targetName:r.formatName(),targetIsMe:r===this.localClient,cardCount:s})}processEndTurnTransferDiscard(e){let t,s=e.getCN(),i=this.playerInfo[s],r=this.clients[i.owner],n=r.formatName(),a=r===this.localClient,o=e.getInt();this.updateDiscardCount(i,o),2===i.role&&this.updateDiscardCount(i,t=e.getInt()),this.giveFlags&=~i.role,this.moveHistory.push({type:"discard",playerName:n,playerIsMe:a,card0:o,card1:t}),this.checkGivePhaseEnd()}checkGivePhaseEnd(){this.giveFlags||(this.gamePhase=f.PLAYING,this.setTimer(this.mode.optTurnTime))}processPrivateInfoGive(e){let t,s=this.playerInfo[this.givePlayerIndex],i=this.clients[s.owner].formatName(),r=s.role>0===this.giveDown,n=r?1n:-1n,a=e.getInt();this.cardCountMine[this.take0=a]+=n,this.cardCountMine[_.NUM]+=n,(2===s.role||-2===s.role)&&(t=e.getInt(),this.cardCountMine[this.take1=t]+=n,this.cardCountMine[_.NUM]+=n),this.moveHistory.push({type:r?"give":"take",playerName:i,card0:a,card1:t}),this.giveDown=!0}updateDiscardCount(e,t,s=1n){e.discarded[t]+=s,e.discarded[_.NUM]+=s,this.cardCountDiscard[t]+=s,this.cardCountDiscard[_.NUM]+=s,e.owner===this.localClient.cn&&(this.cardCountMine[t]-=s,this.cardCountMine[_.NUM]-=s),e.handSize-=s}allowRank(e,t){let s=this.cardCountMine[_.Joker];if(this.trickTurn){let i=this.mode.opt1Fewer2&&this.trickCount>1,r=e===_.Joker,n=this.revolution?_.N3:_.N2,a=this.trickCount-(i&&e===n?1n:0n),o=i&&this.trickRank==n&&!this.trick1Fewer,d=o?_.Joker:this.trickRank,l=this.cardCountMine[r?n:e];return l+s>=a&&(e===d?this.mode.optEqualize!==v.DISALLOW&&(!this.mode.optEqualizeOnlyScum||t):this.gamePhase!==f.PLAYING_MUST_EQUALIZE&&(this.revolution?!o&&(e<d||r):e>d))?l==a?3:l>=a?2:1:0}let i=this.cardCountMine[e];return i+s>0&&(this.gamePhase!==f.PLAYING_MUST_3||e===_.N3)?i?3:1:0}playersSortProps=[e=>e.score,e=>e.streak,e=>-e.rankLast,e=>e.roleLast,e=>e.roleCount[4],e=>e.roleCount[3],e=>e.roleCount[2],e=>e.roleCount[1],e=>e.roleCount[0]]}function J(e,t){if(1===e)return 2;if(e===t)return -2;if(t>=4){if(2===e)return 1;if(e===t-1)return -1}return 0}function $(){return[0n,0n,0n,0n,0n,0n,0n,0n,0n,0n,0n,0n,0n,0n,0n]}function V(e,t){let s=4n*e;return[s,s,s,s,s,s,s,s,s,s,s,s,s,BigInt(t)*e,BigInt(52+t)*e]}function z(e){let t=Array.from({length:_.NUM},()=>e.getUint64());return t.push(t.reduce((e,t)=>e+t,0n)),t}(l=f||(f={}))[l.GIVE_CARDS=0]="GIVE_CARDS",l[l.PLAYING=1]="PLAYING",l[l.PLAYING_MUST_3=2]="PLAYING_MUST_3",l[l.PLAYING_MUST_EQUALIZE=3]="PLAYING_MUST_EQUALIZE",(c=_||(_={}))[c.N3=0]="N3",c[c.N4=1]="N4",c[c.N5=2]="N5",c[c.N6=3]="N6",c[c.N7=4]="N7",c[c.N8=5]="N8",c[c.N9=6]="N9",c[c.N10=7]="N10",c[c.FJack=8]="FJack",c[c.FQueen=9]="FQueen",c[c.FKing=10]="FKing",c[c.Ace=11]="Ace",c[c.N2=12]="N2",c[c.Joker=13]="Joker",c[c.NUM=14]="NUM";let B=[["Scum","danger"],["High-Scum","warning"],["∅","secondary"],["Vice-President","success"],["President","primary"]];function Y(e){return B[e+2][0]}function q(e,t){return`badge text-bg-${t?"":"outline-"}${B[e+2][1]}`}var H=k.from_html("<span> </span>"),j=k.from_html("<!> ",1),K=k.from_html("<span> </span>"),W=k.from_html("<span> <!> <!></span>");function Q(e,t){k.push(t,!0);var s=W(),i=k.child(s),r=k.sibling(i),n=e=>{var s=j(),i=k.first_child(s),r=e=>{var s=k.text();k.template_effect(e=>k.set_text(s,e),[()=>Y(t.prevRole)]),k.append(e,s)};k.if(i,e=>{t.prevRole&&e(r)});var n=k.sibling(i);k.template_effect(()=>k.set_text(n,` ${t.prevRole<t.newRole?"➚":"➘"}`)),k.append(e,s)};k.if(r,e=>{t.prevRole!=t.newRole&&e(n)});var a=k.sibling(r,2),o=e=>{var s=K(),i=k.child(s,!0);k.reset(s),k.template_effect((e,t)=>{k.set_class(s,1,e),k.set_text(i,t)},[()=>k.clsx(q(t.newRole,t.isMe)),()=>Y(t.newRole)]),k.append(e,s)};k.if(a,e=>{(t.prevRole!=t.newRole||t.newRole)&&e(o)}),k.reset(s),k.template_effect(e=>{k.set_class(s,1,e),k.set_text(i,`${t.name??""} `)},[()=>k.clsx(q(t.prevRole,t.isMe))]),k.append(e,s),k.pop()}var Z=k.from_html(' <div class="d-inline-block"> <!> </div>',1),X=k.from_html('<li class="list-group-item"><div> <!></div></li>'),ee=k.from_html('<li class="list-group-item">No past games!</li>'),et=k.from_html('<ul class="list-group list-group-flush overflow-auto" style="max-height: 15rem"></ul>'),es=k.from_html('<span class="badge text-bg-light"> </span><!>,',1),ei=k.from_html('<div class="progress"><div class="progress-bar"></div></div>'),er=k.from_html('<div class="progress-stacked my-1"><div class="progress" style="width: 3.125%"><div class="progress-bar bg-info"></div></div> <!></div>'),en=k.from_html('<div class="progress bg-primary"></div>'),ea=k.from_html('<tr><td> </td><td class="w-100"><!></td><td> </td></tr>'),eo=k.from_html('<!> <table class="table table-sm"><tbody></tbody></table>',1);function ed(e,t){k.push(t,!0);let s=k.derived(()=>t.cards.at(-1));var i=k.comment(),r=k.first_child(i),n=e=>{let i=k.derived(()=>t.cards.length-2),r=k.derived(()=>t.cards[k.get(i)]),n=k.derived(()=>t.cards.slice(0,-2)),a=k.derived(()=>BigInt(k.get(n).filter(e=>e).reduce((e,t)=>e<t?e:t))),o=k.derived(()=>BigInt(k.get(n).reduce((e,t)=>e>t?e:t))),d=k.derived(()=>k.get(o)-k.get(a));var l=eo(),c=k.first_child(l),h=e=>{var s=es(),n=k.first_child(s),a=k.child(n,!0);k.reset(n);var o=k.sibling(n),d=e=>{var t=k.text();k.template_effect(()=>k.set_text(t,` \xd7${k.get(r)??""}`)),k.append(e,t)};k.if(o,e=>{k.get(r)>1&&e(d)}),k.next(),k.template_effect(()=>k.set_text(a,t.ranks[k.get(i)])),k.append(e,s)};k.if(c,e=>{k.get(r)&&e(h)});var g=k.sibling(c),p=k.sibling(g),u=k.child(p);k.each(u,21,()=>k.get(n),k.index,(e,s,i)=>{var r=k.comment(),n=k.first_child(r),o=e=>{var r=ea(),n=k.child(r),o=k.child(n,!0);k.reset(n);var l=k.sibling(n),c=k.child(l),h=e=>{var t=er(),i=k.sibling(k.child(t),2),r=e=>{var t=ei();k.template_effect(e=>k.set_style(t,`width:${e??""}%`),[()=>Number((BigInt(k.get(s))-k.get(a))*96875n/k.get(d))/1e3]),k.append(e,t)};k.if(i,e=>{k.get(s)>k.get(a)&&e(r)}),k.reset(t),k.append(e,t)},g=e=>{var t=en();k.append(e,t)};k.if(c,e=>{k.get(d)?e(h):e(g,!1)}),k.reset(l);var p=k.sibling(l),u=k.child(p,!0);k.reset(p),k.reset(r),k.template_effect(()=>{k.set_text(o,t.ranks[i]),k.set_text(u,k.get(s))}),k.append(e,r)};k.if(n,e=>{k.get(s)&&e(o)}),k.append(e,r)}),k.reset(u),k.reset(p),k.template_effect(()=>k.set_text(g,` ${k.get(s)??""} total.   `)),k.append(e,l)};k.if(r,e=>{k.get(s)&&e(n)}),k.append(e,i),k.pop()}var el=s(146),ec=s(147),eh=s(135),eg=s(142),ep=k.from_html('and <span class="badge text-bg-light"> </span>',1),eu=k.from_html(' <span class="badge text-bg-light"> </span> <!> <span class="badge text-bg-outline-secondary"> </span>)',1),ev=k.from_html(" <!>",1),em=k.from_html('played <span class="badge text-bg-light"> </span><!>.',1),ef=k.from_html(" <span> </span>.",1),e_=k.from_html('and <span class="badge text-bg-light"> </span>',1),ek=k.from_html('discarded <span class="badge text-bg-light"> </span> <!>.',1),eN=k.from_html("left, discarding <!>",1),eI=k.from_html("<span> </span> <!>",1),eb=k.from_html("<div><!></div> ",1),eE=k.from_html('<b>Move History</b> <label class="form-check d-inline-block"><input type="checkbox" class="form-check-input"/> <span class="form-check-label">compact</span></label> <div class="overflow-auto" style="max-height: 20rem"></div>',1);let eM=["3","4","5","6","7","8","9","10","J","Q","K","A","2","*","Total"];var eR=k.from_html("<!> <!>",1),eT=k.from_html(' <span class="badge text-bg-light"> </span> <!>',1),ex=k.from_html('<span class="badge text-bg-dark">REVOLUTION ON</span>'),ey=k.from_html('<span class="badge text-bg-outline-dark">OFF REVOLUTION</span>'),eC=k.from_html('and <span class="badge text-bg-light"> </span>',1),eA=k.from_html("<option> </option>"),eP=k.from_html('<select class="form-select"></select>'),eS=k.from_html('<div>You got <span class="badge text-bg-light"> </span> <!> </div> <div class="input-group my-2"><!> <!> <button>Give</button></div>',1),eO=k.from_html("<p>The Scum gave the two highest cards to the President, who must choose two cards to give back.</p>"),ew=k.from_html("<p>The High-Scum gave the highest card to the Vice-President, who must choose a card to give back.</p>"),eU=k.from_html('<div class="my-2"><!> <!> <!></div>'),eD=k.from_html("<span>PASS</span>"),eL=k.from_html("<span> </span> <!> <span> </span>",1),eF=k.from_html("<button> </button>"),eG=k.from_html('<div class="alert alert-success">You will pass.</div>'),eJ=k.from_html('<div class="alert alert-danger">You cannot pass when starting a trick.</div>'),e$=k.from_html('<div class="col">Base Cards <input type="number"/> <input type="range" class="form-range"/></div>'),eV=k.from_html('<div class="col">Jokers <input type="number"/> <input type="range" class="form-range"/></div>'),ez=k.from_html('<!>   <!> <div class="alert alert-success">You will make this move.</div>',1),eB=k.from_html('<div class="alert alert-danger">You cannot make this move. <!></div>'),eY=k.from_html(`<div class="my-2 text-center">Your move: <!></div> <div class="btn-group d-flex my-2" role="group"><button>Pass</button> <!> <!> <!></div> <div class="my-2"><small>Legend:
            can play <span class="badge text-bg-outline-primary">all cards</span>, <span class="badge text-bg-outline-success">leftover cards</span>, <span class="badge text-bg-outline-info">need jokers</span>, <span class="badge text-bg-outline-secondary">using jokers</span> cannot play <span class="badge text-bg-outline-warning">have cards</span>, <span class="badge text-bg-outline-danger">no cards</span></small></div> <!> <div class="col-12 mb-2"><button class="btn btn-primary d-block w-100 mb-2">End Move</button></div>`,1),eq=k.from_html('<div class="my-2"><label class="form-check d-inline-block"><input type="checkbox" class="form-check-input"/> <span class="form-check-label">Your hand:</span></label> <!></div> <!>',1),eH=k.from_html('<li><span class="badge text-bg-outline-success">IN</span></li>'),ej=k.from_html("<span>MOVE</span>"),eK=k.from_html("<span>OUT</span>"),eW=k.from_html("<!> <li><span> </span> <!> <!> <!></li>",1),eQ=k.from_html("<li>No players!</li>"),eZ=k.from_html("<li> <!> </li>"),eX=k.from_html("<li>No leavers yet!</li>"),e0=k.from_html("Played Cards <!>",1),e1=k.from_html("<!> <!>",1),e2=k.from_html("<p> </p>"),e3=k.from_html('<div class="mb-2"><!></div> <div class="row"><div class="col-12"><div class="mb-2 text-center"> <!> <!></div> <!></div> <div class="col-sm-4"><b>Active Players</b> <ol class="list-unstyled"></ol> <b>Done Players</b> <ol class="list-unstyled"></ol></div> <div class="col-12 col-sm-8"><!></div> <div class="col mt-2"><!></div></div> <div> </div> <b>Lobby</b> <!>',1);k.delegate(["click","change"]);var e4=s(108),e6=k.from_html('<!> <div class="input-group mb-3"><span class="input-group-text flex-grow-1"><label class="form-check mx-auto"><input type="checkbox" class="form-check-input"/> Show Detailed Card Count</label></span></div> <!> <!> <div class="row"><div class="col-12 col-xl-8"><!> <!></div> <div class="col-12 col-xl-4 mb-3"><!></div></div>',1);(0,s(102).A)(function(e,t){let s;k.push(t,!0);let i=new I.Ay,r=new G(i),n=k.derived(()=>r.room),a=k.derived(()=>r.canReset),o=k.derived(()=>r.pastGames),d=k.derived(()=>r.leaderboard),l=k.derived(()=>r.localClient),c=k.derived(()=>r.roundState),h=(0,e4.C)("game/mp/_shared/name",""),g=(0,e4.C)("game/mp/_shared/cardCount",!0);var p=e6(),u=k.first_child(p);(0,M.A)(u,{onchange:()=>r.sendRename(h.value),get value(){return h.value},set value($$value){h.value=$$value}});var v=k.sibling(u,2),m=k.child(v),C=k.child(m),P=k.child(C);k.remove_input_defaults(P),k.next(),k.reset(C),k.reset(m),k.reset(v);var S=k.sibling(v,2);k.bind_this((0,x.A)(S,{gameId:"president-ftmxqwcwukyisw4waewyua",roomType:"PresidentRoom",get gameRoom(){return r.room},onJoinedRoom:e=>r.enterGame(e,h.value),formatGameMode:e=>w((0,T.e)(O,e)),get roomCreateOptions(){return O}}),e=>s=e,()=>s);var U=k.sibling(S,2);{let e=k.derived(()=>k.get(c)===y.mk.INTERMISSION);(0,R.A)(U,{get inGame(){return k.get(n)},get isActive(){return r.localClient.active},get canReady(){return k.get(e)},get isReady(){return r.localClient.ready},onActive:()=>r.sendActive(),onReady:()=>r.sendReady(),onDisconnect:()=>(r.leaveGame(),s.refreshRooms()),children:(e,t)=>{var s,i,n,a,o,d,l,c,h,p,u,v,m,N,I,b,E,M,R,T,x,C,P,S,O,U,D,L,F,G,J,$,V,z;let B,j,K,W,Z,X,ee,et,es,ei,er,en,ea,eo;s={get gameState(){return r},get showCardCount(){return g.value}},k.push(s,!0),B=k.prop(s,"gameState",7),j=k.derived(()=>B().localClient),K=k.derived(()=>B().roundState),W=k.derived(()=>B().playerInfo),Z=k.derived(()=>B().turnIndex),X=k.derived(()=>B().playing),ee=k.derived(()=>B().canMove),et=k.derived(()=>B().playerDiscInfo),es=k.derived(()=>B().moveHistory),ei=k.derived(()=>B().gamePhase),er=k.derived(()=>B().trickTurn),en=k.derived(()=>B().trickCount),ea=k.state(!1),i=e3(),n=k.first_child(i),a=k.child(n),o=e=>{var t=k.text("Waiting for players…");k.append(e,t)},d=e=>{var t=eR(),s=k.first_child(t),i=e=>{var t=k.text("Intermission:");k.append(e,t)},r=e=>{var t=k.comment(),s=k.first_child(t),i=e=>{var t=k.text("Make a move:");k.append(e,t)},r=e=>{var t=k.comment(),s=k.first_child(t),i=e=>{var t=k.text("Waiting for others to move…");k.append(e,t)},r=e=>{var t=k.text("Spectating:");k.append(e,t)};k.if(s,e=>{k.get(j).inRound?e(i):e(r,!1)},!0),k.append(e,t)};k.if(s,e=>{k.get(ee)?e(i):e(r,!1)},!0),k.append(e,t)};k.if(s,e=>{k.get(K)===y.mk.INTERMISSION?e(i):e(r,!1)});var n=k.sibling(s,2);(0,eh.A)(n,{get startTime(){return B().roundTimerStart},get endTime(){return B().roundTimerEnd},get active(){return B().room}}),k.append(e,t)},k.if(a,e=>{k.get(K)===y.mk.WAITING?e(o):e(d,!1)}),k.reset(n),l=k.sibling(n,2),c=k.child(l),h=k.child(c),p=k.child(h),u=k.sibling(p),v=e=>{var t=eT(),s=k.first_child(t),i=k.sibling(s),r=k.child(i,!0);k.reset(i);var n=k.sibling(i),a=k.sibling(n),o=e=>{var t=k.text("-1");k.append(e,t)};k.if(a,e=>{B().trick1Fewer&&e(o)}),k.template_effect(()=>{k.set_text(s,`Move ${k.get(er)??""}: `),k.set_text(r,eM[B().trickRank]),k.set_text(n,` \xd7${k.get(en)??""}`)}),k.append(e,t)},m=e=>{var t=k.text("Move 0");k.append(e,t)},k.if(u,e=>{k.get(er)?e(v):e(m,!1)}),N=k.sibling(u,2),I=e=>{var t=k.comment(),s=k.first_child(t),i=e=>{var t=ex();k.append(e,t)},r=e=>{var t=ey();k.append(e,t)};k.if(s,e=>{B().revolution?e(i):e(r,!1)}),k.append(e,t)},k.if(N,e=>{B().mode.optRev&&e(I)}),k.reset(h),b=k.sibling(h,2),E=e=>{let t=k.derived(()=>k.get(ea)?ed:el.A);var s=eq(),i=k.first_child(s),r=k.child(i),n=k.child(r);k.remove_input_defaults(n),k.next(2),k.reset(r);var a=k.sibling(r,2);k.component(a,()=>k.get(t),(e,t)=>{t(e,{get ranks(){return eM},get cards(){return B().cardCountMine}})}),k.reset(i);var o=k.sibling(i,2),d=e=>{let t=k.derived(()=>2&B().giveFlags&&B().pres>=0),s=k.derived(()=>1&B().giveFlags&&B().vicePres>=0),i=k.derived(()=>k.get(t)&&k.get(W)[B().pres].owner===k.get(j).cn),r=k.derived(()=>k.get(s)&&k.get(W)[B().vicePres].owner===k.get(j).cn);var n=eU(),a=k.child(n),o=e=>{let t=k.derived(()=>B().cardCountMine[B().give0]&&(k.get(r)||B().cardCountMine[B().give1]&&!(B().give0===B().give1&&B().cardCountMine[B().give0]<2)));var s=eS(),n=k.first_child(s),a=k.sibling(k.child(n)),o=k.child(a,!0);k.reset(a);var d=k.sibling(a,2),l=e=>{var t=eC(),s=k.sibling(k.first_child(t)),i=k.child(s,!0);k.reset(s),k.template_effect(()=>k.set_text(i,eM[B().take1])),k.append(e,t)};k.if(d,e=>{k.get(i)&&e(l)});var c=k.sibling(d);k.reset(n);var h=k.sibling(n,2);{let e,s=(e,t=k.noop)=>{var s=eP();k.each(s,21,()=>({length:_.NUM}),k.index,(e,t,s)=>{let i=k.derived(()=>B().cardCountMine[s]);var r=k.comment(),n=k.first_child(r),a=e=>{var t=eA(),r=k.child(t);k.reset(t),t.value=t.__value=s,k.template_effect(()=>k.set_text(r,`${eM[s]??""} (${k.get(i)??""})`)),k.append(e,t)};k.if(n,e=>{k.get(i)&&e(a)}),k.append(e,r)}),k.reset(s),k.bind_select_value(s,()=>B()[t()],e=>B()[t()]=e),k.append(e,s)};var g=k.child(h);s(g,()=>"give0");var p=k.sibling(g,2),u=e=>{s(e,()=>"give1")};k.if(p,e=>{k.get(i)&&e(u)});var v=k.sibling(p,2);v.__click=()=>B().sendMoveTransfer(B().give0,B().give1),k.reset(h),k.template_effect(()=>e=k.set_class(v,1,`btn btn-${k.get(t)?"primary":"outline-secondary"}`,null,e,{disabled:!k.get(t)}))}k.template_effect(()=>{k.set_text(o,eM[B().take0]),k.set_text(c,` from the ${k.get(i)?"Scum":"High-Scum"}. Give back ${k.get(i)?"two cards":"a card"}:`)}),k.append(e,s)};k.if(a,e=>{(k.get(i)||k.get(r))&&e(o)});var d=k.sibling(a,2),l=e=>{var t=eO();k.append(e,t)};k.if(d,e=>{k.get(t)&&e(l)});var c=k.sibling(d,2),h=e=>{var t=ew();k.append(e,t)};k.if(c,e=>{k.get(s)&&e(h)}),k.reset(n),k.append(e,n)},l=e=>{var t=k.comment(),s=k.first_child(t),i=e=>{let t=k.derived(()=>B().pendingMoveRank<0),s=k.derived(()=>-2===k.get(W)[k.get(Z)].role),i=k.derived(()=>k.get(t)?k.get(er):B().allowRank(B().pendingMoveRank,k.get(s))),r=k.derived(()=>k.get(i)?"":"outline-"),n=k.derived(()=>B().revolution?_.N3:_.N2),a=k.derived(()=>B().mode.opt1Fewer2&&k.get(er)&&k.get(en)>1);var o=eY(),d=k.first_child(o),l=k.sibling(k.child(d)),c=e=>{var t=eD();k.template_effect(()=>k.set_class(t,1,`badge text-bg-${k.get(er)?"":"outline-"}danger`)),k.append(e,t)},h=e=>{let t=k.derived(()=>B().pendingMoveRankAck===_.Joker?k.get(n):B().pendingMoveRankAck);var s=eL(),a=k.first_child(s),o=k.child(a,!0);k.reset(a);var d=k.sibling(a),l=k.sibling(d),c=e=>{var t=k.text();k.template_effect(()=>k.set_text(t,`+${B().pendingMoveJokersAck??""}`)),k.append(e,t)};k.if(l,e=>{B().pendingMoveJokersAck&&e(c)});var h=k.sibling(l,2),g=k.child(h,!0);k.reset(h),k.template_effect(()=>{k.set_class(a,1,`badge text-bg-${k.get(r)??""}light`),k.set_text(o,eM[k.get(t)]),k.set_text(d,` \xd7${B().pendingMoveBaseAck??""}`),k.set_class(h,1,`badge text-bg-outline-${k.get(i)?"success":"danger"}`),k.set_text(g,k.get(i)?"OK":"INVALID")}),k.append(e,s)};k.if(l,e=>{B().pendingMoveRankAck<0?e(c):e(h,!1)}),k.reset(d);var g=k.sibling(d,2);{let e,i=(e,t=k.noop)=>{let i,r=k.derived(()=>t()==_.Joker?k.get(n):t()),o=k.derived(()=>B().cardCountMine[k.get(r)]);var d=eF();d.__click=()=>(B().setPendingRank(t(),k.get(o),t()===k.get(n)),B().sendMove());var l=k.child(d);k.reset(d),k.template_effect(e=>{i=k.set_class(d,1,`fw-bold w-100 btn btn-${B().pendingMoveRankAck===t()?"":"outline-"}${e??""}`,null,i,{active:B().pendingMoveRank===t()}),k.set_text(l,`${eM[k.get(r)]??""}${k.get(a)&&t()===k.get(n)?"-":""}`)},[()=>(k.get(o)?["warning","info","success","primary"]:["danger","secondary"])[B().allowRank(t(),k.get(s))]]),k.append(e,d)};var p=k.child(g);p.__click=()=>(B().pendingMoveRank=-1,B().sendMove());var u=k.sibling(p,2),v=e=>{i(e,()=>_.Joker)};k.if(u,e=>{k.get(a)&&B().revolution&&e(v)});var m=k.sibling(u,2);k.each(m,17,()=>({length:_.Joker}),k.index,(e,t,s)=>{i(e,()=>s)});var N=k.sibling(m,2),I=e=>{i(e,()=>_.Joker)};k.if(N,e=>{k.get(a)&&!B().revolution&&e(I)}),k.reset(g),k.template_effect(()=>e=k.set_class(p,1,`fw-bold w-100 btn btn-${B().pendingMoveRankAck<0?"":"outline-"}${k.get(er)?"danger":"secondary"}`,null,e,{active:k.get(t)}))}var b=k.sibling(g,4),E=e=>{var t=k.comment(),s=k.first_child(t),i=e=>{var t=eG();k.append(e,t)},r=e=>{var t=eJ();k.append(e,t)};k.if(s,e=>{k.get(er)?e(i):e(r,!1)}),k.append(e,t)},M=e=>{var t=k.comment(),s=k.first_child(t),r=e=>{let t=k.derived(()=>B().pendingMoveRank===_.Joker?k.get(n):B().pendingMoveRank),s=k.derived(()=>k.get(a)&&B().pendingMoveRank===k.get(n)),i=k.derived(()=>B().cardCountMine[k.get(t)]),r=k.derived(()=>B().cardCountMine[_.Joker]),o=k.derived(()=>k.get(en)-(k.get(s)?1n:0n)),d=k.derived(()=>k.get(er)?k.get(o):1n),l=k.derived(()=>k.get(d)>k.get(i)?k.get(d)-k.get(i):0),c=k.derived(()=>k.get(er)&&k.get(r)>k.get(o)?k.get(o):k.get(r));var h=ez(),g=k.first_child(h),p=e=>{let t=k.derived(()=>k.get(r)&&k.get(ei)!==f.PLAYING_MUST_3?0:1),s=k.derived(()=>Number(k.get(i)));var n=k.comment(),a=k.first_child(n),o=e=>{var i=e$(),r=k.sibling(k.child(i));k.remove_input_defaults(r),r.__change=()=>B().sendMove();var n=k.sibling(r,2);k.remove_input_defaults(n),n.__change=()=>B().sendMove(),k.reset(i),k.template_effect(()=>{k.set_class(r,1,`form-control is-${B().pendingMoveBase===B().pendingMoveBaseAck?"":"in"}valid`),k.set_attribute(r,"min",k.get(t)),k.set_attribute(r,"max",k.get(s)),k.set_attribute(n,"min",k.get(t)),k.set_attribute(n,"max",k.get(s))}),k.bind_value(r,()=>B().pendingMoveBase,e=>B().pendingMoveBase=e),k.bind_value(n,()=>B().pendingMoveBase,e=>B().pendingMoveBase=e),k.append(e,i)};k.if(a,e=>{k.get(t)<k.get(s)&&e(o)}),k.append(e,n)};k.if(g,e=>{k.get(er)||e(p)});var u=k.sibling(g,2),v=e=>{let t=k.derived(()=>k.get(l).toString()),s=k.derived(()=>k.get(c).toString());var i=eV(),r=k.sibling(k.child(i));k.remove_input_defaults(r),r.__change=()=>B().sendMove();var n=k.sibling(r,2);k.remove_input_defaults(n),n.__change=()=>B().sendMove(),k.reset(i),k.template_effect(()=>{k.set_class(r,1,`form-control is-${B().pendingMoveJokers===B().pendingMoveJokersAck?"":"in"}valid`),k.set_attribute(r,"min",k.get(t)),k.set_attribute(r,"max",k.get(s)),k.set_attribute(n,"min",k.get(t)),k.set_attribute(n,"max",k.get(s))}),k.bind_value(r,()=>B().pendingMoveJokers,e=>B().pendingMoveJokers=e),k.bind_value(n,()=>B().pendingMoveJokers,e=>B().pendingMoveJokers=e),k.append(e,i)};k.if(u,e=>{k.get(l)<k.get(c)&&e(v)}),k.next(2),k.append(e,h)},o=e=>{var t=eB(),s=k.sibling(k.child(t)),i=e=>{var t=k.text("You must play 3 on the first trick.");k.append(e,t)};k.if(s,e=>{k.get(ei)===f.PLAYING_MUST_3&&e(i)}),k.reset(t),k.append(e,t)};k.if(s,e=>{k.get(i)?e(r):e(o,!1)}),k.append(e,t)};k.if(b,e=>{k.get(t)?e(E):e(M,!1)});var R=k.sibling(b,2);k.child(R).__click=()=>B().sendMoveEnd(),k.reset(R),k.append(e,o)};k.if(s,e=>{k.get(ee)&&e(i)},!0),k.append(e,t)};k.if(o,e=>{k.get(ei)===f.GIVE_CARDS?e(d):e(l,!1)}),k.bind_checked(n,()=>k.get(ea),e=>k.set(ea,e)),k.append(e,s)},k.if(b,e=>{k.get(K)===y.mk.ACTIVE&&k.get(X)&&e(E)}),k.reset(c),M=k.sibling(c,2),R=k.sibling(k.child(M),2),k.each(R,21,()=>k.get(W),k.index,(e,t,s)=>{let i=k.derived(()=>B().playerIsMe(k.get(t))),r=k.derived(()=>k.get(i)?"":"-outline");var n=eW(),a=k.first_child(n),o=e=>{var t=eH();k.append(e,t)};k.if(a,e=>{s===B().passIndex&&k.get(W).length>1&&e(o)});var d=k.sibling(a,2),l=k.child(d),c=k.child(l,!0);k.reset(l);var h=k.sibling(l,2),g=e=>{var t=ej();k.template_effect(()=>k.set_class(t,1,`badge text-bg${k.get(r)??""}-primary`)),k.append(e,t)};k.if(h,e=>{s===k.get(Z)&&e(g)});var p=k.sibling(h,2),u=e=>{var t=eK();k.template_effect(()=>k.set_class(t,1,`badge text-bg${k.get(r)??""}-danger`)),k.append(e,t)};k.if(p,e=>{k.get(t).passed&&e(u)});var v=k.sibling(p),m=k.sibling(v),f=e=>{var s,i,r;let n;s={get role(){return k.get(t).role}},n=k.prop(s,"solid",3,!1),i=H(),r=k.child(i,!0),k.reset(i),k.template_effect((e,t)=>{k.set_class(i,1,e),k.set_text(r,t)},[()=>k.clsx(q(s.role,n())),()=>Y(s.role)]),k.append(e,i)};k.if(m,e=>{k.get(t).role&&e(f)}),k.reset(d),k.template_effect(e=>{k.set_class(l,1,`badge text-bg${k.get(r)??""}-${s===k.get(Z)?"primary":"secondary"}`),k.set_text(c,e),k.set_text(v,` ${k.get(t).handSize??""} `)},[()=>B().formatPlayerName(k.get(t))]),k.append(e,n)},e=>{var t=eQ();k.append(e,t)}),k.reset(R),T=k.sibling(R,4),k.each(T,21,()=>k.get(et),k.index,(e,t,s)=>{var i=eZ(),r=k.child(i),n=k.sibling(r);Q(n,k.spread_props({get name(){return k.get(t).ownerName}},()=>k.get(t)));var a=k.sibling(n);k.reset(i),k.template_effect(e=>{k.set_text(r,`#${s+(s>=B().discIndex?1+k.get(W).length:1)}: `),k.set_text(a,` (${k.get(t).hand[_.NUM]?"left "+k.get(t).hand[_.NUM]:"won"}) on ${k.get(t).trickNum??""}:${k.get(t).trickTurn??""} in ${e??""}`)},[()=>(0,A.a3)(k.get(t).duration)]),k.append(e,i)},e=>{var t=eX();k.append(e,t)}),k.reset(T),k.reset(M),x=k.sibling(M,2),C=k.child(x),P={get moves(){return k.get(es)}},k.push(P,!0),eo=k.state(!0),S=eE(),O=k.sibling(k.first_child(S),2),U=k.child(O),k.remove_input_defaults(U),k.next(2),k.reset(O),D=k.sibling(O,2),k.each(D,21,()=>P.moves,k.index,(e,t)=>{let s;var i=eb(),r=k.first_child(i),n=k.child(r),a=e=>{var s=eu(),i=k.first_child(s),r=k.sibling(i),n=k.child(r,!0);k.reset(r);var a=k.sibling(r,2),o=e=>{var s=ep(),i=k.sibling(k.first_child(s)),r=k.child(i,!0);k.reset(i),k.template_effect(()=>k.set_text(r,eM[k.get(t).card1])),k.append(e,s)};k.if(a,e=>{void 0!=k.get(t).card1&&e(o)});var d=k.sibling(a),l=k.sibling(d),c=k.child(l,!0);k.reset(l),k.next(),k.template_effect(()=>{k.set_text(i,`(You
        ${"give"==k.get(t).type?"took":"gave"} `),k.set_text(n,eM[k.get(t).card0]),k.set_text(d,` ${"give"==k.get(t).type?"from":"to"} `),k.set_text(c,k.get(t).playerName)}),k.append(e,s)},o=e=>{var s=k.comment(),i=k.first_child(s),r=e=>{var s=k.text();k.template_effect(()=>k.set_text(s,`[${k.get(t).trick??""}:${k.get(t).turn??""} end${k.get(t).move?" by pass":""}]`)),k.append(e,s)},n=e=>{let s=k.derived(()=>k.get(t).playerIsMe?"":"-outline");var i=eI(),r=k.first_child(i),n=k.child(r,!0);k.reset(r);var a=k.sibling(r,2),o=e=>{var s=em(),i=k.sibling(k.first_child(s)),r=k.child(i,!0);k.reset(i);var n=k.sibling(i),a=e=>{var s=ev(),i=k.first_child(s),r=k.sibling(i),n=e=>{var s=k.text();k.template_effect(()=>k.set_text(s,`+${k.get(t).jokers??""}`)),k.append(e,s)};k.if(r,e=>{k.get(t).jokers&&e(n)}),k.template_effect(()=>k.set_text(i,` \xd7${k.get(t).base??""}`)),k.append(e,s)};k.if(n,e=>{(1!=k.get(t).base||k.get(t).jokers)&&e(a)}),k.next(),k.template_effect(()=>k.set_text(r,eM[k.get(t).rank])),k.append(e,s)},d=e=>{var s=k.comment(),i=k.first_child(s),r=e=>{var t=k.text("passed.");k.append(e,t)},n=e=>{var s=k.comment(),i=k.first_child(s),r=e=>{let s=k.derived(()=>k.get(t).targetIsMe?"":"-outline");var i=ef(),r=k.first_child(i),n=k.sibling(r),a=k.child(n,!0);k.reset(n),k.next(),k.template_effect(()=>{k.set_text(r,`gave ${k.get(t).cardCount??""} card${1==k.get(t).cardCount?"":"s"} to `),k.set_class(n,1,`badge text-bg${k.get(s)??""}-secondary`),k.set_text(a,k.get(t).targetName)}),k.append(e,i)},n=e=>{var s=k.comment(),i=k.first_child(s),r=e=>{var s=ek(),i=k.sibling(k.first_child(s)),r=k.child(i,!0);k.reset(i);var n=k.sibling(i,2),a=e=>{var s=e_(),i=k.sibling(k.first_child(s)),r=k.child(i,!0);k.reset(i),k.template_effect(()=>k.set_text(r,eM[k.get(t).card1])),k.append(e,s)};k.if(n,e=>{void 0!=k.get(t).card1&&e(a)}),k.next(),k.template_effect(()=>k.set_text(r,eM[k.get(t).card0])),k.append(e,s)},n=e=>{var s=k.comment(),i=k.first_child(s),r=e=>{var s=k.comment(),i=k.first_child(s),r=e=>{var s=eN(),i=k.sibling(k.first_child(s));(0,el.A)(i,{get ranks(){return eM},get cards(){return k.get(t).cards}}),k.append(e,s)},n=e=>{var t=k.text("won.");k.append(e,t)};k.if(i,e=>{k.get(t).cards[_.NUM]?e(r):e(n,!1)}),k.append(e,s)},n=e=>{var s=k.text();k.template_effect(e=>k.set_text(s,`[unknown move ${e??""}]`),[()=>JSON.stringify(k.get(t))]),k.append(e,s)};k.if(i,e=>{"leave"==k.get(t).type?e(r):e(n,!1)},!0),k.append(e,s)};k.if(i,e=>{"discard"==k.get(t).type?e(r):e(n,!1)},!0),k.append(e,s)};k.if(i,e=>{"give_public"==k.get(t).type?e(r):e(n,!1)},!0),k.append(e,s)};k.if(i,e=>{"pass"==k.get(t).type?e(r):e(n,!1)},!0),k.append(e,s)};k.if(a,e=>{"move"==k.get(t).type?e(o):e(d,!1)}),k.template_effect(()=>{k.set_class(r,1,`badge text-bg${k.get(s)??""}-primary`),k.set_text(n,k.get(t).playerName)}),k.append(e,i)};k.if(i,e=>{"tEnd"==k.get(t).type?e(r):e(n,!1)},!0),k.append(e,s)};k.if(n,e=>{"give"==k.get(t).type||"take"==k.get(t).type?e(a):e(o,!1)}),k.reset(r),k.sibling(r).nodeValue="  ",k.template_effect(()=>s=k.set_class(r,1,"",null,s,{"d-inline-block":k.get(eo)})),k.append(e,i)},e=>{k.next();var t=k.text("No moves yet!");k.append(e,t)}),k.reset(D),k.bind_checked(U,()=>k.get(eo),e=>k.set(eo,e)),k.append(C,S),k.pop(),k.reset(x),L=k.sibling(x,2),F=k.child(L),G=e=>{let t=k.derived(()=>Array.from(function*(){for(let e of k.get(W))yield[B().clients[e.owner].formatName(),e.discarded];for(let e of k.get(et))e.discarded[_.NUM]&&(yield[e.ownerName+" (used)",e.discarded]),e.hand[_.NUM]&&(yield[e.ownerName+" (hand)",e.hand])}()));var s=e1(),i=k.first_child(s);{let e=k.derived(()=>[["You",B().cardCountMine],["Others",B().cardCountOthers],["Played",B().cardCountDiscard],["Total",B().cardCountTotal]]);(0,ec.A)(i,{get ranks(){return eM},get counts(){return k.get(e)}})}var r=k.sibling(i,2),n=e=>{var s=e0(),i=k.sibling(k.first_child(s));(0,ec.A)(i,{get ranks(){return eM},get counts(){return k.get(t)}}),k.append(e,s)};k.if(r,e=>{k.get(t).length&&e(n)}),k.append(e,s)},J=e=>{var t=e2(),s=k.child(t);k.reset(t),k.template_effect(()=>k.set_text(s,`You: ${B().cardCountMine[_.NUM]??""}, Others: ${B().cardCountOthers[_.NUM]??""}, Played: ${B().cardCountDiscard[_.NUM]??""}`)),k.append(e,t)},k.if(F,e=>{s.showCardCount?e(G):e(J,!1)}),k.reset(L),k.reset(l),$=k.sibling(l,2),V=k.child($),k.reset($),z=k.sibling($,4),(0,eg.A)(z,{get localClient(){return B().localClient},get inGame(){return B().roundPlayers},get inQueue(){return B().roundPlayerQueue},get spectators(){return B().spectators}}),k.template_effect(e=>{k.set_text(p,`Trick ${B().trickNum??""} `),k.set_text(V,`Game Mode: ${e??""}`)},[()=>w(B().mode)]),k.append(e,i),k.pop()},$$slots:{default:!0}})}var D=k.sibling(U,2),L=k.child(D),F=k.child(L);(0,b.A)(F,{get canClear(){return k.get(o).length},onClear:()=>r.clearHistory(),children:(e,t)=>{var s,i;s={get results(){return k.get(o)}},k.push(s,!0),i=et(),k.each(i,21,()=>s.results,k.index,(e,t)=>{var s=X(),i=k.child(s),r=k.child(i),n=k.sibling(r);k.each(n,17,()=>k.get(t).players,k.index,(e,t,s)=>{k.next();var i=Z(),r=k.first_child(i);r.nodeValue="  ";var n=k.sibling(r),a=k.child(n);a.nodeValue=`#${s+1} `;var o=k.sibling(a);Q(o,k.spread_props(()=>k.get(t)));var d=k.sibling(o);k.reset(n),k.template_effect(e=>k.set_text(d,` (on ${k.get(t).trickNum??""}:${k.get(t).trickTurn??""} in ${e??""})`),[()=>(0,A.a3)(k.get(t).duration)]),k.append(e,i)}),k.reset(i),k.reset(s),k.template_effect(e=>k.set_text(r,`Turn ${k.get(t).trickNum??""}:${k.get(t).trickTurn??""} in ${e??""}: `),[()=>(0,A.a3)(k.get(t).duration)]),k.append(e,s)},e=>{var t=ee();k.append(e,t)}),k.reset(i),k.append(e,i),k.pop()},$$slots:{default:!0}});var J=k.sibling(F,2);(0,E.A)(J,{get leaderboard(){return k.get(d)},get localClient(){return k.get(l)},get inGame(){return k.get(n)},get canReset(){return k.get(a)},onReset:()=>r.sendReset(),columns:[["Score",e=>e.score],["Streak",e=>e.streak],["Last",e=>e.rankLast?`${e.rankLast} (${Y(e.roleLast)})`:"N/A"],["President",e=>e.roleCount[4]],["VP",e=>e.roleCount[3]],["Neutral",e=>e.roleCount[2]],["HS",e=>e.roleCount[1]],["Scum",e=>e.roleCount[0]]]}),k.reset(L);var $=k.sibling(L,2),V=k.child($);(0,N.A)(V,{get chatState(){return i},get canSend(){return r.room},onInput:e=>(0,I.Oo)(r,e)}),k.reset($),k.reset(D),k.bind_checked(P,()=>g.value,e=>g.value=e),k.append(e,p),k.pop()})}},n={};function a(e){var t=n[e];if(void 0!==t)return t.exports;var s=n[e]={exports:{}};return r[e](s,s.exports,a),s.exports}a.m=r,a.d=(e,t)=>{for(var s in t)a.o(t,s)&&!a.o(e,s)&&Object.defineProperty(e,s,{enumerable:!0,get:t[s]})},a.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),a.r=e=>{"u">typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},e=[],a.O=(t,s,i,r)=>{if(s){r=r||0;for(var n=e.length;n>0&&e[n-1][2]>r;n--)e[n]=e[n-1];e[n]=[s,i,r];return}for(var o=1/0,n=0;n<e.length;n++){for(var[s,i,r]=e[n],d=!0,l=0;l<s.length;l++)(!1&r||o>=r)&&Object.keys(a.O).every(e=>a.O[e](s[l]))?s.splice(l--,1):(d=!1,r<o&&(o=r));if(d){e.splice(n--,1);var c=i();void 0!==c&&(t=c)}}return t},a.rv=()=>"1.7.3",t={99:0},a.O.j=e=>0===t[e],s=(e,s)=>{var i,r,[n,o,d]=s,l=0;if(n.some(e=>0!==t[e])){for(i in o)a.o(o,i)&&(a.m[i]=o[i]);if(d)var c=d(a)}for(e&&e(s);l<n.length;l++)r=n[l],a.o(t,r)&&t[r]&&t[r][0](),t[r]=0;return a.O(c)},(i=self.webpackChunkvwww=self.webpackChunkvwww||[]).forEach(s.bind(null,0)),i.push=s.bind(null,i.push.bind(i)),a.ruid="bundler=rspack@1.7.3";var o=a.O(void 0,["14","21","37","22","44","36","40"],()=>a(153));o=a.O(o)})();