(()=>{"use strict";var e,t,s,a,n={219:function(e,t,s){var a,n,i,r;class o{x=0;y=0;xe=0;ye=0;constructor(){this.reset()}reset(){this.x=0,this.y=0,this.xe=0,this.ye=0}move(e){let t=Math.pow(.001,e/1e3);this.xe*=t,this.ye*=t}setServerLocation(e,t){this.xe+=this.x-e,this.ye+=this.y-t,this.x=e,this.y=t}}class c extends o{respawn(e){this.x=e?l:d,this.y=g,this.xe=0,this.ye=0}}class h extends o{name="";color="#7f0";score=0;ping=-1;respawn(e){this.reset(),this.x=e?l:d}}let l=.45,d=1.55,g=.5;(i=a||(a={}))[i.IN_PLAY=0]="IN_PLAY",i[i.WIN=1]="WIN",i[i.LOSS=2]="LOSS";class p{status=a.IN_PLAY;p1=new h;p2=new h;ball=new c;smoothDelay=1e3;hasServerOpponent=!1;constructor(){this.p1.respawn(!0),this.p2.respawn(!1),this.ball.respawn(!0)}update(e){this.smoothDelay=(4*this.smoothDelay+e)/5,e&&(this.ball.move(e),this.p1.move(e),this.p2.move(e))}getP1(){return this.p1}getP2(){return this.p2}getBall(){return this.ball}getStatus(){return this.status}getSmoothDelay(){return this.smoothDelay}getFPS(){return 1e3/Math.max(this.smoothDelay,.5)}hasOpponent(){return this.hasServerOpponent}setName(e){this.p1.name=e}setColor(e){this.p1.color=e}processServerDisconnect(){this.p1.ping=this.p2.ping=-1}processServerWelcome(e,t){this.p1.color=e,this.p1.name=t}processServerState(e,t,s,a,n,i){this.p1.setServerLocation(e,t),this.p2.setServerLocation(s,a),this.ball.setServerLocation(n,i)}processServerEnter(e,t){this.hasServerOpponent=!0,this.p1.score=this.p2.score=0,this.p2.color=e,this.p2.name=t}processServerLeave(){this.hasServerOpponent=!1}processServerWin(){this.p1.score++,this.status=a.WIN}processServerLose(){this.p2.score++,this.status=a.LOSS}processServerRoundStart(e){this.p1.respawn(!0),this.p2.respawn(!1),this.ball.respawn(e),this.status=a.IN_PLAY}processServerPingTimes(e,t){this.p1.ping=e,this.p2.ping=t}}function m(e){return"#"+("00000"+e.toString(16)).slice(-6)}(r=n||(n={}))[r.Connecting=0]="Connecting",r[r.Connected=1]="Connected",r[r.Disconnecting=2]="Disconnecting",r[r.Disconnected=3]="Disconnected",s(129);class u{game;state=n.Disconnected;connection;lastKeySent=-1;constructor(e){this.game=e}isConnected(){return this.readyState()!==n.Disconnected}readyState(){return this.state}connect(){this.disconnect(),this.state=n.Connecting;let e=e=>{console.log(e),this.disconnected()};PlayerIO.authenticate("slime-fd3iliszksmlav83stww","public",{userId:"guest"},{},t=>{this.state=n.Connected,t.multiplayer.developmentServer="localhost:8184";let s=()=>{t.multiplayer.createJoinRoom("$service-room$","match",!1,null,null,e=>{this.connection=e,e.addMessageCallback("m",t=>{a(t.getString(0)),e.disconnect()})},e)},a=a=>{t.multiplayer.createJoinRoom(a,"slime",!0,null,null,e=>{this.connection=e,e.addDisconnectCallback(()=>{this.game.processServerLeave(),s()}),e.addMessageCallback("welcome",e=>{let t=m(0xffffff&e.getUInt(0)),s=e.getString(1);this.game.processServerWelcome(t,s)}),e.addMessageCallback("s",e=>{let t=e.getByteArray(0),s=(t[1]<<8|t[2])/65535,a=(t[3]<<8|t[4])/65535,n=2-(t[7]<<8|t[8])/65535,i=(t[9]<<8|t[10])/65535,r=(t[13]<<8|t[14])/65535*2,o=(t[15]<<8|t[16])/65535;this.game.processServerState(s,a,n,i,r,o)}),e.addMessageCallback("enter",e=>{let t=m(0xffffff&e.getUInt(0)),s=e.getString(1);this.game.processServerEnter(t,s),this.lastKeySent=-1}),e.addMessageCallback("win",()=>this.game.processServerWin()),e.addMessageCallback("lose",()=>this.game.processServerLose()),e.addMessageCallback("nextRound",e=>this.game.processServerRoundStart(e.getBoolean(0))),e.addMessageCallback("t",e=>{this.game.processServerPingTimes(e.getUInt(0),e.getUInt(1))}),e.addMessageCallback("p",t=>e.sendMessage(t));let t=this.game.getUserName(),a=this.game.getUserColor();e.send("init",a,t)},e)};s()},e),this.game.processServerConnect()}disconnect(){this.connection&&(this.state=n.Disconnecting,this.connection.addDisconnectCallback(()=>this.disconnected()),this.connection.disconnect())}update(){if(!this.connection||!this.game.shouldSendNetworkUpdate())return;let e=this.game.getKeyFlags();this.lastKeySent!==e&&this.connection.send("k",e)}disconnected(){this.state=n.Disconnected,this.connection=void 0,this.game.processServerDisconnect()}}class f{x=Math.random();y=Math.random();vx=Math.floor(7*Math.random()-3)/800*.06;vy=Math.floor(3*Math.random()+1)/400*.06;rgb=0x1000000*Math.random()|0;a=.6*Math.random()+.1;blurSize=(Math.floor(10*Math.random())+5)/2/800;scale=.7*Math.random()+.3}class v{fancy;constructor(e=40){this.fancy=Array.from({length:e},()=>new f)}update(e){if(e)for(let t=0;t<this.fancy.length;++t)this.fancy[t].x+=this.fancy[t].vx*e,this.fancy[t].y+=this.fancy[t].vy*e,(this.fancy[t].x<-.0375||this.fancy[t].x>1.0375)&&(this.fancy[t].x%=1.075),this.fancy[t].x<-.0375&&(this.fancy[t].x+=1.075),this.fancy[t].y>.875&&(this.fancy[t].y-=.95)}draw(e,t,s){e.save(),e.globalCompositeOperation="screen";for(let a=0;a<this.fancy.length;++a){let{x:n,y:i,a:r,blurSize:o,scale:c}=this.fancy[a],h=this.fancy[a].rgb>>16,l=this.fancy[a].rgb>>8&255,d=255&this.fancy[a].rgb;e.beginPath(),e.arc(n*t,i*s,.0375*c*t,0,2*Math.PI),e.closePath(),e.filter="blur("+o*c*t+"px)",e.fillStyle="rgba("+h+","+l+","+d+","+r+")",e.fill()}e.restore()}}class w{game;getNetStatus;drawFancyBackground=!1;drawDev=!1;flipP1=!1;fancy=new v;constructor(e,t){this.game=e,this.getNetStatus=t}draw(e){let t,s=e.canvas.height,i=2*s;if(this.drawClear(e,i,s),this.drawFancyBackground&&this.fancy.draw(e,i,s),!this.game)return;this.drawFloor(e,i,s),this.drawNet(e,i,s),this.drawBall(e,i,s);let r=this.game.getP1(),o=this.game.getP2();switch(this.drawSlimer(e,i,s,r.x+r.xe,r.y+r.ye,r.color,r.name,!1),this.game.hasOpponent()&&(this.drawSlimer(e,i,s,o.x+o.xe,o.y+o.ye,o.color,o.name,!0),this.drawPing(e,i,s,r.ping,!this.flipP1),this.drawPing(e,i,s,o.ping,this.flipP1)),this.drawDev&&(this.drawBall(e,i,s,!0),this.drawSlimer(e,i,s,r.x,r.y,r.color,r.name,!1,!0),this.drawSlimer(e,i,s,o.x,o.y,o.color,o.name,!0,!0)),this.drawScore(e,i,s,r.score,o.score),this.getNetStatus()){case n.Connecting:t="Connecting";break;case n.Connected:this.game.hasOpponent()?this.game.getStatus()===a.WIN?t="You won the round!":this.game.getStatus()===a.LOSS&&(t="You lost the round!"):t="Waiting for opponent";break;case n.Disconnecting:t="Disconnecting";break;case n.Disconnected:t="Disconnected"}t&&this.drawStatus(e,i,s,t),this.drawFPS(e,i,s)}drawClear(e,t,s){let a=e.createRadialGradient(t/2,s/2,0,t/2,s/2,s);a.addColorStop(0,"#0df"),a.addColorStop(1,"#26b"),e.fillStyle=a,e.fillRect(0,0,t,s)}drawFloor(e,t,s){e.fillStyle="#999",e.fillRect(0,.8*s,t,s)}drawNet(e,t,s){e.fillStyle="#fff",e.fillRect(.495*t,.625*s,.01*t,.2*s)}drawBall(e,t,s,n){let i=this.game.getBall(),r=i.x,o=i.y;if(n||(r+=i.xe,o+=i.ye),this.flipP1&&(r=2-r),o=1-o-.2,e.beginPath(),e.arc(r*s,o*s,.03*s,0,2*Math.PI),e.closePath(),n){e.lineWidth=2,e.strokeStyle="red",e.stroke();return}e.fillStyle=this.game.getStatus()===a.WIN?"#0f0":this.game.getStatus()===a.LOSS?"red":"#ff0",e.fill()}drawSlimer(e,t,s,a,n,i,r,o,c){let h=this.game.getBall();if(this.flipP1&&(a=2-a),n=1-n-.2,e.beginPath(),e.arc(a*s,n*s,.1*s,0,Math.PI,!0),e.closePath(),c){e.lineWidth=2,e.strokeStyle="red",e.stroke();return}e.fillStyle=i,e.fill();let l=a+(this.flipP1!==o?-.0535:.0535),d=n-.0525;e.beginPath(),e.arc(l*s,d*s,.0175*s,0,2*Math.PI,!0),e.closePath(),e.fillStyle="#fff",e.fill();let g=(this.flipP1?2-(h.x+h.xe):h.x+h.xe)-l,p=1-(h.y+h.ye)-.2-d,m=g*g+p*p;if(m>25e-6){let e=.005/Math.sqrt(m);l+=g*e,d+=p*e}else l=h.x+h.xe,d=h.y+h.ye;e.beginPath(),e.arc(l*s,d*s,.01*s,0,2*Math.PI,!0),e.closePath(),e.fillStyle="#000",e.fill(),r&&(e.font=.0225*t+"px Verdana, sans-serif",e.textAlign="center",e.fillStyle="#ccc",e.fillText(r,a*s,(n-.05-.1)*s))}drawScore(e,t,s,a,n){e.font=.05*t+"px sans-serif",e.textAlign="center",e.fillStyle="#fd0",e.fillText(a+"",(this.flipP1?.92:.08)*t,.15*s),e.fillText(n+"",(this.flipP1?.08:.92)*t,.15*s)}drawStatus(e,t,s,a){e.font=.04*t+"px sans-serif",e.textAlign="center",e.fillStyle="#ddd",e.fillText(a,.5*t,.15*s)}drawFPS(e,t,s){if(!this.game)return;let a=this.game.getFPS();e.font=.02*t+"px monospace",e.textAlign="left",e.fillStyle="#fa0",e.fillText(Math.round(a)+" fps",.01*t,.97*s)}drawPing(e,t,s,a,n){a<0||(e.font=.02*t+"px monospace",e.textAlign=n?"left":"right",e.fillStyle="#fa0",e.fillText(a+" ms",(n?.01:.99)*t,.85*s))}}function S(e){return document.getElementById(e)}class y{canvas;animationCallback;context;lastGameTime=Date.now();constructor(e,t){this.canvas=e,this.animationCallback=t,this.context=e.getContext("2d"),window.requestAnimationFrame(()=>this.drawFrame()),document.addEventListener("fullscreenchange",()=>this.resize()),window.addEventListener("resize",()=>this.resize()),this.resize()}getCanvas(){return this.canvas}getContext(){return this.context}resize(){if(window.innerWidth===window.screen.width&&window.innerHeight===window.screen.height)this.canvas.width=Math.min(window.innerWidth,2*window.innerHeight),this.canvas.height=Math.min(window.innerHeight,window.innerWidth/2);else{let e=this.canvas.parentNode;this.canvas.width=Math.min(e.clientWidth,2*e.clientHeight),this.canvas.height=Math.min(e.clientHeight,e.clientWidth/2)}}drawFrame(){window.requestAnimationFrame(()=>this.drawFrame());let e=Date.now(),t=e-this.lastGameTime;this.lastGameTime=e,this.animationCallback(t)}}class x{keys=new Set;on(e){this.keys.add(e)}off(e){this.keys.delete(e)}isOn(e){return this.keys.has(e)}attachListeners(e,t){e.addEventListener("keydown",e=>{this.on(e.keyCode),t()}),e.addEventListener("keyup",e=>{this.off(e.keyCode),t()})}}class k{x=0;y=0;valid=!1;isValid(){return this.valid}getX(){return this.x}getY(){return this.y}attachListeners(e){e.addEventListener("mousemove",t=>this.movestart(t.clientX,t.clientY,e)),e.addEventListener("touchmove",t=>this.touchmove(t,e)),e.addEventListener("mouseleave",()=>this.movestop()),e.addEventListener("touchend",()=>this.movestop()),e.addEventListener("touchcancel",()=>this.movestop())}movestart(e,t,s){var a,n;this.x=(a=(e-s.getBoundingClientRect().left)/s.width,0>a?0:a<1?a:1),this.y=(n=(t-s.getBoundingClientRect().top)/s.height,0>n?0:n<1?n:1),this.valid=!0}movestop(){this.valid=!1}touchmove(e,t){if(e.targetTouches.length<1)return;e.preventDefault();let s=e.targetTouches.item(0);s&&this.movestart(s.clientX,s.clientY,t)}}class C{keyManager=new x;keyFlags=0;keyFlagsFlip=0;mouseManager=new k;getKeyFlags(e){return e?this.keyFlagsFlip:this.keyFlags}getMouse(){return this.mouseManager}attachListeners(e){this.keyManager.attachListeners(e,()=>this.updateKeyFlags())}KeyL(){return this.keyManager.isOn(37)||this.keyManager.isOn(65)}KeyU(){return this.keyManager.isOn(38)||this.keyManager.isOn(87)}KeyR(){return this.keyManager.isOn(39)||this.keyManager.isOn(68)}updateKeyFlags(){let e=+!!this.KeyL(),t=+!!this.KeyR(),s=+!!this.KeyU();this.keyFlags=e|t<<1|s<<2,this.keyFlagsFlip=t|e<<1|s<<2}}class b{game;$canvas=S("gameCanvas");$pName=S("pName");$pColor=S("pColor");$connect=S("connect");$flipP1=S("flipP1");$notFlipP1=S("notFlipP1");$background=S("background");$devMode=S("devMode");$fullscreen=S("fullscreen");canvasGame=new y(this.$canvas,e=>this.game.processUIupdate(e));input=new C;constructor(e){this.game=e,this.input.attachListeners(window),S("connect").addEventListener("click",()=>this.game.processUIconnect()),S("fullscreen").addEventListener("click",()=>{this.$fullscreen.checked=!1,this.canvasGame.getCanvas().requestFullscreen()}),this.$pName.addEventListener("change",()=>{let e=this.$pName.value;this.game.processUIchangeName(e),window.localStorage.n=e}),this.$pColor.addEventListener("change",()=>{let e=this.$pColor.value;this.game.processUIchangeColor(m(parseInt(e,16))),window.localStorage.c=e}),this.$flipP1.addEventListener("change",()=>{let e=this.$flipP1.checked;this.game.processUIchangeFlipP1(e),window.localStorage.f=e?"1":"0"}),this.$notFlipP1.addEventListener("change",()=>{let e=!this.$notFlipP1.checked;this.game.processUIchangeFlipP1(e),window.localStorage.f=e?"1":"0"}),this.$background.addEventListener("change",()=>{let e=this.$background.checked;this.game.processUIchangeFancyBackground(e),window.localStorage.b=e?"1":"0"}),this.$devMode.addEventListener("change",()=>{let e=this.$devMode.checked;this.game.processUIchangeDrawDev(e),window.localStorage.d=e?"1":"0"})}getContext(){return this.canvasGame.getContext()}getUserName(){return this.$pName.value}getUserColor(){let e=parseInt(this.$pColor.value,16);return Number.isNaN(e)?7864064:0xffffff&e}setUserName(e){this.$pName.value=e}setUserColor(e){this.$pColor.value=e}getInputManager(){return this.input}restoreSettings(){window.localStorage.n&&this.game.processUIchangeName(this.$pName.value=window.localStorage.n),window.localStorage.c&&this.game.processUIchangeColor(m(this.$pColor.value=window.localStorage.c)),"1"===window.localStorage.f&&this.game.processUIchangeFlipP1(this.$flipP1.checked=!0),"1"===window.localStorage.b&&this.game.processUIchangeFancyBackground(this.$background.checked=!0),"1"===window.localStorage.d&&this.game.processUIchangeDrawDev(this.$devMode.checked=!0)}processServerConnect(){this.$pName.disabled=!0,this.$pColor.disabled=!0,this.$connect.innerHTML="Disconnect",this.$connect.className="btn btn-danger"}processServerDisconnect(){this.$pName.disabled=!1,this.$pColor.disabled=!1,this.$connect.innerHTML="Connect",this.$connect.className="btn btn-primary"}}class P{game=new p;ui=new b(this);net=new u(this);gameDrawer=new w(this.game,()=>this.net.readyState());constructor(){this.ui.restoreSettings()}processUIupdate(e){this.game.update(e),this.net.update(),this.gameDrawer.fancy.update(e),this.gameDrawer.draw(this.ui.getContext())}processUIconnect(){this.net.isConnected()?this.net.disconnect():this.net.connect()}processUIchangeName(e){this.net.isConnected()||this.game.setName(e)}processUIchangeColor(e){this.net.isConnected()||this.game.setColor(e)}processUIchangeFlipP1(e){this.gameDrawer.flipP1=e}processUIchangeFancyBackground(e){this.gameDrawer.drawFancyBackground=e}processUIchangeDrawDev(e){this.gameDrawer.drawDev=e}getUserName(){return this.ui.getUserName()}getUserColor(){return this.ui.getUserColor()}getKeyFlags(){let e=this.gameDrawer.flipP1,t=this.ui.getInputManager().getKeyFlags(e),s=this.ui.getInputManager().getMouse();if(s.isValid()){let a=s.getX();e&&(a=1-a);let n=Math.min(Math.max(2*a,0),1),i=.45>s.getY(),r=this.game.getP1().x;!(3&t)&&Math.abs(r-n)>.05&&(t|=r<n?2:1),i&&(t|=4)}return t}shouldSendNetworkUpdate(){return this.game.hasOpponent()}processServerConnect(){this.ui.processServerConnect()}processServerDisconnect(){this.game.processServerDisconnect(),this.ui.processServerDisconnect()}processServerWelcome(e,t){this.game.processServerWelcome(e,t)}processServerState(e,t,s,a,n,i){this.game.processServerState(e,t,s,a,n,i)}processServerEnter(e,t){this.game.processServerEnter(e,t)}processServerLeave(){this.game.processServerLeave()}processServerWin(){this.game.processServerWin()}processServerLose(){this.game.processServerLose()}processServerRoundStart(e){this.game.processServerRoundStart(e)}processServerPingTimes(e,t){this.game.processServerPingTimes(e,t)}}document.addEventListener("DOMContentLoaded",()=>{new P})}},i={};function r(e){var t=i[e];if(void 0!==t)return t.exports;var s=i[e]={exports:{}};return n[e](s,s.exports,r),s.exports}r.m=n,r.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),e=[],r.O=(t,s,a,n)=>{if(s){n=n||0;for(var i=e.length;i>0&&e[i-1][2]>n;i--)e[i]=e[i-1];e[i]=[s,a,n];return}for(var o=1/0,i=0;i<e.length;i++){for(var[s,a,n]=e[i],c=!0,h=0;h<s.length;h++)(!1&n||o>=n)&&Object.keys(r.O).every(e=>r.O[e](s[h]))?s.splice(h--,1):(c=!1,n<o&&(o=n));if(c){e.splice(i--,1);var l=a();void 0!==l&&(t=l)}}return t},r.rv=()=>"1.5.8",t={111:0},r.O.j=e=>0===t[e],s=(e,s)=>{var a,n,[i,o,c]=s,h=0;if(i.some(e=>0!==t[e])){for(a in o)r.o(o,a)&&(r.m[a]=o[a]);if(c)var l=c(r)}for(e&&e(s);h<i.length;h++)n=i[h],r.o(t,n)&&t[n]&&t[n][0](),t[n]=0;return r.O(l)},(a=self.webpackChunkvwww=self.webpackChunkvwww||[]).forEach(s.bind(null,0)),a.push=s.bind(null,a.push.bind(a)),r.ruid="bundler=rspack@1.5.8";var o=r.O(void 0,["35"],function(){return r(219)});o=r.O(o)})();