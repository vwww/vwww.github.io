"use strict";(self.webpackChunkvwww=self.webpackChunkvwww||[]).push([["40"],{140(e,t,s){s.d(t,{JK:()=>h,qh:()=>l,vE:()=>o});var r=s(2),i=s(138),n=s(139),a=s(141);class o{#e=r.state(-1);get cn(){return r.get(this.#e)}set cn(e){r.set(this.#e,e,!0)}#t=r.state("unnamed");get name(){return r.get(this.#t)}set name(e){r.set(this.#t,e,!0)}#s=r.state(!1);get active(){return r.get(this.#s)}set active(e){r.set(this.#s,e,!0)}#r=r.state(0);get rank(){return r.get(this.#r)}set rank(e){r.set(this.#r,e,!0)}#i=r.state(-1);get ping(){return r.get(this.#i)}set ping(e){r.set(this.#i,e,!0)}formatName(){return`${this.name} (${this.cn})`}processJoin(e,t){this.cn=e,this.ping=t.getInt(),this.name=(0,i.iw)(t.getString(20))}readWelcome(e){let t=e.getInt();this.active=!!(1&t),this.name=(0,i.iw)(e.getString(20)),this.ping=t>>1}}class l{#n;get canReset(){return r.get(this.#n)}set canReset(e){r.set(this.#n,e)}chat;PROTOCOL_VERSION=0;#a=r.state();get room(){return r.get(this.#a)}set room(e){r.set(this.#a,e,!0)}localClient;clients=[];#o=r.state(r.proxy([]));get leaderboard(){return r.get(this.#o)}set leaderboard(e){r.set(this.#o,e,!0)}#l=r.state(r.proxy([]));get spectators(){return r.get(this.#l)}set spectators(e){r.set(this.#l,e,!0)}constructor(e){this.chat=e,this.localClient=this.newClient(),this.#n=r.derived(()=>this.room&&this.localClient.canResetScore()),setTimeout(i.yn,100)}setupGame(e){this.room?.disconnect(),this.room=e,e.registerRecv(t=>{if(this.room===e){let e=new n.k(t);try{for(;e.remaining>0;){let t=e.getInt(),s=this.MESSAGE_HANDLERS[t];if(!s)throw Error("tag type "+t);s.call(this,e)}}catch(t){console.error("neterr",t),console.log(e.debugBuf,e),this.room.disconnect()}}}),e.registerDisc(()=>{this.room===e?(this.chat.addSysMessage("You disconnected."),this.room=void 0):this.chat.addSysMessage("You disconnected from the old room.")}),this.chat.addSysMessage("You are joining the game.")}leaveGame(){this.room?.disconnect()}sendf(e,...t){this.room?.send(new a.U().putFmt(e,...t).toArray())}updatePlayers(){this.leaderboard=(0,i.yh)(this.clients,this.playersSortProps)}processWelcome(e){let t=e.getInt();t!==this.PROTOCOL_VERSION&&alert(`different protocol version (client: ${this.PROTOCOL_VERSION}, server: ${t})
refresh the page for updates?`),this.clients.length=0;let s=e.getCN();this.processWelcomeMode(e);for(let t=0;t<=i.iq;t++){let t=e.getCN();if(t<0)break;let r=t===s?this.localClient:this.newClient();r.cn=t,r.readWelcome(e),this.clients[t]=r}this.processWelcomeGame(e),this.spectators=this.clients.filter(e=>!e.active),this.updatePlayers()}processJoin(e){let t=e.getCN();if(this.clients[t])throw Error("invalid join cn "+t);let s=this.newClient();s.processJoin(t,e),this.clients[t]=s,this.chat.playerJoined(s.formatName()),this.updatePlayers()}processLeave(e){let t=e.getCN(),s=this.clients[t];if(!s)throw Error("invalid leave cn "+t);s.active&&this.playerDeactivated(s),this.chat.playerLeft(s.formatName()),delete this.clients[t],this.updatePlayers()}processReset(e){let t=e.getCN(),s=this.clients[t];if(!s)throw Error("invalid reset cn "+t);s.resetScore(),this.updatePlayers(),this.chat.playerReset(s.formatName())}processRename(e){let t=e.getCN(),s=(0,i.iw)(e.getString(20)),r=this.clients[t];if(!r)throw Error("invalid rename cn "+t);this.chat.playerRename(r.formatName(),s),r.name=s}processPing(e){this.sendPong(e.getInt())}processPingTime(e){for(let t=0;t<=i.iq;t++){let t=e.getCN();if(t<0)break;let s=e.getInt(),r=this.clients[t];if(!r)throw Error("invalid ping cn "+t);r.ping=s}}processChat(e){let t=e.getCN(),s=e.getInt(),r=1==(3&s)?e.getInt():-1,n=e.getString(100),a=this.clients[t],o=(0,i.M0)(a,t),l=this.clients[r],h=l?l===this.localClient?"you":(0,i.M0)(l,r):void 0;this.chat.addChatMessage(o,n,s,h)}processActive(e){let t=e.getCN(),s=this.clients[t];if(!s)throw Error("invalid active cn "+t);if(s.active=!s.active)this.playerActivated(s),this.spectators=this.spectators.filter(e=>e!==s);else{this.playerDeactivated(s);let e=0,t=this.spectators.length;for(;e<t;){let r=e+t>>>1;this.spectators[r].cn<s.cn?e=r+1:t=r}this.spectators.splice(e,0,s)}this.updatePlayers()}}function h(e){return e.slice(0,100)}},145(e,t,s){s.d(t,{$G:()=>o,Iu:()=>a,jQ:()=>h,p$:()=>l});var r=s(2),i=s(138),n=s(137);class a extends n.wG{}class o{#h=r.state(-1);get owner(){return r.get(this.#h)}set owner(e){r.set(this.#h,e,!0)}}class l{isMe;ownerName=""}class h extends n.Nd{#c=r.state(r.proxy([]));get playerInfo(){return r.get(this.#c)}set playerInfo(e){r.set(this.#c,e,!0)}#d=r.state(0);get turnIndex(){return r.get(this.#d)}set turnIndex(e){r.set(this.#d,e,!0)}#u=r.state(r.proxy([]));get playerDiscInfo(){return r.get(this.#u)}set playerDiscInfo(e){r.set(this.#u,e,!0)}discIndex=0;#p=r.derived(()=>this.playing&&this.playerIsMe(this.playerInfo[this.turnIndex]));get canMove(){return r.get(this.#p)}set canMove(e){r.set(this.#p,e)}formatPlayerName(e,t){return e?(0,i.M0)(this.clients[e.owner],e.owner):`<unknown${void 0===t?"":" pn#"+t}>`}playerIsMe(e){return e?.owner===this.localClient.cn}processWelcomeGame(e){super.processWelcomeGame(e),this.processPlayerInfos(e),this.processDiscInfos(e),this.processRoundInfo(e)}processPlayerInfos(e){let t=[];for(let s=0;s<=this.clients.length;s++){let s=e.getCN();if(s<0)break;let r=new this.PlayerInfoType;r.owner=s,this.processPlayerInfo(e,r),t.push(r)}if((this.playerInfo=t).length){if(this.turnIndex=e.getInt(),this.turnIndex<0||this.turnIndex>=t.length)throw Error("bad turnIndex")}else this.turnIndex=0}processDiscInfos(e){let t=[];for(let s=0;s<=this.clients.length;s++){let s=e.getString(20);if(!s)break;let r=e.getCN(),i=new this.PlayerDiscType;i.ownerName=`${s} (${r})`,this.processDiscInfo(e,i),t.push(i)}if((this.playerDiscInfo=t).length){if(this.discIndex=e.getInt(),this.discIndex<0||this.discIndex>this.playerDiscInfo.length)throw Error("bad discIndex")}else this.discIndex=0}processRoundStart(e){super.processRoundStart(e);let t=[];for(let s=0;s<=this.clients.length;s++){let s=e.getCN();if(s<0)break;let r=new this.PlayerInfoType;r.owner=s,t.push(r)}this.playerInfo=t,this.playerDiscInfo=[],this.turnIndex=0,this.discIndex=0,this.processRoundStartInfo(e)}processEliminateBase(e,t){let s=e.getInt(),r=this.playerInfo[s];if(!r)throw Error("invalid eliminate pn "+s);let n=new this.PlayerDiscType,a=this.clients[r.owner];if(!a)throw Error(`invalid owner ${r.owner} of pn ${s}`);n.ownerName=(0,i.M0)(a,r.owner),n.isMe=a===this.localClient;let o=this.eliminatePlayer(e,n,s,r,a,t);this.playerInfo.splice(s,1),this.playerDiscInfo.splice(this.discIndex,0,n),o&&this.discIndex++}processEliminate(e){this.processEliminateBase(e,!1)}processEliminateEarly(e){this.processEliminateBase(e,!0)}nextTurn(){++this.turnIndex==this.playerInfo.length&&(this.turnIndex=0)}}},137(e,t,s){s.d(t,{Nd:()=>h,mk:()=>i,wG:()=>l});var r,i,n=s(2),a=s(138),o=s(140);(r=i||(i={}))[r.WAITING=0]="WAITING",r[r.INTERMISSION=1]="INTERMISSION",r[r.ACTIVE=2]="ACTIVE";class l extends o.vE{#g=n.state(!1);get ready(){return n.get(this.#g)}set ready(e){n.set(this.#g,e,!0)}#f=n.state(!1);get inRound(){return n.get(this.#f)}set inRound(e){n.set(this.#f,e,!0)}readWelcome(e){super.readWelcome(e),this.ready=!1,this.inRound=!1}}class h extends o.qh{#m=n.state(n.proxy(i.WAITING));get roundState(){return n.get(this.#m)}set roundState(e){n.set(this.#m,e,!0)}#y=n.state(0);get roundTimerStart(){return n.get(this.#y)}set roundTimerStart(e){n.set(this.#y,e,!0)}#I=n.state(0);get roundTimerEnd(){return n.get(this.#I)}set roundTimerEnd(e){n.set(this.#I,e,!0)}#v=n.derived(()=>this.room&&this.localClient.active&&this.roundState==i.ACTIVE&&this.localClient.inRound);get playing(){return n.get(this.#v)}set playing(e){n.set(this.#v,e)}#w=n.state(n.proxy([]));get roundPlayers(){return n.get(this.#w)}set roundPlayers(e){n.set(this.#w,e,!0)}#x=n.state(n.proxy([]));get roundPlayerQueue(){return n.get(this.#x)}set roundPlayerQueue(e){n.set(this.#x,e,!0)}#E=n.state(n.proxy([]));get pastGames(){return n.get(this.#E)}set pastGames(e){n.set(this.#E,e,!0)}addHistory(e){this.pastGames.length>=100&&this.pastGames.pop(),this.pastGames.unshift(e)}clearHistory(){this.pastGames=[]}processWelcomeGame(e){let t=e.getInt();if(0===t)this.roundWait();else if(1===t){this.roundIntermission(e.getInt(),this.INTERMISSION_TIME);for(let t=0;t<=a.iq;t++){let t=e.getCN();if(t<0)break;let s=this.clients[t];if(!s)throw Error("invalid welcome round ready cn "+t);s.ready=!0}}else 2===t&&this.roundStart(e.getInt(),this.ROUND_TIME);let s=[];for(let t=0;t<=a.iq;t++){let t=e.getCN();if(t<0)break;let r=this.clients[t];if(!r)throw Error("invalid welcome round player cn "+t);r.inRound=!0,s.push(r)}this.roundPlayers=s;let r=[];for(let t=0;t<=a.iq;t++){let t=e.getCN();if(t<0)break;let s=this.clients[t];if(!s)throw Error("invalid welcome round queue cn "+t);r.push(s)}this.roundPlayerQueue=r}processRoundWait(e){this.roundWait()}processRoundInterm(e){this.roundIntermission(this.INTERMISSION_TIME)}processRoundStart(e){this.unsetInRound();let t=[];for(let s=0;s<=a.iq;s++){let s=e.getCN();if(s<0)break;let r=this.clients[s];if(!r)throw Error("invalid round start player cn "+s);r.inRound=!0,t.push(r)}this.roundPlayers=t,this.roundPlayerQueue=[],this.roundStart(this.ROUND_TIME)}processReady(e){let t=e.getCN(),s=this.clients[t];if(!s)throw Error("invalid ready cn "+t);s.ready=!s.ready}roundWait(){this.roundState=i.WAITING,this.unsetReady()}roundIntermission(e,t){this.roundState=i.INTERMISSION,this.setTimer(e,t),this.unsetReady()}roundStart(e,t){this.roundState=i.ACTIVE,this.setTimer(e,t),this.unsetReady()}setTimer(e,t=e){let s=Date.now()+e;this.roundTimerStart=s-Math.max(t,e),this.roundTimerEnd=s}unsetReady(){this.clients.forEach(e=>e.ready=!1)}unsetInRound(){this.clients.forEach(e=>e.inRound=!1)}playerActivated(e){this.roundPlayerQueue.push(e)}playerDeactivated(e){this.roundPlayers=this.roundPlayers.filter(t=>t!==e),this.roundPlayerQueue=this.roundPlayerQueue.filter(t=>t!==e),e.inRound=!1}}},146(e,t,s){s.d(t,{A:()=>n}),s(1);var r=s(2),i=r.from_html('<span class="badge text-bg-light"> </span><!> ',1);function n(e,t){r.push(t,!0);var s=r.comment(),n=r.first_child(s);r.each(n,17,()=>t.cards,r.index,(e,s,n)=>{var a=r.comment(),o=r.first_child(a),l=e=>{var a=r.comment(),o=r.first_child(a),l=e=>{var t=r.text();r.template_effect(()=>r.set_text(t,` ${r.get(s)??""} total.`)),r.append(e,t)},h=e=>{var a=i(),o=r.first_child(a),l=r.child(o,!0);r.reset(o);var h=r.sibling(o),c=e=>{var t=r.text();r.template_effect(()=>r.set_text(t,` \xd7${r.get(s)??""}`)),r.append(e,t)};r.if(h,e=>{r.get(s)>1&&e(c)}),r.sibling(h).nodeValue=", ",r.template_effect(()=>r.set_text(l,t.ranks[n])),r.append(e,a)};r.if(o,e=>{n+1==t.cards.length?e(l):e(h,!1)}),r.append(e,a)};r.if(o,e=>{r.get(s)&&e(l)}),r.append(e,a)}),r.append(e,s),r.pop()}},147(e,t,s){s.d(t,{A:()=>l}),s(1);var r=s(2),i=r.from_html('<th scope="col"> </th>'),n=r.from_html("<td> </td>"),a=r.from_html('<tr><th scope="row"> </th><!></tr>'),o=r.from_html('<div class="table-responsive"><table class="table table-sm"><thead><tr><th></th><!></tr></thead><tbody></tbody></table></div>');function l(e,t){var s=o(),l=r.child(s),h=r.child(l),c=r.child(h),d=r.sibling(r.child(c));r.each(d,17,()=>t.ranks,r.index,(e,t)=>{var s=i(),n=r.child(s,!0);r.reset(s),r.template_effect(()=>r.set_text(n,r.get(t))),r.append(e,s)}),r.reset(c),r.reset(h);var u=r.sibling(h);r.each(u,21,()=>t.counts,r.index,(e,t)=>{var s=a(),i=r.child(s),o=r.child(i,!0);r.reset(i);var l=r.sibling(i);r.each(l,17,()=>r.get(t)[1],r.index,(e,t)=>{var s=n(),i=r.child(s,!0);r.reset(s),r.template_effect(()=>r.set_text(i,r.get(t))),r.append(e,s)}),r.reset(s),r.template_effect(()=>r.set_text(o,r.get(t)[0])),r.append(e,s)}),r.reset(u),r.reset(l),r.reset(s),r.append(e,s)}},129(e,t,s){s.d(t,{A:()=>n}),s(1);var r=s(2),i=r.from_html('<div class="card mb-3"><div class="card-header"><h4 class="float-start">Past Games</h4> <button>Clear</button></div> <!></div>');function n(e,t){let s;var n=i(),a=r.child(n),o=r.sibling(r.child(a),2);o.__click=function(...e){t.onClear?.apply(this,e)},r.reset(a);var l=r.sibling(a,2);r.snippet(l,()=>t.children),r.reset(n),r.template_effect(()=>s=r.set_class(o,1,"btn btn-sm btn-danger float-end",null,s,{"d-none":!t.canClear})),r.append(e,n)}r.delegate(["click"])},138(e,t,s){s.d(t,{M0:()=>l,a3:()=>h,iq:()=>i,iw:()=>n,yh:()=>o,yn:()=>a});var r=s(139);let i=64;function n(e){return(e=e.replace(/[^\w ]/,"").replace(/ {2,}/," ").trim().slice(0,20))||"unnamed"}function a(){let e=new r.k(new Uint8Array([0,1,2,3,4,5,6,7]));console.log("%cMultiplayer Game Bug Report Guide","font-family:helvetica; font-size:20px"),console.log("You're probably trying to debug a network error or file a bug report for it."),console.log("If you see an error like this, your report must contain the packet values:"),console.log("example",e.debugBuf,e),console.log("In the example above, you would have to submit at least [0, 1, 2, 3, 4, 5, 6, 7] (expand stuff as needed)")}function o(e,t){let s=e.filter(e=>e).sort((e,s)=>{for(let r of t){let t=r(e),i=r(s);if(t<i)return 1;if(t>i)return -1}return e.cn-s.cn}),r=1;return s.forEach((e,i)=>{if(i){let n=s[i-1];t.some(t=>t(e)!==t(n))&&(r=i+1)}s[i].rank=r}),s.sort((e,t)=>t.active-e.active)}function l(e,t){return e?`${e.name} (${e.cn})`:`<unknown${void 0===t?"":` (${t})`}>`}function h(e){let t=Number(e%1000n);return`${e/1000n}${(t/1e3+"").slice(1)}s`}},122(e,t,s){s.d(t,{JY:()=>r});function r(e){let t="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789",s="";for(;e--;)s+=t[Math.random()*t.length|0];return s}},144(e,t,s){s.d(t,{q:()=>r});function r(e,t,s){return t>e?t:e<s?e:s}}}]);