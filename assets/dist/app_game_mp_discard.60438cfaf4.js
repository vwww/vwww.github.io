(()=>{"use strict";var e,t,s,a,r={150(e,t,s){s(1);var a,r,i,n,l,d,o=s(2),c=s(127),h=s(128),g=o.from_html('<div class="card mb-3"><div class="card-header"><h4 class="float-start">Past Games</h4> <button>Clear</button></div> <!></div>');o.delegate(["click"]);var p=s(130),m=s(131),u=s(132),v=s(133),f=s(134),_=s(139);function b(e){return(e=e.replace(/[^\w ]/,"").replace(/ {2,}/," ").trim().slice(0,20))||"unnamed"}function y(){let e=new _.k(new Uint8Array([0,1,2,3,4,5,6,7]));console.log("%cMultiplayer Game Bug Report Guide","font-family:helvetica; font-size:20px"),console.log("You're probably trying to debug a network error or file a bug report for it."),console.log("If you see an error like this, your report must contain the packet values:"),console.log("example",e.debugBuf,e),console.log("In the example above, you would have to submit at least [0, 1, 2, 3, 4, 5, 6, 7] (expand stuff as needed)")}function I(e,t){return e?`${e.name} (${e.cn})`:`<unknown${void 0===t?"":` (${t})`}>`}var x=s(141);class E{#e=o.state(-1);get cn(){return o.get(this.#e)}set cn(e){o.set(this.#e,e,!0)}#t=o.state("unnamed");get name(){return o.get(this.#t)}set name(e){o.set(this.#t,e,!0)}#s=o.state(!1);get active(){return o.get(this.#s)}set active(e){o.set(this.#s,e,!0)}#a=o.state(0);get rank(){return o.get(this.#a)}set rank(e){o.set(this.#a,e,!0)}#r=o.state(-1);get ping(){return o.get(this.#r)}set ping(e){o.set(this.#r,e,!0)}formatName(){return`${this.name} (${this.cn})`}processJoin(e,t){this.cn=e,this.ping=t.getInt(),this.name=b(t.getString(20))}readWelcome(e){let t=e.getInt();this.active=!!(1&t),this.name=b(e.getString(20)),this.ping=t>>1}}class M{#i;get canReset(){return o.get(this.#i)}set canReset(e){o.set(this.#i,e)}chat;PROTOCOL_VERSION=0;#n=o.state();get room(){return o.get(this.#n)}set room(e){o.set(this.#n,e,!0)}localClient;clients=[];#l=o.state(o.proxy([]));get leaderboard(){return o.get(this.#l)}set leaderboard(e){o.set(this.#l,e,!0)}#d=o.state(o.proxy([]));get spectators(){return o.get(this.#d)}set spectators(e){o.set(this.#d,e,!0)}constructor(e){this.chat=e,this.localClient=this.newClient(),this.#i=o.derived(()=>this.room&&this.localClient.canResetScore()),setTimeout(y,100)}setupGame(e){this.room?.disconnect(),this.room=e,e.registerRecv(t=>{if(this.room===e){let e=new _.k(t);try{for(;e.remaining>0;){let t=e.getInt(),s=this.MESSAGE_HANDLERS[t];if(!s)throw Error("tag type "+t);s.call(this,e)}}catch(t){console.error("neterr",t),console.log(e.debugBuf,e),this.room.disconnect()}}}),e.registerDisc(()=>{this.room===e?(this.chat.addSysMessage("You disconnected."),this.room=void 0):this.chat.addSysMessage("You disconnected from the old room.")}),this.chat.addSysMessage("You are joining the game.")}leaveGame(){this.room?.disconnect()}sendf(e,...t){this.room?.send(new x.U().putFmt(e,...t).toArray())}updatePlayers(){var e,t;let s,a;this.leaderboard=(e=this.clients,t=this.playersSortProps,s=e.filter(e=>e).sort((e,s)=>{for(let a of t){let t=a(e),r=a(s);if(t<r)return 1;if(t>r)return -1}return e.cn-s.cn}),a=1,s.forEach((e,r)=>{if(r){let i=s[r-1];t.some(t=>t(e)!==t(i))&&(a=r+1)}s[r].rank=a}),s.sort((e,t)=>t.active-e.active))}processWelcome(e){let t=e.getInt();t!==this.PROTOCOL_VERSION&&alert(`different protocol version (client: ${this.PROTOCOL_VERSION}, server: ${t})
refresh the page for updates?`),this.clients.length=0;let s=e.getCN();this.processWelcomeMode(e);for(let t=0;t<=64;t++){let t=e.getCN();if(t<0)break;let a=t===s?this.localClient:this.newClient();a.cn=t,a.readWelcome(e),this.clients[t]=a}this.processWelcomeGame(e),this.spectators=this.clients.filter(e=>!e.active),this.updatePlayers()}processJoin(e){let t=e.getCN();if(this.clients[t])throw Error("invalid join cn "+t);let s=this.newClient();s.processJoin(t,e),this.clients[t]=s,this.chat.playerJoined(s.formatName()),this.updatePlayers()}processLeave(e){let t=e.getCN(),s=this.clients[t];if(!s)throw Error("invalid leave cn "+t);s.active&&this.playerDeactivated(s),this.chat.playerLeft(s.formatName()),delete this.clients[t],this.updatePlayers()}processReset(e){let t=e.getCN(),s=this.clients[t];if(!s)throw Error("invalid reset cn "+t);s.resetScore(),this.updatePlayers(),this.chat.playerReset(s.formatName())}processRename(e){let t=e.getCN(),s=b(e.getString(20)),a=this.clients[t];if(!a)throw Error("invalid rename cn "+t);this.chat.playerRename(a.formatName(),s),a.name=s}processPing(e){this.sendPong(e.getInt())}processPingTime(e){for(let t=0;t<=64;t++){let t=e.getCN();if(t<0)break;let s=e.getInt(),a=this.clients[t];if(!a)throw Error("invalid ping cn "+t);a.ping=s}}processChat(e){let t=e.getCN(),s=e.getInt(),a=1==(3&s)?e.getInt():-1,r=e.getString(100),i=I(this.clients[t],t),n=this.clients[a],l=n?n===this.localClient?"you":I(n,a):void 0;this.chat.addChatMessage(i,r,s,l)}processActive(e){let t=e.getCN(),s=this.clients[t];if(!s)throw Error("invalid active cn "+t);if(s.active=!s.active)this.playerActivated(s),this.spectators=this.spectators.filter(e=>e!==s);else{this.playerDeactivated(s);let e=0,t=this.spectators.length;for(;e<t;){let a=e+t>>>1;this.spectators[a].cn<s.cn?e=a+1:t=a}this.spectators.splice(e,0,s)}this.updatePlayers()}}(a=n||(n={}))[a.WAITING=0]="WAITING",a[a.INTERMISSION=1]="INTERMISSION",a[a.ACTIVE=2]="ACTIVE";class R extends E{#o=o.state(!1);get ready(){return o.get(this.#o)}set ready(e){o.set(this.#o,e,!0)}#c=o.state(!1);get inRound(){return o.get(this.#c)}set inRound(e){o.set(this.#c,e,!0)}readWelcome(e){super.readWelcome(e),this.ready=!1,this.inRound=!1}}class S extends M{#h=o.state(o.proxy(n.WAITING));get roundState(){return o.get(this.#h)}set roundState(e){o.set(this.#h,e,!0)}#g=o.state(0);get roundTimerStart(){return o.get(this.#g)}set roundTimerStart(e){o.set(this.#g,e,!0)}#p=o.state(0);get roundTimerEnd(){return o.get(this.#p)}set roundTimerEnd(e){o.set(this.#p,e,!0)}#m=o.derived(()=>this.room&&this.localClient.active&&this.roundState==n.ACTIVE&&this.localClient.inRound);get playing(){return o.get(this.#m)}set playing(e){o.set(this.#m,e)}#u=o.state(o.proxy([]));get roundPlayers(){return o.get(this.#u)}set roundPlayers(e){o.set(this.#u,e,!0)}#v=o.state(o.proxy([]));get roundPlayerQueue(){return o.get(this.#v)}set roundPlayerQueue(e){o.set(this.#v,e,!0)}#f=o.state(o.proxy([]));get pastGames(){return o.get(this.#f)}set pastGames(e){o.set(this.#f,e,!0)}addHistory(e){this.pastGames.length>=100&&this.pastGames.pop(),this.pastGames.unshift(e)}clearHistory(){this.pastGames=[]}processWelcomeGame(e){let t=e.getInt();if(0===t)this.roundWait();else if(1===t){this.roundIntermission(e.getInt(),this.INTERMISSION_TIME);for(let t=0;t<=64;t++){let t=e.getCN();if(t<0)break;let s=this.clients[t];if(!s)throw Error("invalid welcome round ready cn "+t);s.ready=!0}}else 2===t&&this.roundStart(e.getInt(),this.ROUND_TIME);let s=[];for(let t=0;t<=64;t++){let t=e.getCN();if(t<0)break;let a=this.clients[t];if(!a)throw Error("invalid welcome round player cn "+t);a.inRound=!0,s.push(a)}this.roundPlayers=s;let a=[];for(let t=0;t<=64;t++){let t=e.getCN();if(t<0)break;let s=this.clients[t];if(!s)throw Error("invalid welcome round queue cn "+t);a.push(s)}this.roundPlayerQueue=a}processRoundWait(e){this.roundWait()}processRoundInterm(e){this.roundIntermission(this.INTERMISSION_TIME)}processRoundStart(e){this.unsetInRound();let t=[];for(let s=0;s<=64;s++){let s=e.getCN();if(s<0)break;let a=this.clients[s];if(!a)throw Error("invalid round start player cn "+s);a.inRound=!0,t.push(a)}this.roundPlayers=t,this.roundPlayerQueue=[],this.roundStart(this.ROUND_TIME)}processReady(e){let t=e.getCN(),s=this.clients[t];if(!s)throw Error("invalid ready cn "+t);s.ready=!s.ready}roundWait(){this.roundState=n.WAITING,this.unsetReady()}roundIntermission(e,t){this.roundState=n.INTERMISSION,this.setTimer(e,t),this.unsetReady()}roundStart(e,t){this.roundState=n.ACTIVE,this.setTimer(e,t),this.unsetReady()}setTimer(e,t=e){let s=Date.now()+e;this.roundTimerStart=s-Math.max(t,e),this.roundTimerEnd=s}unsetReady(){this.clients.forEach(e=>e.ready=!1)}unsetInRound(){this.clients.forEach(e=>e.inRound=!1)}playerActivated(e){this.roundPlayerQueue.push(e)}playerDeactivated(e){this.roundPlayers=this.roundPlayers.filter(t=>t!==e),this.roundPlayerQueue=this.roundPlayerQueue.filter(t=>t!==e),e.inRound=!1}}function T(e){return e.reduce((e,t)=>e+t,0)}class k extends R{}class N{#_=o.state(-1);get owner(){return o.get(this.#_)}set owner(e){o.set(this.#_,e,!0)}}class w{isMe;ownerName=""}class A extends S{#b=o.state(o.proxy([]));get playerInfo(){return o.get(this.#b)}set playerInfo(e){o.set(this.#b,e,!0)}#y=o.state(0);get turnIndex(){return o.get(this.#y)}set turnIndex(e){o.set(this.#y,e,!0)}#I=o.state(o.proxy([]));get playerDiscInfo(){return o.get(this.#I)}set playerDiscInfo(e){o.set(this.#I,e,!0)}discIndex=0;#x=o.derived(()=>this.playing&&this.playerIsMe(this.playerInfo[this.turnIndex]));get canMove(){return o.get(this.#x)}set canMove(e){o.set(this.#x,e)}formatPlayerName(e,t){return e?I(this.clients[e.owner],e.owner):`<unknown${void 0===t?"":" pn#"+t}>`}playerIsMe(e){return e?.owner===this.localClient.cn}processWelcomeGame(e){super.processWelcomeGame(e),this.processPlayerInfos(e),this.processDiscInfos(e),this.processRoundInfo(e)}processPlayerInfos(e){let t=[];for(let s=0;s<=this.clients.length;s++){let s=e.getCN();if(s<0)break;let a=new this.PlayerInfoType;a.owner=s,this.processPlayerInfo(e,a),t.push(a)}if((this.playerInfo=t).length){if(this.turnIndex=e.getInt(),this.turnIndex<0||this.turnIndex>=t.length)throw Error("bad turnIndex")}else this.turnIndex=0}processDiscInfos(e){let t=[];for(let s=0;s<=this.clients.length;s++){let s=e.getString(20);if(!s)break;let a=e.getCN(),r=new this.PlayerDiscType;r.ownerName=`${s} (${a})`,this.processDiscInfo(e,r),t.push(r)}if((this.playerDiscInfo=t).length){if(this.discIndex=e.getInt(),this.discIndex<0||this.discIndex>this.playerDiscInfo.length)throw Error("bad discIndex")}else this.discIndex=0}processRoundStart(e){super.processRoundStart(e);let t=[];for(let s=0;s<=this.clients.length;s++){let s=e.getCN();if(s<0)break;let a=new this.PlayerInfoType;a.owner=s,t.push(a)}this.playerInfo=t,this.playerDiscInfo=[],this.turnIndex=0,this.discIndex=0,this.processRoundStartInfo(e)}processEliminateBase(e,t){let s=e.getInt(),a=this.playerInfo[s];if(!a)throw Error("invalid eliminate pn "+s);let r=new this.PlayerDiscType,i=this.clients[a.owner];if(!i)throw Error(`invalid owner ${a.owner} of pn ${s}`);r.ownerName=I(i,a.owner),r.isMe=i===this.localClient;let n=this.eliminatePlayer(e,r,s,a,i,t);this.playerInfo.splice(s,1),this.playerDiscInfo.splice(this.discIndex,0,r),n&&this.discIndex++}processEliminate(e){this.processEliminateBase(e,!1)}processEliminateEarly(e){this.processEliminateBase(e,!0)}nextTurn(){++this.turnIndex==this.playerInfo.length&&(this.turnIndex=0)}}let C=[["optTurnTime","i",2e4,"Turn Time / ms","duration of each turn, in milliseconds",5e3,6e4],["optDecks","i",1,"Decks","number of decks to use",1,3]];function P({optDecks:e,optTurnTime:t}){return`${e} deck${1===e?"":"s"}, ${t} ms`}function O(e){return e?"primary":"secondary"}(r=l||(l={}))[r.WELCOME=0]="WELCOME",r[r.JOIN=1]="JOIN",r[r.LEAVE=2]="LEAVE",r[r.RESET=3]="RESET",r[r.RENAME=4]="RENAME",r[r.PING=5]="PING",r[r.PING_TIME=6]="PING_TIME",r[r.CHAT=7]="CHAT",r[r.ACTIVE=8]="ACTIVE",r[r.ROUND_WAIT=9]="ROUND_WAIT",r[r.ROUND_INTERM=10]="ROUND_INTERM",r[r.ROUND_START=11]="ROUND_START",r[r.READY=12]="READY",r[r.END_ROUND=13]="END_ROUND",r[r.MOVE_CONFIRM=14]="MOVE_CONFIRM",r[r.END_TURN=15]="END_TURN",r[r.PLAYER_ELIMINATE=16]="PLAYER_ELIMINATE",r[r.PLAYER_ELIMINATE_EARLY=17]="PLAYER_ELIMINATE_EARLY",r[r.PLAYER_PRIVATE_INFO_MY_HAND=18]="PLAYER_PRIVATE_INFO_MY_HAND",r[r.PLAYER_PRIVATE_INFO_ALT_MOVE=19]="PLAYER_PRIVATE_INFO_ALT_MOVE",r[r.PLAYER_PRIVATE_INFO_MOVE=20]="PLAYER_PRIVATE_INFO_MOVE",(i=d||(d={}))[i.RESET=0]="RESET",i[i.RENAME=1]="RENAME",i[i.PONG=2]="PONG",i[i.CHAT=3]="CHAT",i[i.ACTIVE=4]="ACTIVE",i[i.READY=5]="READY",i[i.MOVE_HAND0=6]="MOVE_HAND0",i[i.MOVE_HAND1=7]="MOVE_HAND1",i[i.MOVE_TARGET=8]="MOVE_TARGET",i[i.MOVE_GUESS=9]="MOVE_GUESS",i[i.MOVE_END=10]="MOVE_END";class D extends k{#E=o.state(0);get score(){return o.get(this.#E)}set score(e){o.set(this.#E,e,!0)}#M=o.state(0);get streak(){return o.get(this.#M)}set streak(e){o.set(this.#M,e,!0)}#R=o.state(0);get wins(){return o.get(this.#R)}set wins(e){o.set(this.#R,e,!0)}#S=o.state(0);get losses(){return o.get(this.#S)}set losses(e){o.set(this.#S,e,!0)}#T=o.state(0);get rankLast(){return o.get(this.#T)}set rankLast(e){o.set(this.#T,e,!0)}#k=o.state(0);get rankBest(){return o.get(this.#k)}set rankBest(e){o.set(this.#k,e,!0)}#N=o.state(0);get rankWorst(){return o.get(this.#N)}set rankWorst(e){o.set(this.#N,e,!0)}updateScore(e,t){this.rankLast=e,this.rankBest=Math.min(this.rankBest||e,e),this.rankWorst=Math.max(this.rankWorst,e),this.score+=t-e+1,1===e?(this.streak<0&&(this.streak=0),this.streak++,this.wins++):(this.streak>0&&(this.streak=0),this.streak--,this.losses++)}resetScore(){this.score=0,this.streak=0,this.wins=0,this.losses=0,this.rankLast=0,this.rankBest=0,this.rankWorst=0}canResetScore(){return this.rankLast}readWelcome(e){super.readWelcome(e),this.score=e.getInt(),this.streak=e.getInt(),this.wins=e.getInt(),this.losses=e.getInt(),this.rankLast=e.getInt(),this.rankBest=e.getInt(),this.rankWorst=e.getInt()}}class G extends N{#w=o.state(o.proxy([]));get discarded(){return o.get(this.#w)}set discarded(e){o.set(this.#w,e,!0)}#A=o.state(0);get discardSum(){return o.get(this.#A)}set discardSum(e){o.set(this.#A,e,!0)}#C=o.state(!1);get immune(){return o.get(this.#C)}set immune(e){o.set(this.#C,e,!0)}#P=o.state();get hand(){return o.get(this.#P)}set hand(e){o.set(this.#P,e,!0)}}class H extends w{discarded=[];discardSum=0}class $ extends A{PlayerInfoType=G;PlayerDiscType=H;#O=o.state(o.proxy((0,v.q)(C)));get mode(){return o.get(this.#O)}set mode(e){o.set(this.#O,e,!0)}#D=o.state(0);get myHand(){return o.get(this.#D)}set myHand(e){o.set(this.#D,e,!0)}#G=o.state(0);get myAltMove(){return o.get(this.#G)}set myAltMove(e){o.set(this.#G,e,!0)}#H=o.state(0);get deckSize(){return o.get(this.#H)}set deckSize(e){o.set(this.#H,e,!0)}#$=o.state(o.proxy(W()));get cardCountDiscard(){return o.get(this.#$)}set cardCountDiscard(e){o.set(this.#$,e,!0)}#L=o.state(o.proxy(W()));get cardCountRemain(){return o.get(this.#L)}set cardCountRemain(e){o.set(this.#L,e,!0)}#V=o.state(o.proxy(W()));get cardCountTotal(){return o.get(this.#V)}set cardCountTotal(e){o.set(this.#V,e,!0)}#W=o.state(o.proxy([]));get moveHistory(){return o.get(this.#W)}set moveHistory(e){o.set(this.#W,e,!0)}#U=o.state(!1);get pendingMoveUseHand(){return o.get(this.#U)}set pendingMoveUseHand(e){o.set(this.#U,e,!0)}#Y=o.state(0);get pendingMoveTarget(){return o.get(this.#Y)}set pendingMoveTarget(e){o.set(this.#Y,e,!0)}#B=o.state(0);get pendingMoveGuess(){return o.get(this.#B)}set pendingMoveGuess(e){o.set(this.#B,e,!0)}get ROUND_TIME(){return this.mode.optTurnTime}INTERMISSION_TIME=3e4;newClient(){return new D}enterGame(e,t){this.setupGame(e),this.sendf("is",this.PROTOCOL_VERSION,t)}sendReset(){this.sendf("i",d.RESET)}sendRename(e){this.sendf("is",d.RENAME,e)}sendPong(e){this.sendf("i2",d.PONG,e)}sendChat(e,t,s=-1){this.sendf("i3s",d.CHAT,t,s,e.slice(0,100))}sendActive(){this.sendf("i",d.ACTIVE)}sendReady(){this.sendf("i",d.READY)}sendMoveUseHand(e){this.sendf("i",e?d.MOVE_HAND1:d.MOVE_HAND0)}sendMoveTarget(e){this.sendf("i2",d.MOVE_TARGET,e)}sendMoveGuess(e){this.sendf("i2",d.MOVE_GUESS,e)}sendMoveEnd(){this.sendf("i",d.MOVE_END)}MESSAGE_HANDLERS={[l.WELCOME]:this.processWelcome,[l.JOIN]:this.processJoin,[l.LEAVE]:this.processLeave,[l.RESET]:this.processReset,[l.RENAME]:this.processRename,[l.PING]:this.processPing,[l.PING_TIME]:this.processPingTime,[l.CHAT]:this.processChat,[l.ACTIVE]:this.processActive,[l.ROUND_WAIT]:this.processRoundWait,[l.ROUND_INTERM]:this.processRoundInterm,[l.ROUND_START]:this.processRoundStart,[l.READY]:this.processReady,[l.END_ROUND]:this.processEndRound,[l.MOVE_CONFIRM]:this.processMoveConfirm,[l.END_TURN]:this.processEndTurn,[l.PLAYER_ELIMINATE]:this.processEliminate,[l.PLAYER_ELIMINATE_EARLY]:this.processEliminateEarly,[l.PLAYER_PRIVATE_INFO_MY_HAND]:this.processPrivateInfoMyHand,[l.PLAYER_PRIVATE_INFO_ALT_MOVE]:this.processPrivateInfoAltMove,[l.PLAYER_PRIVATE_INFO_MOVE]:this.processPrivateInfoMove};processWelcomeMode(e){var t;this.mode.optTurnTime=e.getInt(),this.mode.optDecks=(t=e.getInt(),1>t?1:t<3?t:3)}processPlayerInfo(e,t){let s=e.getInt();t.discarded=Array.from({length:Math.min(s>>1,48)},()=>e.getInt()),t.immune=!!(1&s),t.discardSum=T(t.discarded)}processDiscInfo(e,t){t.discarded=Array.from({length:Math.min(e.getInt(),48)},()=>e.getInt()),t.discardSum=T(t.discarded)}processRoundStartInfo(e){this.deckSize=16*this.mode.optDecks-this.playerInfo.length-1,this.cardCountDiscard=W(),this.cardCountRemain=U(this.mode.optDecks),this.cardCountTotal=U(this.mode.optDecks),this.moveHistory=[]}processRoundInfo(e){this.deckSize=e.getInt();let t=[e.getInt(),e.getInt(),e.getInt(),e.getInt(),e.getInt(),e.getInt(),e.getInt(),e.getInt(),0];t[8]=T(t);let s=U(this.mode.optDecks);this.cardCountDiscard=t,this.cardCountRemain=s.map((e,s)=>e-t[s]),this.cardCountTotal=s,this.moveHistory=[]}processMoveConfirm(e){let t=e.getInt();this.pendingMoveUseHand=!!(1&t),this.pendingMoveTarget=e.getInt(),this.pendingMoveGuess=t>>1}processEndTurn(e){let t=this.playerInfo[this.turnIndex],s=e.getInt(),a=e.getInt(),r=this.clients[t.owner],i=this.playerInfo[a],n=r===this.localClient,l={type:"move",playerName:I(r,t.owner),playerIsMe:n,move:s,targetName:i?I(this.clients[i.owner],i.owner):"nobody",targetIsMe:this.playerIsMe(i),targetIsPlayer:i===t,targetValid:!!i,info:0};switch(n&&s===this.myHand&&(this.myHand=this.myAltMove),t.hand===s&&(t.hand=void 0),8!==s&&(t.discarded.push(s),t.discardSum+=s,this.updateDiscardCount(s)),s){case 1:l.info=e.getInt();break;case 2:break;case 3:if(a>=0){let s=e.getInt();l.info=s,s?-7===s&&i?i.hand=8:7===s&&(t.hand=8):i&&i.hand!==t.hand&&(void 0===i.hand?i.hand=t.hand:void 0===t.hand&&(t.hand=i.hand))}break;case 4:t.immune=!0;break;case 5:{let s=e.getInt();l.info=s,8!==s&&(t.hand=void 0,t.discarded.push(s),t.discardSum+=s,this.updateDiscardCount(s),this.deckSize--);break}case 6:if(i&&!this.playerIsMe(t)&&!this.playerIsMe(i)){let e=i.hand;i.hand=t.hand,t.hand=e}}this.deckSize--,this.moveHistory.push(l),this.setTimer(this.mode.optTurnTime),this.nextTurn(),this.playerInfo[this.turnIndex].immune=!1}processEndRound(e){this.deckSize++;let t=this.playerInfo;for(let s of t)s.hand=e.getInt();let s={survived:[],eliminated:this.playerDiscInfo.map(e=>({...e,name:e.ownerName}))},a=t.length+this.playerDiscInfo.length,r=[...t].sort(L),i=1;for(let e=0;e<r.length;e++){let t=r[e];e&&L(t,r[e-1])&&(i=e+1);let n=this.clients[t.owner];s.survived.push({name:I(n,t.owner),isMe:n===this.localClient,hand:t.hand??0,rank:i,discarded:t.discarded,discardSum:t.discardSum}),n.updateScore(i,a)}this.updatePlayers(),this.addHistory(s)}eliminatePlayer(e,t,s,a,r,i){let n;i&&this.turnIndex===s&&(n=e.getInt(),a.discarded.push(n),a.discardSum+=n,this.updateDiscardCount(n),this.deckSize--);let l=e.getInt();t.discarded=[...a.discarded,l],t.discardSum=a.discardSum+l,this.updateDiscardCount(l);let d=this.playerInfo.length,o=d+this.playerDiscInfo.length;return r.updateScore(d,o),this.updatePlayers(),i&&(this.moveHistory.push({type:"leave",playerName:r.formatName(),playerIsMe:r===this.localClient,hand:l,alt:n}),this.setTimer(this.mode.optTurnTime)),this.turnIndex>s?this.turnIndex--:this.turnIndex===this.playerInfo.length-1&&(this.turnIndex=0),!1}processPrivateInfoMyHand(e){this.myHand=e.getInt()}processPrivateInfoAltMove(e){this.myAltMove=e.getInt()}processPrivateInfoMove(e){let t=e.getInt(),s=e.getInt(),a=e.getInt(),r=this.playerInfo[s],i=this.formatPlayerName(r,s);switch(t){case 2:r&&(r.hand=a),this.moveHistory.push({type:"reveal",playerName:i,hand:a});break;case 3:{let e=this.myHand;r&&(r.hand=a),this.moveHistory.push({type:"cmp",ours:e,theirs:a,playerName:i});break}case 6:{let e=this.myHand;this.moveHistory.push({type:"trade",oldHand:e,newHand:a,playerName:i}),r&&(r.hand=e),this.myHand=a}}}playersSortProps=[e=>e.score,e=>e.wins,e=>e.streak,e=>-e.rankLast,e=>-e.rankBest,e=>-e.rankWorst];updateDiscardCount(e){e--,this.cardCountDiscard[e]++,this.cardCountDiscard[8]++,this.cardCountRemain[e]--,this.cardCountRemain[8]--}}function L(e,t){return(t.hand??0)-(e.hand??0)||t.discardSum-e.discardSum}let V=[5,2,2,2,2,1,1,1,16];function W(){return[0,0,0,0,0,0,0,0,0]}function U(e){return V.map(t=>t*e)}var Y=o.from_html('<th scope="col"> </th>'),B=o.from_html("<td> </td>"),z=o.from_html('<tr><th scope="row"> </th><!></tr>'),F=o.from_html('<div class="table-responsive"><table class="table table-sm"><thead><tr><th></th><!></tr></thead><tbody></tbody></table></div>'),Q=s(135),J=s(142),j=o.from_html("<span>self</span>"),q=o.from_html("<span> </span>"),K=o.from_html("on <!>",1),X=o.from_html(" <span> </span> ",1),Z=o.from_html(' <span class="badge text-bg-light"> </span>.',1),ee=o.from_html("to become <span>IMMUNE</span>!",1),et=o.from_html("who destroys <span> </span> ",1),es=o.from_html('<span> </span> uses <span class="badge text-bg-light"> </span> <!> <!>',1),ea=o.from_html('<span class="badge text-bg-outline-secondary"> </span> has <span class="badge text-bg-light"> </span>!',1),er=o.from_html('You have <span class="badge text-bg-dark"> </span>; <span class="badge text-bg-outline-secondary"> </span> has <span class="badge text-bg-light"> </span>.',1),ei=o.from_html('<span class="badge text-bg-outline-secondary"> </span> gives you <span class="badge text-bg-dark"> </span> for your <span class="badge text-bg-light"> </span>.',1),en=o.from_html('and <span class="badge text-bg-light"> </span>',1),el=o.from_html('<span> </span> left, discarding <span class="badge text-bg-light"> </span> <!>.',1),ed=o.from_html("<li><!></li>"),eo=o.from_html("<li>No moves yet!</li>"),ec=o.from_html('<b>Move History</b> <ol class="list-unstyled overflow-auto" style="max-height: 20rem"></ol>',1);function eh(e,t){return t?["Guard (1)","Priest (2)","Baron (3)","Handmaid (4)","Prince (5)","King (6)","Countess (7)","Princess (8)"][e-1]:e<=8?e:["0b","0c","2b","3b","4b","5b","6b","7b","9b"][e-9]}var eg=o.from_html("<!> <!>",1),ep=o.from_html("<li> </li>"),em=o.from_html('<span class="badge text-bg-dark"> </span>'),eu=o.from_html("<button> </button>"),ev=o.from_html("<button> </button>"),ef=o.from_html('<div class="col-12"><div class="btn-group d-flex mb-3" role="group"><span class="input-group-text">Discard</span> <button> </button> <button> </button></div></div> <div class="col-12 col-sm-6 mb-2"><label>Target<br/> <button id="dropdownMenuButtonTarget" data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false"> </button> <div class="dropdown-menu" aria-labelledby="dropdownMenuButtonTarget"><button>auto</button> <!></div></label> <small class="form-text text-muted">1, 2, 3, 6 targets others; 5 targets any</small></div> <div class="col-12 col-sm-6 mb-3"><label>Guess<br/> <button id="dropdownMenuButtonGuess" data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false"> </button> <div class="dropdown-menu" aria-labelledby="dropdownMenuButtonGuess"><button>auto</button> <!></div></label> <small class="form-text text-muted">only for 1</small></div> <div class="col-12 mb-2"><button class="btn btn-primary d-block w-100 mb-2">End Move</button></div>',1),e_=o.from_html('<div class="col-12">Your hand: <span class="badge text-bg-dark"> </span> <!></div> <!>',1),eb=o.from_html("<span> </span>"),ey=o.from_html("<span>IMMUNE</span>"),eI=o.from_html('<span class="badge text-bg-light"> </span>'),ex=o.from_html("<li><span> </span> <span> </span> <!> <!> <!></li>"),eE=o.from_html("<li>No players!</li>"),eM=o.from_html('<span class="badge text-bg-light"> </span>'),eR=o.from_html("<li> <span> </span> <!></li>"),eS=o.from_html("<li>No eliminations yet!</li>"),eT=o.from_html('<div class="mb-2"><!></div> <div class="row"><div class="col-12 mb-3"><div class="card my-2"><div class="card-header"><h4 class="card-title"><a data-bs-toggle="collapse" href="#collapseCardDesc"><small>Card Descriptions</small></a></h4></div> <div id="collapseCardDesc" class="card-collapse collapse show"><div class="card-body"><ul></ul></div></div></div></div> <!> <div class="col-12 col-sm-4"><b>Active Players</b> <ol class="list-unstyled"></ol> <b>Eliminated</b> <ol class="list-unstyled"></ol></div> <div class="col-12 col-sm-8"><!></div> <div class="col mt-2"> <!></div></div> <div> </div> <b>Lobby</b> <!>',1);o.delegate(["click"]);var ek=o.from_html('<span class="badge text-bg-light"> </span>'),eN=o.from_html("<li> <span> </span> <span> </span> <!></li>"),ew=o.from_html('<span class="badge text-bg-light"> </span>'),eA=o.from_html("<li> <span> </span> <!></li>"),eC=o.from_html('<li class="list-group-item"><b> </b> <ol class="list-unstyled"></ol> <b> </b> <ol class="list-unstyled"></ol></li>'),eP=o.from_html('<li class="list-group-item">No past games!</li>'),eO=o.from_html('<ul class="list-group list-group-flush overflow-auto" style="max-height: 15rem"></ul>'),eD=s(108),eG=o.from_html('<!> <div class="input-group mb-3"><span class="input-group-text flex-grow-1"><label class="form-check mx-auto"><input type="checkbox" class="form-check-input"/> Show Love Letter Names</label></span> <span class="input-group-text flex-grow-1"><label class="form-check mx-auto"><input type="checkbox" class="form-check-input"/> Show Detailed Card Count</label></span></div> <!> <!> <div class="row"><div class="col-12 col-xl-8"><!> <!></div> <div class="col-12 col-xl-4 mb-3"><!></div></div>',1);(0,s(102).A)(function(e,t){let s,a;o.push(t,!0);let r=new h.Ay,i=new $(r),l=o.derived(()=>i.room),d=o.derived(()=>i.canReset),_=o.derived(()=>i.pastGames),b=o.derived(()=>i.leaderboard),y=o.derived(()=>i.localClient),I=o.derived(()=>i.roundState),x=(0,eD.C)("game/mp/_shared/name",""),E=(0,eD.C)("game/mp/discard/LL",!0),M=(0,eD.C)("game/mp/_shared/cardCount",!0);var R,S,T,k,N,w=eG(),A=o.first_child(w);(0,m.A)(A,{onchange:()=>i.sendRename(x.value),get value(){return x.value},set value($$value){x.value=$$value}});var D=o.sibling(A,2),G=o.child(D),H=o.child(G),L=o.child(H);o.remove_input_defaults(L),o.next(),o.reset(H),o.reset(G);var V=o.sibling(G,2),W=o.child(V),U=o.child(W);o.remove_input_defaults(U),o.next(),o.reset(W),o.reset(V),o.reset(D);var eH=o.sibling(D,2);o.bind_this((0,f.A)(eH,{gameId:"discard-l3z5n5wptuoeqtkytj64a",roomType:"DiscardRoom",get gameRoom(){return i.room},onJoinedRoom:e=>i.enterGame(e,x.value),formatGameMode:e=>P((0,v.e)(C,e)),get roomCreateOptions(){return C}}),e=>s=e,()=>s);var e$=o.sibling(eH,2);{let e=o.derived(()=>o.get(I)===n.INTERMISSION);(0,u.A)(e$,{get inGame(){return o.get(l)},get isActive(){return i.localClient.active},get canReady(){return o.get(e)},get isReady(){return i.localClient.ready},onActive:()=>i.sendActive(),onReady:()=>i.sendReady(),onDisconnect:()=>(i.leaveGame(),s.refreshRooms()),children:(e,t)=>{!function(e,t){o.push(t,!0);let s=o.derived(()=>t.gameState.roundState),a=o.derived(()=>t.gameState.playerInfo),r=o.derived(()=>t.gameState.turnIndex),i=o.derived(()=>t.gameState.playing),l=o.derived(()=>t.gameState.canMove),d=o.derived(()=>t.gameState.playerDiscInfo),c=o.derived(()=>t.gameState.myHand),h=o.derived(()=>t.gameState.myAltMove),g=o.derived(()=>t.gameState.deckSize),p=o.derived(()=>t.gameState.cardCountDiscard),m=o.derived(()=>t.gameState.cardCountRemain),u=o.derived(()=>t.gameState.cardCountTotal),v=o.derived(()=>t.gameState.moveHistory),f=o.derived(()=>t.gameState.pendingMoveUseHand),_=o.derived(()=>t.gameState.pendingMoveTarget),b=o.derived(()=>t.gameState.pendingMoveGuess),y=o.derived(()=>o.get(f)?o.get(c):o.get(h)),I=["","1 (5/deck)","2 (2/deck)","3 (2/deck)","4 (2/deck)","5 (2/deck)","6 (1/deck)","7 (1/deck)","8 (1/deck)"];function x(e,t){return 8===e||7===t&&(5==e||6==e)?"danger":1===e?"info":4!==e&&e<7?"primary":"secondary"}var E,M,R,S,T=eT(),k=o.first_child(T),N=o.child(k),w=e=>{var t=o.text("Waiting for players…");o.append(e,t)},A=e=>{var a=eg(),r=o.first_child(a),i=e=>{var t=o.text("Intermission:");o.append(e,t)},d=e=>{var t=o.comment(),s=o.first_child(t),a=e=>{var t=o.text("Make a move:");o.append(e,t)},r=e=>{var t=o.text("Waiting for others to move…");o.append(e,t)};o.if(s,e=>{o.get(l)?e(a):e(r,!1)},!0),o.append(e,t)};o.if(r,e=>{o.get(s)===n.INTERMISSION?e(i):e(d,!1)});var c=o.sibling(r,2);(0,Q.A)(c,{get startTime(){return t.gameState.roundTimerStart},get endTime(){return t.gameState.roundTimerEnd},get active(){return t.gameState.room}}),o.append(e,a)};o.if(N,e=>{o.get(s)===n.WAITING?e(w):e(A,!1)}),o.reset(k);var C=o.sibling(k,2),D=o.child(C),G=o.child(D),H=o.sibling(o.child(G),2),$=o.child(H),L=o.child($);o.each(L,20,()=>[1,2,3,4,5,6,7,8],o.index,(e,a)=>{let r;var d=ep(),g=o.child(d);o.reset(d),o.template_effect((e,t)=>{r=o.set_class(d,1,"",null,r,{"fw-bold":o.get(s)===n.ACTIVE&&o.get(i)&&(a===o.get(c)||o.get(l)&&a===o.get(h))}),o.set_text(g,`${e??""}: ${t??""}`)},[()=>eh(a,t.ll),()=>{var e;return e=t.ll,a<1||a>8?"unknown":["target another player and guess hand value (not 1); if correct, target discards without effect and loses (5/deck)","target another player; you look at his hand (2/deck)","target another player; compare; lower player loses (no action on tie) (2/deck)","prevent being targeted until your next turn (2/deck)","target one player (including self); target discards (with effect only for 8) and (if not 8) draws new card (2/deck)","target another player; trade cards (1/deck)",`no action, but must discard if other is ${eh(5,e)} or ${eh(6,e)} (1/deck)`,"lose (try not to discard this) (1/deck)"][a-1]}]),o.append(e,d)}),o.reset(L),o.reset($),o.reset(H),o.reset(G),o.reset(D);var V=o.sibling(D,2),W=e=>{var s=e_(),i=o.first_child(s),n=o.sibling(o.child(i)),d=o.child(n,!0);o.reset(n);var g=o.sibling(n,2),p=e=>{var s=em(),a=o.child(s,!0);o.reset(s),o.template_effect(e=>o.set_text(a,e),[()=>eh(o.get(h),t.ll)]),o.append(e,s)};o.if(g,e=>{o.get(l)&&e(p)}),o.reset(i);var m=o.sibling(i,2),u=e=>{let s,i,n,l;var d=ef(),g=o.first_child(d),p=o.child(g),m=o.sibling(o.child(p),2);m.__click=()=>t.gameState.sendMoveUseHand(!0);var u=o.child(m,!0);o.reset(m);var v=o.sibling(m,2);v.__click=()=>t.gameState.sendMoveUseHand(!1);var E=o.child(v,!0);o.reset(v),o.reset(p),o.reset(g);var M=o.sibling(g,2),R=o.child(M),S=o.sibling(o.child(R),3),T=o.child(S,!0);o.reset(S);var k=o.sibling(S,2),N=o.child(k);N.__click=()=>t.gameState.sendMoveTarget(-1);var w=o.sibling(N,2);o.each(w,17,()=>o.get(a),o.index,(e,s,a)=>{let i;var n=eu();n.__click=()=>t.gameState.sendMoveTarget(a);var l=o.child(n,!0);o.reset(n),o.template_effect(e=>{i=o.set_class(n,1,"dropdown-item",null,i,{"text-bg-danger":a===o.get(r)&&5!==o.get(y)||o.get(s).immune,active:o.get(_)===a}),o.set_text(l,e)},[()=>t.gameState.formatPlayerName(o.get(s))]),o.append(e,n)}),o.reset(k),o.reset(R),o.next(2),o.reset(M);var A=o.sibling(M,2),C=o.child(A),P=o.sibling(o.child(C),3),O=o.child(P,!0);o.reset(P);var D=o.sibling(P,2),G=o.child(D);G.__click=()=>t.gameState.sendMoveGuess(0);var H=o.sibling(G,2);o.each(H,17,()=>I.slice(2),o.index,(e,s,a)=>{let r;var i=ev();i.__click=()=>t.gameState.sendMoveGuess(a+2);var n=o.child(i,!0);o.reset(i),o.template_effect(()=>{r=o.set_class(i,1,"dropdown-item",null,r,{active:o.get(b)===a+2}),o.set_text(n,o.get(s))}),o.append(e,i)}),o.reset(D),o.reset(C),o.next(2),o.reset(A);var $=o.sibling(A,2);o.child($).__click=()=>t.gameState.sendMoveEnd(),o.reset($),o.template_effect((e,t,a,r,d)=>{s=o.set_class(m,1,`fw-bold w-100 btn btn-outline-${e??""}`,null,s,{active:o.get(f)}),o.set_text(u,t),i=o.set_class(v,1,`fw-bold w-100 btn btn-outline-${a??""}`,null,i,{active:!o.get(f)}),o.set_text(E,r),o.set_class(S,1,`btn btn-outline-${4!==o.get(y)&&7>o.get(y)?"primary":"secondary"} dropdown-toggle`),o.set_text(T,d),n=o.set_class(N,1,"dropdown-item",null,n,{active:0>o.get(_)}),o.set_class(P,1,`btn btn-outline-${1===o.get(y)?"info":"secondary"} dropdown-toggle`),o.set_text(O,o.get(b)>1?I[o.get(b)]:"auto"),l=o.set_class(G,1,"dropdown-item",null,l,{active:2>o.get(b)})},[()=>x(o.get(c),o.get(h)),()=>eh(o.get(c),t.ll),()=>x(o.get(h),o.get(c)),()=>eh(o.get(h),t.ll),()=>0>o.get(_)?"auto":t.gameState.formatPlayerName(t.gameState.playerInfo[o.get(_)],o.get(_))]),o.append(e,d)};o.if(m,e=>{o.get(l)&&e(u)}),o.template_effect(e=>o.set_text(d,e),[()=>eh(o.get(c),t.ll)]),o.append(e,s)};o.if(V,e=>{o.get(s)===n.ACTIVE&&o.get(i)&&e(W)});var U=o.sibling(V,2),ek=o.sibling(o.child(U),2);o.each(ek,21,()=>o.get(a),o.index,(e,a,i)=>{let l=o.derived(()=>t.gameState.playerIsMe(o.get(a))),d=o.derived(()=>o.get(l)?"":"-outline");var g=ex(),p=o.child(g),m=o.child(p,!0);o.reset(p);var u=o.sibling(p,2),v=o.child(u,!0);o.reset(u);var f=o.sibling(u,2),_=e=>{var s=eb(),a=o.child(s,!0);o.reset(s),o.template_effect(e=>{o.set_class(s,1,`badge text-bg${o.get(d)??""}-dark`),o.set_text(a,e)},[()=>o.get(l)?eh(o.get(h),t.ll):"?"]),o.append(e,s)};o.if(f,e=>{o.get(s)===n.ACTIVE&&i===o.get(r)&&e(_)});var b=o.sibling(f,2),y=e=>{var t=ey();o.template_effect(()=>o.set_class(t,1,`badge text-bg${o.get(d)??""}-info`)),o.append(e,t)};o.if(b,e=>{o.get(a).immune&&e(y)});var I=o.sibling(b),x=o.sibling(I);o.each(x,17,()=>o.get(a).discarded,o.index,(e,t)=>{var s=eI(),a=o.child(s,!0);o.reset(s),o.template_effect(()=>o.set_text(a,o.get(t))),o.append(e,s)}),o.reset(g),o.template_effect((e,t,s)=>{o.set_class(p,1,`badge text-bg${o.get(d)??""}-${e??""}`),o.set_text(m,t),o.set_class(u,1,`badge text-bg${o.get(d)??""}-dark`),o.set_text(v,s),o.set_text(I,` ${o.get(a).discardSum??""} `)},[()=>O(o.get(l)),()=>t.gameState.formatPlayerName(o.get(a)),()=>o.get(l)?eh(o.get(c),t.ll):o.get(a).hand?eh(o.get(a).hand,t.ll):"?"]),o.append(e,g)},e=>{var t=eE();o.append(e,t)}),o.reset(ek);var eN=o.sibling(ek,4);o.each(eN,21,()=>o.get(d),o.index,(e,s,r)=>{let i=o.derived(()=>o.get(s).isMe?"":"-outline");var n=eR(),l=o.child(n),d=o.sibling(l),c=o.child(d,!0);o.reset(d);var h=o.sibling(d),g=o.sibling(h);o.each(g,17,()=>o.get(s).discarded,o.index,(e,t)=>{var s=eM(),a=o.child(s,!0);o.reset(s),o.template_effect(()=>o.set_text(a,o.get(t))),o.append(e,s)}),o.reset(n),o.template_effect(()=>{o.set_text(l,`#${r+(r>=t.gameState.discIndex?1+o.get(a).length:1)}: `),o.set_class(d,1,`badge text-bg${o.get(i)??""}-danger`),o.set_text(c,o.get(s).ownerName),o.set_text(h,` ${o.get(s).discardSum??""} `)}),o.append(e,n)},e=>{var t=eS();o.append(e,t)}),o.reset(eN),o.reset(U);var ew=o.sibling(U,2);E=o.child(ew),M={get moves(){return o.get(v)},get ll(){return t.ll}},o.push(M,!0),R=ec(),S=o.sibling(o.first_child(R),2),o.each(S,21,()=>M.moves,o.index,(e,t)=>{var s=ed(),a=o.child(s),r=e=>{let s=o.derived(()=>o.get(t).playerIsMe?"":"-outline"),a=o.derived(()=>o.get(t).targetIsMe?"":"-outline");var r=es(),i=o.first_child(r),n=o.child(i,!0);o.reset(i);var l=o.sibling(i,2),d=o.child(l,!0);o.reset(l);var c=o.sibling(l,2),h=e=>{var r=K(),i=o.sibling(o.first_child(r)),n=e=>{var t=j();o.template_effect(()=>o.set_class(t,1,`badge text-bg${o.get(s)??""}-dark`)),o.append(e,t)},l=e=>{var s=q(),r=o.child(s,!0);o.reset(s),o.template_effect(e=>{o.set_class(s,1,`badge text-bg${o.get(a)??""}-${e??""}`),o.set_text(r,o.get(t).targetName)},[()=>O(o.get(t).targetIsMe)]),o.append(e,s)};o.if(i,e=>{o.get(t).targetIsPlayer?e(n):e(l,!1)}),o.append(e,r)};o.if(c,e=>{4!==o.get(t).move&&o.get(t).move<7&&e(h)});var g=o.sibling(c,2),p=e=>{var s=X(),a=o.first_child(s),r=o.sibling(a),i=o.child(r,!0);o.reset(r);var n=o.sibling(r,1,!0);o.template_effect(e=>{o.set_text(a,`who has ${o.get(t).info<0?"":"no"} `),o.set_class(r,1,`badge text-bg-${o.get(t).info<0?"danger":"warning"}`),o.set_text(i,e),o.set_text(n,o.get(t).info<0?"!":".")},[()=>eh(Math.abs(o.get(t).info),M.ll)]),o.append(e,s)},m=e=>{var a=o.comment(),r=o.first_child(a),i=e=>{var t=o.text("to see the hand.");o.append(e,t)},n=e=>{var a=o.comment(),r=o.first_child(a),i=e=>{var s=o.comment(),a=o.first_child(s),r=e=>{var s=Z(),a=o.first_child(s),r=o.sibling(a),i=o.child(r,!0);o.reset(r),o.next(),o.template_effect(e=>{o.set_text(a,`and ${o.get(t).info<0?"loses with":"beats"} `),o.set_text(i,e)},[()=>eh(Math.abs(o.get(t).info),M.ll)]),o.append(e,s)},i=e=>{var t=o.text("and matches hands!");o.append(e,t)};o.if(a,e=>{o.get(t).info?e(r):e(i,!1)}),o.append(e,s)},n=e=>{var a=o.comment(),r=o.first_child(a),i=e=>{var t=ee(),a=o.sibling(o.first_child(t));o.next(),o.template_effect(()=>o.set_class(a,1,`badge text-bg${o.get(s)??""}-info`)),o.append(e,t)},n=e=>{var s=o.comment(),a=o.first_child(s),r=e=>{var s=et(),a=o.sibling(o.first_child(s)),r=o.child(a,!0);o.reset(a);var i=o.sibling(a,1,!0);o.template_effect(e=>{o.set_class(a,1,`badge text-bg-${8===o.get(t).info?"danger":"light"}`),o.set_text(r,e),o.set_text(i,8===o.get(t).info?"!":" and draws.")},[()=>eh(o.get(t).info,M.ll)]),o.append(e,s)},i=e=>{var s=o.comment(),a=o.first_child(s),r=e=>{var t=o.text("to trade hands.");o.append(e,t)},i=e=>{var s=o.comment(),a=o.first_child(s),r=e=>{var t=o.text("for no effect.");o.append(e,t)},i=e=>{var s=o.comment(),a=o.first_child(s),r=e=>{var t=o.text("and lost‽");o.append(e,t)};o.if(a,e=>{8===o.get(t).move&&e(r)},!0),o.append(e,s)};o.if(a,e=>{7===o.get(t).move?e(r):e(i,!1)},!0),o.append(e,s)};o.if(a,e=>{6===o.get(t).move&&o.get(t).targetValid?e(r):e(i,!1)},!0),o.append(e,s)};o.if(a,e=>{5===o.get(t).move?e(r):e(i,!1)},!0),o.append(e,s)};o.if(r,e=>{4===o.get(t).move?e(i):e(n,!1)},!0),o.append(e,a)};o.if(r,e=>{3===o.get(t).move&&o.get(t).targetValid?e(i):e(n,!1)},!0),o.append(e,a)};o.if(r,e=>{2===o.get(t).move&&o.get(t).targetValid?e(i):e(n,!1)},!0),o.append(e,a)};o.if(g,e=>{1===o.get(t).move&&o.get(t).targetValid?e(p):e(m,!1)}),o.template_effect((e,a)=>{o.set_class(i,1,`badge text-bg${o.get(s)??""}-${e??""}`),o.set_text(n,o.get(t).playerName),o.set_text(d,a)},[()=>O(o.get(t).playerIsMe),()=>eh(o.get(t).move,M.ll)]),o.append(e,r)},i=e=>{var s=o.comment(),a=o.first_child(s),r=e=>{var s=ea(),a=o.first_child(s),r=o.child(a,!0);o.reset(a);var i=o.sibling(a,2),n=o.child(i,!0);o.reset(i),o.next(),o.template_effect(e=>{o.set_text(r,o.get(t).playerName),o.set_text(n,e)},[()=>eh(o.get(t).hand,M.ll)]),o.append(e,s)},i=e=>{var s=o.comment(),a=o.first_child(s),r=e=>{var s=er(),a=o.sibling(o.first_child(s)),r=o.child(a,!0);o.reset(a);var i=o.sibling(a,2),n=o.child(i,!0);o.reset(i);var l=o.sibling(i,2),d=o.child(l,!0);o.reset(l),o.next(),o.template_effect((e,s)=>{o.set_text(r,e),o.set_text(n,o.get(t).playerName),o.set_text(d,s)},[()=>eh(o.get(t).ours,M.ll),()=>eh(o.get(t).theirs,M.ll)]),o.append(e,s)},i=e=>{var s=o.comment(),a=o.first_child(s),r=e=>{var s=ei(),a=o.first_child(s),r=o.child(a,!0);o.reset(a);var i=o.sibling(a,2),n=o.child(i,!0);o.reset(i);var l=o.sibling(i,2),d=o.child(l,!0);o.reset(l),o.next(),o.template_effect(()=>{o.set_text(r,o.get(t).playerName),o.set_text(n,o.get(t).newHand),o.set_text(d,o.get(t).oldHand)}),o.append(e,s)},i=e=>{var s=o.comment(),a=o.first_child(s),r=e=>{let s=o.derived(()=>o.get(t).playerIsMe?"":"-outline");var a=el(),r=o.first_child(a),i=o.child(r,!0);o.reset(r);var n=o.sibling(r,2),l=o.child(n,!0);o.reset(n);var d=o.sibling(n,2),c=e=>{var s=en(),a=o.sibling(o.first_child(s)),r=o.child(a,!0);o.reset(a),o.template_effect(e=>o.set_text(r,e),[()=>eh(o.get(t).alt,M.ll)]),o.append(e,s)};o.if(d,e=>{void 0!=o.get(t).alt&&e(c)}),o.next(),o.template_effect((e,a)=>{o.set_class(r,1,`badge text-bg${o.get(s)??""}-${e??""}`),o.set_text(i,o.get(t).playerName),o.set_text(l,a)},[()=>O(o.get(t).playerIsMe),()=>eh(o.get(t).hand,M.ll)]),o.append(e,a)},i=e=>{var s=o.text();o.template_effect(e=>o.set_text(s,`[unknown move ${e??""}]`),[()=>JSON.stringify(o.get(t))]),o.append(e,s)};o.if(a,e=>{"leave"==o.get(t).type?e(r):e(i,!1)},!0),o.append(e,s)};o.if(a,e=>{"trade"===o.get(t).type?e(r):e(i,!1)},!0),o.append(e,s)};o.if(a,e=>{"cmp"===o.get(t).type?e(r):e(i,!1)},!0),o.append(e,s)};o.if(a,e=>{"reveal"===o.get(t).type?e(r):e(i,!1)},!0),o.append(e,s)};o.if(a,e=>{"move"===o.get(t).type?e(r):e(i,!1)}),o.reset(s),o.append(e,s)},e=>{var t=eo();o.append(e,t)}),o.reset(S),o.append(E,R),o.pop(),o.reset(ew);var eA=o.sibling(ew,2),eC=o.child(eA),eP=o.sibling(eC),eO=e=>{{var t,s,a,r,i,n,l;let d=o.derived(()=>[["Unplayed",o.get(m)],["Discarded",o.get(p)],["Total",o.get(u)]]);t={ranks:["1","2","3","4","5","6","7","8","Total"],get counts(){return o.get(d)}},s=F(),a=o.child(s),r=o.child(a),i=o.child(r),n=o.sibling(o.child(i)),o.each(n,17,()=>t.ranks,o.index,(e,t)=>{var s=Y(),a=o.child(s,!0);o.reset(s),o.template_effect(()=>o.set_text(a,o.get(t))),o.append(e,s)}),o.reset(i),o.reset(r),l=o.sibling(r),o.each(l,21,()=>t.counts,o.index,(e,t)=>{var s=z(),a=o.child(s),r=o.child(a,!0);o.reset(a);var i=o.sibling(a);o.each(i,17,()=>o.get(t)[1],o.index,(e,t)=>{var s=B(),a=o.child(s,!0);o.reset(s),o.template_effect(()=>o.set_text(a,o.get(t))),o.append(e,s)}),o.reset(s),o.template_effect(()=>o.set_text(r,o.get(t)[0])),o.append(e,s)}),o.reset(l),o.reset(a),o.reset(s),o.append(e,s)}};o.if(eP,e=>{t.showCardCount&&e(eO)}),o.reset(eA),o.reset(C);var eD=o.sibling(C,2),eG=o.child(eD);o.reset(eD);var eH=o.sibling(eD,4);(0,J.A)(eH,{get localClient(){return t.gameState.localClient},get inGame(){return t.gameState.roundPlayers},get inQueue(){return t.gameState.roundPlayerQueue},get spectators(){return t.gameState.spectators}}),o.template_effect(e=>{o.set_text(eC,`Draw pile count: ${o.get(g)??""} (players have ${o.get(m)[8]-o.get(g)}) `),o.set_text(eG,`Game Mode: ${e??""}`)},[()=>P(t.gameState.mode)]),o.append(e,T),o.pop()}(e,{get gameState(){return i},get ll(){return E.value},get showCardCount(){return M.value}})},$$slots:{default:!0}})}var eL=o.sibling(e$,2),eV=o.child(eL),eW=o.child(eV);R={get canClear(){return o.get(_).length},onClear:()=>i.clearHistory(),children:(e,t)=>{var s,a;s={get results(){return o.get(_)},get ll(){return E.value}},o.push(s,!0),a=eO(),o.each(a,21,()=>s.results,o.index,(e,t)=>{var a=eC(),r=o.child(a),i=o.child(r);o.reset(r);var n=o.sibling(r,2);o.each(n,21,()=>o.get(t).survived,o.index,(e,t)=>{let a=o.derived(()=>o.get(t).isMe?"":"-outline");var r=eN(),i=o.child(r),n=o.sibling(i),l=o.child(n,!0);o.reset(n);var d=o.sibling(n,2),c=o.child(d,!0);o.reset(d);var h=o.sibling(d),g=o.sibling(h);o.each(g,17,()=>o.get(t).discarded,o.index,(e,t)=>{var a=ek(),r=o.child(a,!0);o.reset(a),o.template_effect(e=>o.set_text(r,e),[()=>eh(o.get(t),s.ll)]),o.append(e,a)}),o.reset(r),o.template_effect(e=>{o.set_text(i,`#${o.get(t).rank??""}: `),o.set_class(n,1,`badge text-bg${o.get(a)??""}-${o.get(t).rank>1?"warning":"success"}`),o.set_text(l,o.get(t).name),o.set_class(d,1,`badge text-bg${o.get(a)??""}-dark`),o.set_text(c,e),o.set_text(h,` ${o.get(t).discardSum??""} `)},[()=>eh(o.get(t).hand,s.ll)]),o.append(e,r)}),o.reset(n);var l=o.sibling(n,2),d=o.child(l);o.reset(l);var c=o.sibling(l,2);o.each(c,21,()=>o.get(t).eliminated,o.index,(e,a,r)=>{let i=o.derived(()=>o.get(a).isMe?"":"-outline");var n=eA(),l=o.child(n),d=o.sibling(l),c=o.child(d,!0);o.reset(d);var h=o.sibling(d),g=o.sibling(h);o.each(g,17,()=>o.get(a).discarded,o.index,(e,t)=>{var a=ew(),r=o.child(a,!0);o.reset(a),o.template_effect(e=>o.set_text(r,e),[()=>eh(o.get(t),s.ll)]),o.append(e,a)}),o.reset(n),o.template_effect(()=>{o.set_text(l,`#${o.get(t).survived.length+r+1}: `),o.set_class(d,1,`badge text-bg${o.get(i)??""}-danger`),o.set_text(c,o.get(a).name),o.set_text(h,` ${o.get(a).discardSum??""} `)}),o.append(e,n)}),o.reset(c),o.reset(a),o.template_effect(()=>{o.set_text(i,`Survived (${o.get(t).survived.length??""}):`),o.set_text(d,`Eliminated (${o.get(t).eliminated.length??""}):`)}),o.append(e,a)},e=>{var t=eP();o.append(e,t)}),o.reset(a),o.append(e,a),o.pop()},$$slots:{default:!0}},S=g(),T=o.child(S),(k=o.sibling(o.child(T),2)).__click=function(...e){R.onClear?.apply(this,e)},o.reset(T),N=o.sibling(T,2),o.snippet(N,()=>R.children),o.reset(S),o.template_effect(()=>a=o.set_class(k,1,"btn btn-sm btn-danger float-end",null,a,{"d-none":!R.canClear})),o.append(eW,S);var eU=o.sibling(eW,2);(0,p.A)(eU,{get leaderboard(){return o.get(b)},get localClient(){return o.get(y)},get inGame(){return o.get(l)},get canReset(){return o.get(d)},onReset:()=>i.sendReset(),columns:[["Score",e=>e.score],["Win",e=>e.wins],["Loss",e=>e.losses],["Streak",e=>e.streak],["Rank Last",e=>e.rankLast],["Best",e=>e.rankBest],["Worst",e=>e.rankWorst]]}),o.reset(eV);var eY=o.sibling(eV,2),eB=o.child(eY);(0,c.A)(eB,{get chatState(){return r},get canSend(){return i.room},onInput:e=>(0,h.Oo)(i,e)}),o.reset(eY),o.reset(eL),o.bind_checked(L,()=>E.value,e=>E.value=e),o.bind_checked(U,()=>M.value,e=>M.value=e),o.append(e,w),o.pop()})},122(e,t,s){s.d(t,{JY:()=>a});function a(e){let t="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789",s="";for(;e--;)s+=t[Math.random()*t.length|0];return s}}},i={};function n(e){var t=i[e];if(void 0!==t)return t.exports;var s=i[e]={exports:{}};return r[e](s,s.exports,n),s.exports}n.m=r,n.d=(e,t)=>{for(var s in t)n.o(t,s)&&!n.o(e,s)&&Object.defineProperty(e,s,{enumerable:!0,get:t[s]})},n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),n.r=e=>{"u">typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},e=[],n.O=(t,s,a,r)=>{if(s){r=r||0;for(var i=e.length;i>0&&e[i-1][2]>r;i--)e[i]=e[i-1];e[i]=[s,a,r];return}for(var l=1/0,i=0;i<e.length;i++){for(var[s,a,r]=e[i],d=!0,o=0;o<s.length;o++)(!1&r||l>=r)&&Object.keys(n.O).every(e=>n.O[e](s[o]))?s.splice(o--,1):(d=!1,r<l&&(l=r));if(d){e.splice(i--,1);var c=a();void 0!==c&&(t=c)}}return t},n.rv=()=>"1.7.3",t={96:0},n.O.j=e=>0===t[e],s=(e,s)=>{var a,r,[i,l,d]=s,o=0;if(i.some(e=>0!==t[e])){for(a in l)n.o(l,a)&&(n.m[a]=l[a]);if(d)var c=d(n)}for(e&&e(s);o<i.length;o++)r=i[o],n.o(t,r)&&t[r]&&t[r][0](),t[r]=0;return n.O(c)},(a=self.webpackChunkvwww=self.webpackChunkvwww||[]).forEach(s.bind(null,0)),a.push=s.bind(null,a.push.bind(a)),n.ruid="bundler=rspack@1.7.3";var l=n.O(void 0,["14","21","37","22","42","36"],()=>n(150));l=n.O(l)})();