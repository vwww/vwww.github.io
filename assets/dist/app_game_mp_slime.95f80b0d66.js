(()=>{"use strict";var e,t,s,i,a={156(e,t,s){s(1);var i,a,r,n,l,o,h=s(2),c=s(108),d=s(127),u=s(128),p=s(130),g=s(131),m=s(132),f=s(133),v=s(134),y=s(122);function S(e,t,s){return t>e?t:e<s?e:s}var w=s(139);function x(e){return(e=e.replace(/[^\w ]/,"").replace(/ {2,}/," ").trim().slice(0,20))||"unnamed"}function b(){let e=new w.k(new Uint8Array([0,1,2,3,4,5,6,7]));console.log("%cMultiplayer Game Bug Report Guide","font-family:helvetica; font-size:20px"),console.log("You're probably trying to debug a network error or file a bug report for it."),console.log("If you see an error like this, your report must contain the packet values:"),console.log("example",e.debugBuf,e),console.log("In the example above, you would have to submit at least [0, 1, 2, 3, 4, 5, 6, 7] (expand stuff as needed)")}function R(e,t){return e?`${e.name} (${e.cn})`:`<unknown${void 0===t?"":` (${t})`}>`}var P=s(141);class k{#e=h.state(-1);get cn(){return h.get(this.#e)}set cn(e){h.set(this.#e,e,!0)}#t=h.state("unnamed");get name(){return h.get(this.#t)}set name(e){h.set(this.#t,e,!0)}#s=h.state(!1);get active(){return h.get(this.#s)}set active(e){h.set(this.#s,e,!0)}#i=h.state(0);get rank(){return h.get(this.#i)}set rank(e){h.set(this.#i,e,!0)}#a=h.state(-1);get ping(){return h.get(this.#a)}set ping(e){h.set(this.#a,e,!0)}formatName(){return`${this.name} (${this.cn})`}processJoin(e,t){this.cn=e,this.ping=t.getInt(),this.name=x(t.getString(20))}readWelcome(e){let t=e.getInt();this.active=!!(1&t),this.name=x(e.getString(20)),this.ping=t>>1}}class N{#r;get canReset(){return h.get(this.#r)}set canReset(e){h.set(this.#r,e)}chat;PROTOCOL_VERSION=0;#n=h.state();get room(){return h.get(this.#n)}set room(e){h.set(this.#n,e,!0)}localClient;clients=[];#l=h.state(h.proxy([]));get leaderboard(){return h.get(this.#l)}set leaderboard(e){h.set(this.#l,e,!0)}#o=h.state(h.proxy([]));get spectators(){return h.get(this.#o)}set spectators(e){h.set(this.#o,e,!0)}constructor(e){this.chat=e,this.localClient=this.newClient(),this.#r=h.derived(()=>this.room&&this.localClient.canResetScore()),setTimeout(b,100)}setupGame(e){this.room?.disconnect(),this.room=e,e.registerRecv(t=>{if(this.room===e){let e=new w.k(t);try{for(;e.remaining>0;){let t=e.getInt(),s=this.MESSAGE_HANDLERS[t];if(!s)throw Error("tag type "+t);s.call(this,e)}}catch(t){console.error("neterr",t),console.log(e.debugBuf,e),this.room.disconnect()}}}),e.registerDisc(()=>{this.room===e?(this.chat.addSysMessage("You disconnected."),this.room=void 0):this.chat.addSysMessage("You disconnected from the old room.")}),this.chat.addSysMessage("You are joining the game.")}leaveGame(){this.room?.disconnect()}sendf(e,...t){this.room?.send(new P.U().putFmt(e,...t).toArray())}updatePlayers(){var e,t;let s,i;this.leaderboard=(e=this.clients,t=this.playersSortProps,s=e.filter(e=>e).sort((e,s)=>{for(let i of t){let t=i(e),a=i(s);if(t<a)return 1;if(t>a)return -1}return e.cn-s.cn}),i=1,s.forEach((e,a)=>{if(a){let r=s[a-1];t.some(t=>t(e)!==t(r))&&(i=a+1)}s[a].rank=i}),s.sort((e,t)=>t.active-e.active))}processWelcome(e){let t=e.getInt();t!==this.PROTOCOL_VERSION&&alert(`different protocol version (client: ${this.PROTOCOL_VERSION}, server: ${t})
refresh the page for updates?`),this.clients.length=0;let s=e.getCN();this.processWelcomeMode(e);for(let t=0;t<=64;t++){let t=e.getCN();if(t<0)break;let i=t===s?this.localClient:this.newClient();i.cn=t,i.readWelcome(e),this.clients[t]=i}this.processWelcomeGame(e),this.spectators=this.clients.filter(e=>!e.active),this.updatePlayers()}processJoin(e){let t=e.getCN();if(this.clients[t])throw Error("invalid join cn "+t);let s=this.newClient();s.processJoin(t,e),this.clients[t]=s,this.chat.playerJoined(s.formatName()),this.updatePlayers()}processLeave(e){let t=e.getCN(),s=this.clients[t];if(!s)throw Error("invalid leave cn "+t);s.active&&this.playerDeactivated(s),this.chat.playerLeft(s.formatName()),delete this.clients[t],this.updatePlayers()}processReset(e){let t=e.getCN(),s=this.clients[t];if(!s)throw Error("invalid reset cn "+t);s.resetScore(),this.updatePlayers(),this.chat.playerReset(s.formatName())}processRename(e){let t=e.getCN(),s=x(e.getString(20)),i=this.clients[t];if(!i)throw Error("invalid rename cn "+t);this.chat.playerRename(i.formatName(),s),i.name=s}processPing(e){this.sendPong(e.getInt())}processPingTime(e){for(let t=0;t<=64;t++){let t=e.getCN();if(t<0)break;let s=e.getInt(),i=this.clients[t];if(!i)throw Error("invalid ping cn "+t);i.ping=s}}processChat(e){let t=e.getCN(),s=e.getInt(),i=1==(3&s)?e.getInt():-1,a=e.getString(100),r=R(this.clients[t],t),n=this.clients[i],l=n?n===this.localClient?"you":R(n,i):void 0;this.chat.addChatMessage(r,a,s,l)}processActive(e){let t=e.getCN(),s=this.clients[t];if(!s)throw Error("invalid active cn "+t);if(s.active=!s.active)this.playerActivated(s),this.spectators=this.spectators.filter(e=>e!==s);else{this.playerDeactivated(s);let e=0,t=this.spectators.length;for(;e<t;){let i=e+t>>>1;this.spectators[i].cn<s.cn?e=i+1:t=i}this.spectators.splice(e,0,s)}this.updatePlayers()}}let I=k;class E extends N{sendReady(){}#h=h.state(h.proxy([]));get roundPlayers(){return h.get(this.#h)}set roundPlayers(e){h.set(this.#h,e,!0)}processWelcomeGame(e){this.roundPlayers=this.clients.filter(e=>e.active),this.processRoundInfo(e)}playerActivated(e){this.roundPlayers.push(e)}playerDeactivated(e){this.roundPlayers=this.roundPlayers.filter(t=>t!==e)}lastUpdate=Date.now();smoothDelay=1e3;update(e){let t=Date.now()-this.lastUpdate;e&&t<1e3||(this.smoothDelay=(4*this.smoothDelay+t)/5,this.updateGameState(t,this.lastUpdate=Date.now()))}}let _=[["optServe","e",0,"Serve","who serves?",["alternate","winner","loser","random"]],["optIntermission","i",1e3,"Intermission Time / ms","time after round ends, in milliseconds",0,3e3],["optSizePlayer","i",100,"Player Size / %","player size multiplier",10,400],["optSizeBall","i",100,"Ball Size / %","ball size multiplier",10,1600],["optSizeNet","i",100,"Net Size / %","net size multiplier",0,200],["optSpeedGame","i",100,"Game Speed / %","game speed multiplier",25,800],["optSpeedPlayer","i",100,"Player Speed / %","player speed multiplier",25,800],["optSpeedBall","i",100,"Ball Speed / %","ball speed multiplier",10,800],["optGravity","i",100,"Gravity / %","gravity multiplier",10,800]];function M(e){return`${["alternate","winner","loser","random"][e.optServe]} serve, ${e.optIntermission/1e3}s intermission, (${e.optSizePlayer/100}x player, ${e.optSizeBall/100}x ball, ${e.optSizeNet/100}x net) size, (${e.optSpeedGame/100}x game, ${e.optSpeedPlayer/100}x player, ${e.optSpeedBall/100}x ball) speed, ${e.optGravity/100}x gravity`}class A{x=Math.random();y=Math.random();vx=Math.floor(7*Math.random()-3)/800*.06;vy=Math.floor(3*Math.random()+1)/400*.06;rgb=0x1000000*Math.random()|0;a=.6*Math.random()+.1;blurSize=(Math.floor(10*Math.random())+5)/2/800;scale=.7*Math.random()+.3}class O{fancy;constructor(e=40){this.fancy=Array.from({length:e},()=>new A)}update(e){if(e)for(let t of this.fancy)t.x+=t.vx*e,t.y+=t.vy*e,(t.x<-.0375||t.x>1.0375)&&(t.x%=1.075),t.x<-.0375&&(t.x+=1.075),t.y>1.075-D&&(t.y-=1.15-D)}draw(e,t,s){for(let i of(e.save(),e.globalCompositeOperation="screen",this.fancy)){let{x:a,y:r,a:n,blurSize:l,scale:o,rgb:h}=i,c=h>>16,d=h>>8&255,u=255&h;e.beginPath(),e.arc(a*t,r*s,.0375*o*t,0,2*Math.PI),e.closePath(),e.filter="blur("+l*o*t+"px)",e.fillStyle="rgba("+c+","+d+","+u+","+n+")",e.fill()}e.restore()}}class C{keys=new Set;on(e){this.keys.add(e)}off(e){this.keys.delete(e)}isOn(e){return this.keys.has(e)}attachListeners(e,t){e.addEventListener("keydown",e=>{this.on(e.keyCode),t()}),e.addEventListener("keyup",e=>{this.off(e.keyCode),t()})}}class T{x=0;y=0;valid=!1;isValid(){return this.valid}getX(){return this.x}getY(){return this.y}attachListeners(e){e.addEventListener("mousemove",t=>this.movestart(t.clientX,t.clientY,e)),e.addEventListener("touchmove",t=>this.touchmove(t,e)),e.addEventListener("mouseleave",()=>this.movestop()),e.addEventListener("touchend",()=>this.movestop()),e.addEventListener("touchcancel",()=>this.movestop())}movestart(e,t,s){let i=s.getBoundingClientRect();this.x=S((e-i.left)/s.clientWidth,0,1),this.y=S((t-i.top)/s.clientHeight,0,1),this.valid=!0}movestop(){this.valid=!1}touchmove(e,t){if(e.targetTouches.length<1)return;e.preventDefault();let s=e.targetTouches.item(0);s&&this.movestart(s.clientX,s.clientY,t)}}class L{keyManager=new C;keyFlags=0;keyFlagsFlip=0;mouseManager=new T;getKeyFlags(e){return e?this.keyFlagsFlip:this.keyFlags}getMouse(){return this.mouseManager}attachListeners(e){this.keyManager.attachListeners(window,()=>this.updateKeyFlags()),this.mouseManager.attachListeners(e)}KeyL(){return this.keyManager.isOn(37)||this.keyManager.isOn(65)}KeyU(){return this.keyManager.isOn(38)||this.keyManager.isOn(87)}KeyR(){return this.keyManager.isOn(39)||this.keyManager.isOn(68)}updateKeyFlags(){let e=+!!this.KeyL(),t=+!!this.KeyR(),s=+!!this.KeyU();this.keyFlags=e|t<<1|s<<2,this.keyFlagsFlip=t|e<<1|s<<2}}(i=n||(n={}))[i.WELCOME=0]="WELCOME",i[i.JOIN=1]="JOIN",i[i.LEAVE=2]="LEAVE",i[i.RESET=3]="RESET",i[i.RENAME=4]="RENAME",i[i.PING=5]="PING",i[i.PING_TIME=6]="PING_TIME",i[i.CHAT=7]="CHAT",i[i.ACTIVE=8]="ACTIVE",i[i.WORLDSTATE=9]="WORLDSTATE",i[i.ROUND_WIN1=10]="ROUND_WIN1",i[i.ROUND_WIN2=11]="ROUND_WIN2",i[i.ROUND_START1=12]="ROUND_START1",i[i.ROUND_START2=13]="ROUND_START2",(a=l||(l={}))[a.RESET=0]="RESET",a[a.RENAME=1]="RENAME",a[a.PONG=2]="PONG",a[a.CHAT=3]="CHAT",a[a.ACTIVE=4]="ACTIVE",a[a.MOVE=5]="MOVE";class W extends I{color="#000";colorInv="#000";#c=h.state(0);get wins(){return h.get(this.#c)}set wins(e){h.set(this.#c,e,!0)}#d=h.state(0);get loss(){return h.get(this.#d)}set loss(e){h.set(this.#d,e,!0)}#u=h.state(0);get streak(){return h.get(this.#u)}set streak(e){h.set(this.#u,e,!0)}#p=h.state(0);get score(){return h.get(this.#p)}set score(e){h.set(this.#p,e,!0)}#g=h.state(0);get total(){return h.get(this.#g)}set total(e){h.set(this.#g,e,!0)}resetScore(){this.wins=0,this.loss=0,this.streak=0,this.score=0,this.total=0}canResetScore(){return this.total}addWin(){this.streak<0&&(this.streak=0),this.streak++,this.score++,this.wins++,this.total++}addLoss(){this.streak>0&&(this.streak=0),this.streak--,this.score--,this.loss++,this.total++}readWelcome(e){super.readWelcome(e);let t=e.get()<<16|e.getUint16();this.color=(0,y.AU)(t),this.colorInv=(0,y.AU)(0xffffff^t),this.wins=e.getInt(),this.loss=e.getInt(),this.streak=e.getInt(),this.score=this.wins-this.loss,this.total=this.wins+this.loss}processJoin(e,t){super.processJoin(e,t);let s=t.get()<<16|t.getUint16();this.color=(0,y.AU)(s),this.colorInv=(0,y.AU)(0xffffff^s)}}class U extends E{#m=h.state(h.proxy((0,f.q)(_)));get mode(){return h.get(this.#m)}set mode(e){h.set(this.#m,e,!0)}gameStart=Date.now();roundStart=0;status=o.IN_PLAY;p1=new z(!0);p2=new z(!1);ball=new F;drawFancyBackground=!1;drawHat=!1;drawDev=!1;flipP1=!1;drawer=new $(this);lastKeySent=-1;input=new L;newClient(){return new W}enterGame(e,t,s){let i=parseInt(s,16),a=Number.isNaN(i)?7864064:0xffffff&i;this.setupGame(e),this.sendf("isc3",this.PROTOCOL_VERSION,t,a>>16,a>>8&255,255&a)}sendReset(){this.sendf("i",l.RESET)}sendRename(e){this.sendf("is",l.RENAME,e)}sendPong(e){this.sendf("i2",l.PONG,e)}sendChat(e,t,s=-1){this.sendf("i3s",l.CHAT,t,s,e.slice(0,100))}sendActive(){this.sendf("i",l.ACTIVE)}sendMove(e){this.sendf("i2",l.MOVE,e)}MESSAGE_HANDLERS={[n.WELCOME]:this.processWelcome,[n.JOIN]:this.processJoin,[n.LEAVE]:this.processLeave,[n.RESET]:this.processReset,[n.RENAME]:this.processRename,[n.PING]:this.processPing,[n.PING_TIME]:this.processPingTime,[n.CHAT]:this.processChat,[n.ACTIVE]:this.processActive,[n.WORLDSTATE]:this.processWorldState,[n.ROUND_WIN1]:this.processRoundWin1,[n.ROUND_WIN2]:this.processRoundWin2,[n.ROUND_START1]:this.processRoundStart0,[n.ROUND_START2]:this.processRoundStart1};playerActivated(e){super.playerActivated(e),this.p1.score=this.p2.score=0n,this.gameStart=Date.now(),this.status=o.INIT}playerDeactivated(e){this.roundPlayers.length>1&&this.roundPlayers[+(e===this.roundPlayers[0])].addWin(),e.addLoss(),this.p1.score=this.p2.score=0n,this.gameStart=Date.now(),this.status=o.INIT,super.playerDeactivated(e)}processWelcomeMode(e){this.mode.optServe=3&e.get(),this.mode.optIntermission=Math.min(Number(e.getUint64()),3e3),this.mode.optSizePlayer=S(Number(e.getUint64()),10,400),this.mode.optSizeBall=S(Number(e.getUint64()),10,1600),this.mode.optSizeNet=Math.min(Number(e.getUint64()),200),this.mode.optSpeedGame=S(Number(e.getUint64()),25,800),this.mode.optSpeedPlayer=S(Number(e.getUint64()),25,800),this.mode.optSpeedBall=S(Number(e.getUint64()),10,800),this.mode.optGravity=S(Number(e.getUint64()),10,800)}processRoundInfo(e){this.gameStart=Date.now()-Number(e.getUint64()),this.roundStart=Date.now()-Number(e.getUint64());let t=e.get();this.roundPlayers.length>1&&4&t&&([this.roundPlayers[0],this.roundPlayers[1]]=[this.roundPlayers[1],this.roundPlayers[0]]),this.status=3&t,this.p1.score=e.getUint64(),this.p2.score=e.getUint64(),this.processWorldState(e)}processWorldState(e){e.get();let t=e.getUint16()/65535,s=e.getUint16()/65535;e.getUint16();let i=1+e.getUint16()/65535,a=e.getUint16()/65535;e.getUint16();let r=e.getUint16()/65535*2,n=e.getUint16()/65535;e.getUint16(),e.getUint16(),this.p1.setServerLocation(t,s),this.p2.setServerLocation(i,a),this.ball.setServerLocation(r,n)}processRoundWin1(e){this.processRoundWin(!0)}processRoundWin2(e){this.processRoundWin(!1)}processRoundWin(e){(e?this.p1:this.p2).score++,this.roundPlayers[+!e]?.addWin(),this.roundPlayers[+!!e]?.addLoss(),this.updatePlayers(),this.status=e===(!this.roundPlayers.length||this.roundPlayers[0]===this.localClient)?o.WIN:o.LOSS}processRoundStart0(e){this.processRoundStart(!0)}processRoundStart1(e){this.processRoundStart(!1)}processRoundStart(e){this.p1.respawn(!0),this.p2.respawn(!1),this.ball.respawn(e),this.status=o.IN_PLAY,this.roundStart=Date.now()}playersSortProps=[e=>e.streak,e=>e.score,e=>e.wins];attachCanvas(e){this.input.attachListeners(e)}getKeyFlags(){let e=this.input.getKeyFlags(this.flipP1),t=this.input.getMouse();if(t.isValid()){let s=t.getX();this.flipP1&&(s=1-s);let i=Math.min(Math.max(2*s,0),1),a=.45>t.getY(),r=this.roundPlayers[1]===this.localClient?2-this.p2.x:this.p1.x;!(3&e)&&Math.abs(r-i)>.05&&(e|=r<i?2:1),a&&(e|=4)}return e}updateGameState(e){if(this.room&&this.localClient.active){let e=this.getKeyFlags();this.lastKeySent!==e&&this.sendMove(this.lastKeySent=e)}e&&(this.ball.move(e),this.p1.move(e),this.p2.move(e),this.drawer.fancy.update(e))}render(e){this.drawer.draw(e)}}(r=o||(o={}))[r.IN_PLAY=0]="IN_PLAY",r[r.WIN=1]="WIN",r[r.LOSS=2]="LOSS",r[r.INIT=3]="INIT";let D=.2;class G{x=0;y=0;xe=0;ye=0;constructor(){this.reset()}reset(){this.x=0,this.y=0,this.xe=0,this.ye=0}move(e){let t=.933254300796991**e;this.xe*=t,this.ye*=t}setServerLocation(e,t){this.xe+=this.x-e,this.ye+=this.y-t,this.x=e,this.y=t}}class F extends G{constructor(){super(),this.respawn(!0)}respawn(e){this.x=e?.45:1.55,this.y=.5,this.xe=0,this.ye=0}}class z extends G{score=0n;constructor(e){super(),this.respawn(e)}respawn(e){this.reset(),this.x=e?.45:1.55}}class ${game;fancy=new O;constructor(e){this.game=e}draw(e){let t,s=e.canvas.height,i=2*s;if(this.drawClear(e,i,s),this.game.drawFancyBackground&&this.fancy.draw(e,i,s),!this.game)return;this.drawFloor(e,i,s),this.drawNet(e,i,s);let{p1:a,p2:r,flipP1:n,localClient:l}=this.game,[h,c]=this.game.roundPlayers,d=n===(!this.game.roundPlayers.length||h===l);if(this.game.drawHat&&(this.drawHat(e,s,a.x+a.xe,a.y+a.ye,"blue",d,!1),this.drawHat(e,s,r.x+r.xe,r.y+r.ye,"blue",d,!0)),this.drawBall(e,i,s,d),this.drawSlimer(e,i,s,a.x+a.xe,a.y+a.ye,h?.color??"#7f0",h?.name??"<bot>",d,!1),this.drawSlimer(e,i,s,r.x+r.xe,r.y+r.ye,c?.color??h?.colorInv??"#80f",c?.name??"<bot>",d,!0),h&&(this.drawPing(e,i,s,h.ping,+!!d),c&&this.drawPing(e,i,s,c.ping,+!d)),l!==h&&l!==c&&this.drawPing(e,i,s,l.ping,2),this.game.drawDev&&(this.drawBall(e,i,s,d,!0),this.drawSlimer(e,i,s,a.x,a.y,"","",d,!1,!0),this.drawSlimer(e,i,s,r.x,r.y,"","",d,!0,!0)),this.drawScore(e,i,s,d,a.score,r.score),this.game.room){l.active?this.game.status===o.WIN?t="You won the round!":this.game.status===o.LOSS?t="You lost the round!":this.game.status===o.INIT&&(t="Game starting"):t=this.game.status?this.game.status===o.INIT?"Game starting":`${this.game.status===o.WIN!==this.game.flipP1?"Left":"Right"} wins the round!`:"Spectating";let e=`${!this.game.status?((Date.now()-this.game.roundStart)/1e3).toFixed(1)+"/":""}${((Date.now()-this.game.gameStart)/1e3).toFixed(1)}`;t=t?`${t} (${e})`:e}else t="Disconnected";this.drawStatus(e,i,s,t),this.drawFPS(e,i,s)}drawClear(e,t,s){let i=e.createRadialGradient(t/2,s/2,0,t/2,s/2,s);i.addColorStop(0,"#0df"),i.addColorStop(1,"#26b"),e.fillStyle=i,e.fillRect(0,0,t,s)}drawFloor(e,t,s){e.fillStyle="#999",e.fillRect(0,s*(1-D),t,s)}drawNet(e,t,s){let i=.02*t*this.game.mode.optSizeNet/100,a=.175*this.game.mode.optSizeNet/100;e.fillStyle="#fff",e.fillRect(.5*(t-i),(1-D-a)*s,i,(a+.025)*s)}drawBall(e,t,s,i,a){let r=this.game.ball,n=r.x,l=r.y;if(a||(n+=r.xe,l+=r.ye),i&&(n=2-n),l=1-l-D,e.beginPath(),e.arc(n*s,l*s,.03*this.game.mode.optSizeBall/100*s,0,2*Math.PI),e.closePath(),a){e.lineWidth=2,e.strokeStyle="red",e.stroke();return}e.fillStyle=this.game.status===o.WIN?"#0f0":this.game.status===o.LOSS?"red":"#ff0",e.fill()}drawHat(e,t,s,i,a,r,n){let l=.1*this.game.mode.optSizePlayer/100;r&&(s=2-s);let o=(i=1-i-D)-3*l,h=i-.01*l;e.beginPath(),e.moveTo((s+(r!==n?-.6:.6)*l)*t,o*t),e.lineTo(s*t,h*t),e.lineTo((s+(r!==n?-.8:.8)*l)*t,h*t),e.closePath(),e.fillStyle=a,e.fill()}drawSlimer(e,t,s,i,a,r,n,l,o,h){let c=this.game.ball,d=.1*this.game.mode.optSizePlayer/100;if(l&&(i=2-i),a=1-a-D,e.beginPath(),e.arc(i*s,a*s,d*s,0,Math.PI,!0),e.closePath(),h){e.lineWidth=2,e.strokeStyle="red",e.stroke();return}e.fillStyle=r,e.fill();let u=i+(l!==o?-.535:.535)*d,p=a-.525*d;e.beginPath(),e.arc(u*s,p*s,.175*d*s,0,2*Math.PI,!0),e.closePath(),e.fillStyle="#fff",e.fill();let g=(l?2-(c.x+c.xe):c.x+c.xe)-u,m=1-(c.y+c.ye)-D-p,f=g*g+m*m,v=.05*d,y=f>v*v?v/Math.sqrt(f):1;u+=g*y,p+=m*y,e.beginPath(),e.arc(u*s,p*s,.1*d*s,0,2*Math.PI,!0),e.closePath(),e.fillStyle="#000",e.fill(),n&&(e.font=.0225*t+"px Verdana, sans-serif",e.textAlign="center",e.fillStyle="#ccc",e.fillText(n,i*s,(a-.05-d)*s))}drawScore(e,t,s,i,a,r){e.font=.05*t+"px sans-serif",e.textAlign="center",e.fillStyle="#fd0",e.fillText(a+"",(i?.92:.08)*t,.15*s),e.fillText(r+"",(i?.08:.92)*t,.15*s)}drawStatus(e,t,s,i){e.font=.04*t+"px sans-serif",e.textAlign="center",e.fillStyle="#ddd",e.fillText(i,.5*t,.15*s)}drawFPS(e,t,s){if(!this.game)return;let i=1e3/Math.max(this.game.smoothDelay,.5);e.font=.02*t+"px monospace",e.textAlign="left",e.fillStyle="#fa0",e.fillText(Math.round(i)+" fps",.01*t,.97*s)}drawPing(e,t,s,i,a){i<0||(e.font=.02*t+"px monospace",e.textAlign=["left","right","center"][a],e.fillStyle="#fa0",e.fillText(i+" ms",[.01,.99,.5][a]*t,(a>1?.9:.85)*s))}}var B=s(5),H=h.from_html('<div style="border: solid black 2px; container-type: inline-size"><canvas></canvas></div>'),V=s(142),K=h.from_html('<!> <div class="mt-3"> </div> <b>Lobby</b> <!>',1),Y=h.from_html('<div class="input-group mb-3"><span class="input-group-text flex-grow-1"><label class="form-check mx-auto"><input type="radio" class="form-check-input"/> Left</label></span> <span class="input-group-text flex-grow-1"><label class="mx-auto">Right <input type="radio" class="form-check-input"/></label></span> <span class="input-group-text flex-grow-1"><label class="form-check mx-auto"><input type="checkbox" class="form-check-input"/> Fancy Background</label></span> <span class="input-group-text flex-grow-1"><label class="form-check mx-auto"><input type="checkbox" class="form-check-input"/> Silly Hat</label></span> <span class="input-group-text flex-grow-1"><label class="form-check mx-auto"><input type="checkbox" class="form-check-input"/> Dev Mode</label></span> <span class="input-group-text flex-grow-1"><label class="form-check mx-auto"><input type="checkbox" class="form-check-input"/> <span class="form-check-label">Full-Screen</span></label></span></div> <!>',1),q=h.from_html('<div class="row"><div class="col-12 col-sm-6 col-md-7 col-lg-8 col-xl-9"><!></div> <div class="col-12 col-sm-6 col-md-5 col-lg-4 col-xl-3"><div class="input-group mb-3"><span class="input-group-text">Color</span> <input type="text" class="form-control" placeholder="#77ff00" maxlength="7"/> <input type="color" class="form-control form-control-color" maxlength="20"/></div></div></div> <!> <!> <div class="row"><div class="col-12 col-xl-8"><!></div> <div class="col-12 col-xl-4 mb-3"><!></div></div>',1);h.delegate(["click"]),(0,s(102).A)(function(e,t){let s,i;h.push(t,!0);let a=new u.Ay,r=new U(a),n=(0,c.C)("game/mp/_shared/name",""),l=(0,c.C)("game/mp/slime/color","#77ff00"),o=(0,c.C)("game/mp/slime/f",!1),y=(0,c.C)("game/mp/slime/b",!1),S=(0,c.C)("game/mp/slime/h",!1),w=(0,c.C)("game/mp/slime/d",!1);h.user_effect(()=>{r.flipP1=o.value}),h.user_effect(()=>{r.drawFancyBackground=y.value}),h.user_effect(()=>{r.drawHat=S.value}),h.user_effect(()=>{r.drawDev=w.value});let x=h.derived(()=>r.room),b=h.derived(()=>r.canReset),R=h.derived(()=>r.leaderboard),P=h.derived(()=>r.localClient);var k=q(),N=h.first_child(k),I=h.child(N),E=h.child(I);(0,g.A)(E,{onchange:()=>r.sendRename(n.value),get value(){return n.value},set value($$value){n.value=$$value}}),h.reset(I);var A=h.sibling(I,2),O=h.child(A),C=h.sibling(h.child(O),2);h.remove_input_defaults(C);var T=h.sibling(C,2);h.remove_input_defaults(T),h.reset(O),h.reset(A),h.reset(N);var L=h.sibling(N,2);h.bind_this((0,v.A)(L,{gameId:"slime-fd3iliszksmlav83stww",roomType:"SlimeRoom",get gameRoom(){return r.room},onJoinedRoom:e=>r.enterGame(e,n.value,l.value.slice(1)),formatGameMode:e=>M((0,f.e)(_,e)),get roomCreateOptions(){return _}}),e=>s=e,()=>s);var W=h.sibling(L,2);(0,m.A)(W,{get inGame(){return h.get(x)},get isActive(){return r.localClient.active},canReady:!1,isReady:!1,onActive:()=>r.sendActive(),onReady:()=>r.sendReady(),onDisconnect:()=>(r.leaveGame(),s.refreshRooms()),children:(e,t)=>{let s;var a,n,l,c,d,u,p=Y(),g=h.first_child(p),m=h.child(g),f=h.child(m),v=h.child(f);h.remove_input_defaults(v),v.__click=()=>o.value=!1,h.next(),h.reset(f),h.reset(m);var x=h.sibling(m,2),b=h.child(x),R=h.sibling(h.child(b));h.remove_input_defaults(R),R.__click=()=>o.value=!0,h.reset(b),h.reset(x);var P=h.sibling(x,2),k=h.child(P),N=h.child(k);h.remove_input_defaults(N),h.next(),h.reset(k),h.reset(P);var I=h.sibling(P,2),E=h.child(I),_=h.child(E);h.remove_input_defaults(_),h.next(),h.reset(E),h.reset(I);var A=h.sibling(I,2),O=h.child(A),C=h.child(O);h.remove_input_defaults(C),h.next(),h.reset(O),h.reset(A);var T=h.sibling(A,2),L=h.child(T);h.child(L).__click=function(){this.checked=!1,i.requestFullscreen()},h.next(2),h.reset(L),h.reset(T),h.reset(g);var W=h.sibling(g,2);h.bind_this((a={get gameState(){return r}},h.push(a,!0),n=K(),l=h.first_child(n),h.bind_this(function(e,t){let s,i;h.push(t,!0);let a=h.prop(t,"aspect",3,2);function r(){window.innerWidth===window.screen.width&&window.innerHeight===window.screen.height?(s.width=Math.min(window.innerWidth,window.innerHeight*a()),s.height=Math.min(window.innerHeight,window.innerWidth/a())):(s.width=Math.floor(s.clientWidth*window.devicePixelRatio),s.height=Math.floor(s.clientHeight*window.devicePixelRatio))}(0,B.Rc)(()=>{let e;t.gameState.attachCanvas(s),i=s.getContext("2d"),document.addEventListener("fullscreenchange",r),window.addEventListener("resize",r),r(),!function s(){t.gameState.update(),t.gameState.render(i),e=requestAnimationFrame(s)}();let a=setInterval(()=>t.gameState.update(!0),1e3);return()=>{document.removeEventListener("fullscreenchange",r),window.removeEventListener("resize",r),cancelAnimationFrame(e),clearInterval(a)}});var n=H(),l=h.child(n);return h.bind_this(l,e=>s=e,()=>s),h.reset(n),h.template_effect(()=>h.set_style(l,`width: min(100cqw, ${100*a()}cqh); height: min(${100/a()}cqw, 100cqh)`)),h.append(e,n),h.pop({requestFullscreen:function(e){return s.requestFullscreen(e)}})}(l,{get gameState(){return a.gameState}}),e=>s=e,()=>s),c=h.sibling(l,2),d=h.child(c),h.reset(c),u=h.sibling(c,4),(0,V.A)(u,{get localClient(){return a.gameState.localClient},get inGame(){return a.gameState.roundPlayers},get spectators(){return a.gameState.spectators}}),h.template_effect(e=>h.set_text(d,`Game Mode: ${e??""}`),[()=>M(a.gameState.mode)]),h.append(W,n),h.pop({requestFullscreen:function(e){return s.requestFullscreen(e)}})),e=>i=e,()=>i),h.template_effect(()=>{h.set_checked(v,!o.value),h.set_checked(R,o.value)}),h.bind_checked(N,()=>y.value,e=>y.value=e),h.bind_checked(_,()=>S.value,e=>S.value=e),h.bind_checked(C,()=>w.value,e=>w.value=e),h.append(e,p)},$$slots:{default:!0}});var D=h.sibling(W,2),G=h.child(D),F=h.child(G);(0,p.A)(F,{get leaderboard(){return h.get(R)},get localClient(){return h.get(P)},get inGame(){return h.get(x)},get canReset(){return h.get(b)},onReset:()=>r.sendReset(),columns:[["Streak",e=>e.streak],["Score",e=>e.score],["Win",e=>[e.wins,e.total]],["Loss",e=>[e.loss,e.total]]]}),h.reset(G);var z=h.sibling(G,2),$=h.child(z);(0,d.A)($,{get chatState(){return a},get canSend(){return r.room},onInput:e=>(0,u.Oo)(r,e)}),h.reset(z),h.reset(D),h.bind_value(C,()=>l.value,e=>l.value=e),h.bind_value(T,()=>l.value,e=>l.value=e),h.append(e,k),h.pop()})},122(e,t,s){function i(e){let t="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789",s="";for(;e--;)s+=t[Math.random()*t.length|0];return s}function a(e){return"#"+("00000"+e.toString(16)).slice(-6)}s.d(t,{AU:()=>a,JY:()=>i})}},r={};function n(e){var t=r[e];if(void 0!==t)return t.exports;var s=r[e]={exports:{}};return a[e](s,s.exports,n),s.exports}n.m=a,n.d=(e,t)=>{for(var s in t)n.o(t,s)&&!n.o(e,s)&&Object.defineProperty(e,s,{enumerable:!0,get:t[s]})},n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),n.r=e=>{"u">typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},e=[],n.O=(t,s,i,a)=>{if(s){a=a||0;for(var r=e.length;r>0&&e[r-1][2]>a;r--)e[r]=e[r-1];e[r]=[s,i,a];return}for(var l=1/0,r=0;r<e.length;r++){for(var[s,i,a]=e[r],o=!0,h=0;h<s.length;h++)(!1&a||l>=a)&&Object.keys(n.O).every(e=>n.O[e](s[h]))?s.splice(h--,1):(o=!1,a<l&&(l=a));if(o){e.splice(r--,1);var c=i();void 0!==c&&(t=c)}}return t},n.rv=()=>"1.7.3",t={102:0},n.O.j=e=>0===t[e],s=(e,s)=>{var i,a,[r,l,o]=s,h=0;if(r.some(e=>0!==t[e])){for(i in l)n.o(l,i)&&(n.m[i]=l[i]);if(o)var c=o(n)}for(e&&e(s);h<r.length;h++)a=r[h],n.o(t,a)&&t[a]&&t[a][0](),t[a]=0;return n.O(c)},(i=self.webpackChunkvwww=self.webpackChunkvwww||[]).forEach(s.bind(null,0)),i.push=s.bind(null,i.push.bind(i)),n.ruid="bundler=rspack@1.7.3";var l=n.O(void 0,["14","21","37","22","49","36"],()=>n(156));l=n.O(l)})();